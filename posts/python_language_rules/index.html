<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Python语言规范 | Tao's Notes</title><meta name=keywords content="Python,Pylint"><meta name=description content="pylint是一个可以查找py文件中部分错误以及不规范的语法，虽然pylint还不够完美但是我们可以借助它修正不规范的地方。"><meta name=author content="Me"><link rel=canonical href=https://zhoutao822.github.io/posts/python_language_rules/><meta name=google-site-verification content="Tao"><meta name=yandex-verification content="Tao"><meta name=msvalidate.01 content="Tao"><link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://zhoutao822.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://zhoutao822.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://zhoutao822.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://zhoutao822.github.io/apple-touch-icon.png><link rel=mask-icon href=https://zhoutao822.github.io/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.103.1"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Python语言规范"><meta property="og:description" content="pylint是一个可以查找py文件中部分错误以及不规范的语法，虽然pylint还不够完美但是我们可以借助它修正不规范的地方。"><meta property="og:type" content="article"><meta property="og:url" content="https://zhoutao822.github.io/posts/python_language_rules/"><meta property="og:image" content="https://zhoutao822.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-06-14T20:26:46+08:00"><meta property="article:modified_time" content="2019-06-14T20:26:46+08:00"><meta property="og:site_name" content="Tao's Notes"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://zhoutao822.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Python语言规范"><meta name=twitter:description content="pylint是一个可以查找py文件中部分错误以及不规范的语法，虽然pylint还不够完美但是我们可以借助它修正不规范的地方。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://zhoutao822.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Python语言规范","item":"https://zhoutao822.github.io/posts/python_language_rules/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Python语言规范","name":"Python语言规范","description":"pylint是一个可以查找py文件中部分错误以及不规范的语法，虽然pylint还不够完美但是我们可以借助它修正不规范的地方。","keywords":["Python","Pylint"],"articleBody":"1. Pylint pylint是一个可以查找py文件中部分错误以及不规范的语法，虽然pylint还不够完美但是我们可以借助它修正不规范的地方。\n使用方式\npylint xxx.py 输出类似于\n************* Module wine wine.py:20:0: C0304: Final newline missing (missing-final-newline) wine.py:1:0: C0111: Missing module docstring (missing-docstring) wine.py:3:0: E0401: Unable to import 'numpy' (import-error) wine.py:4:0: E0401: Unable to import 'sklearn.datasets' (import-error) wine.py:5:0: E0401: Unable to import 'sklearn.mixture' (import-error) wine.py:6:0: C0103: Constant name \"rawData\" doesn't conform to UPPER_CASE naming style (invalid-name) wine.py:8:0: C0103: Constant name \"data\" doesn't conform to UPPER_CASE naming style (invalid-name) wine.py:9:0: C0103: Constant name \"target\" doesn't conform to UPPER_CASE naming style (invalid-name) wine.py:11:0: C0103: Constant name \"gmm\" doesn't conform to UPPER_CASE naming style (invalid-name) wine.py:15:0: C0103: Constant name \"prediction\" doesn't conform to UPPER_CASE naming style (invalid-name) wine.py:19:0: C0103: Constant name \"acc\" doesn't conform to UPPER_CASE naming style (invalid-name) --------------------------------------------------------------------- Your code has been rated at -9.17/10 (previous run: 10.00/10, -19.17) 也可以通过行注释来抑制警告\ndict = 'something awful' # Bad Idea... pylint: disable=redefined-builtin 要抑制”参数未使用”告警, 你可以用””作为参数标识符, 或者在参数名前加”unused”. 遇到不能改变参数名的情况, 你可以通过在函数开头”提到”它们来消除告警. 例如:\ndef foo(a, unused_b, unused_c, d=None, e=None): _ = d, e return a 2. 导入 使用 import x 来导入包和模块.\n使用 from x import y, 其中x是包前缀, y是不带前缀的模块名.\n使用 from x import y as z, 如果两个要导入的模块都叫做y或者y太长了.\n例如, 模块 sound.effects.echo 可以用如下方式导入:\nfrom sound.effects import echo ... echo.EchoFilter(input, output, delay=0.7, atten=4) 导入时不要使用相对名称. 即使模块在同一个包中, 也要使用完整包名. 这能帮助你避免无意间导入一个包两次.\n3. 包 所有的新代码都应该用完整包名来导入每个模块.\n应该像下面这样导入:\n# Reference in code with complete name. import sound.effects.echo # Reference in code with just module name (preferred). from sound.effects import echo 4. 异常 异常必须遵守特定条件:\n像这样触发异常: raise MyException(\"Error message\") 或者 raise MyException . 不要使用两个参数的形式( raise MyException, \"Error message\" )或者过时的字符串异常( raise \"Error message\" ). 模块或包应该定义自己的特定域的异常基类, 这个基类应该从内建的Exception类继承. 模块的异常基类应该叫做”Error”. class Error(Exception): pass 永远不要使用 except: 语句来捕获所有异常, 也不要捕获 Exception 或者 StandardError , 除非你打算重新触发该异常, 或者你已经在当前线程的最外层(记得还是要打印一条错误消息). 在异常这方面, Python非常宽容, except: 真的会捕获包括Python语法错误在内的任何错误. 使用 except: 很容易隐藏真正的bug. 尽量减少try/except块中的代码量. try块的体积越大, 期望之外的异常就越容易被触发. 这种情况下, try/except块将隐藏真正的错误. 使用finally子句来执行那些无论try块中有没有异常都应该被执行的代码. 这对于清理资源常常很有用, 例如关闭文件. 当捕获异常时, 使用 as 而不要用逗号. 例如 try: raise Error except Error as error: pass 5. 全局变量 避免使用全局变量, 用类变量来代替. 但也有一些例外:\n脚本的默认选项. 模块级常量. 例如:　PI = 3.14159. 常量应该全大写, 用下划线连接. 有时候用全局变量来缓存值或者作为函数返回值很有用. 如果需要, 全局变量应该仅在模块内部可用, 并通过模块级的公共函数来访问. 6. 嵌套/局部/内部类或函数 鼓励使用嵌套/本地/内部类或函数\n类可以定义在方法, 函数或者类中. 函数可以定义在方法或函数中. 封闭区间中定义的变量对嵌套函数是只读的.\n嵌套类或局部类的实例不能序列化(pickled).\n6. 列表推导 适用于简单情况. 每个部分应该单独置于一行: 映射表达式, for语句, 过滤器表达式. 禁止多重for语句或过滤器表达式. 复杂情况下还是使用循环.\nYes: result = [] for x in range(10): for y in range(5): if x * y \u003e 10: result.append((x, y)) for x in xrange(5): for y in xrange(5): if x != y: for z in xrange(5): if y != z: yield (x, y, z) return ((x, complicated_transform(x)) for x in long_generator_function(parameter) if x is not None) squares = [x * x for x in range(10)] eat(jelly_bean for jelly_bean in jelly_beans if jelly_bean.color == 'black') No: result = [(x, y) for x in range(10) for y in range(5) if x * y \u003e 10] return ((x, y, z) for x in xrange(5) for y in xrange(5) if x != y for z in xrange(5) if y != z) 7. 默认迭代器和操作符 如果类型支持, 就使用默认迭代器和操作符, 例如列表, 字典和文件. 内建类型也定义了迭代器方法. 优先考虑这些方法, 而不是那些返回列表的方法. 当然，这样遍历容器时，你将不能修改容器.\nYes: for key in adict: ... if key not in adict: ... if obj in alist: ... for line in afile: ... for k, v in dict.iteritems(): ... No: for key in adict.keys(): ... if not adict.has_key(key): ... for line in afile.readlines(): ... 8. 生成器 所谓生成器函数, 就是每当它执行一次生成(yield)语句, 它就返回一个迭代器, 这个迭代器生成一个值. 生成值后, 生成器函数的运行状态将被挂起, 直到下一次生成.\n鼓励使用. 注意在生成器函数的文档字符串中使用”Yields:”而不是”Returns:”.\n9. Lambda函数 适用于单行函数. 如果代码超过60-80个字符, 最好还是定义成常规(嵌套)函数.\n对于常见的操作符，例如乘法操作符，使用 operator 模块中的函数以代替lambda函数. 例如, 推荐使用 operator.mul , 而不是 lambda x, y: x * y .\n10. 条件表达式 适用于单行函数. 在其他情况下，推荐使用完整的if语句.\n11. 默认参数值 鼓励使用, 不过有如下注意事项:\n不要在函数或方法定义中使用可变对象作为默认值.\nYes: def foo(a, b=None): if b is None: b = [] No: def foo(a, b=[]): ... No: def foo(a, b=time.time()): # The time the module was loaded??? ... No: def foo(a, b=FLAGS.my_thing): # sys.argv has not yet been parsed... ... 12. 属性 你通常习惯于使用访问或设置方法来访问或设置数据, 它们简单而轻量. 不过我们建议你在新的代码中使用属性. 只读属性应该用 @property 装饰器 来创建.\n如果子类没有覆盖属性, 那么属性的继承可能看上去不明显. 因此使用者必须确保访问方法间接被调用, 以保证子类中的重载方法被属性调用(使用模板方法设计模式).\nYes: import math class Square(object): \"\"\"A square with two properties: a writable area and a read-only perimeter. To use: \u003e\u003e\u003e sq = Square(3) \u003e\u003e\u003e sq.area 9 \u003e\u003e\u003e sq.perimeter 12 \u003e\u003e\u003e sq.area = 16 \u003e\u003e\u003e sq.side 4 \u003e\u003e\u003e sq.perimeter 16 \"\"\" def __init__(self, side): self.side = side def __get_area(self): \"\"\"Calculates the 'area' property.\"\"\" return self.side ** 2 def ___get_area(self): \"\"\"Indirect accessor for 'area' property.\"\"\" return self.__get_area() def __set_area(self, area): \"\"\"Sets the 'area' property.\"\"\" self.side = math.sqrt(area) def ___set_area(self, area): \"\"\"Indirect setter for 'area' property.\"\"\" self._SetArea(area) area = property(___get_area, ___set_area, doc=\"\"\"Gets or sets the area of the square.\"\"\") @property def perimeter(self): return self.side * 4 13. True/False的求值 尽可能使用隐式的false, 例如: 使用 if foo: 而不是 if foo != []: . 不过还是有一些注意事项需要你铭记在心:\n永远不要用==或者!=来比较单件, 比如None. 使用is或者is not.\n注意: 当你写下 if x: 时, 你其实表示的是 if x is not None . 例如: 当你要测试一个默认值是None的变量或参数是否被设为其它值. 这个值在布尔语义下可能是false!\n永远不要用==将一个布尔量与false相比较. 使用 if not x: 代替. 如果你需要区分false和None, 你应该用像 if not x and x is not None: 这样的语句.\n对于序列(字符串, 列表, 元组), 要注意空序列是false. 因此 if not seq: 或者 if seq: 比 if len(seq): 或 if not len(seq): 要更好.\n处理整数时, 使用隐式false可能会得不偿失(即不小心将None当做0来处理). 你可以将一个已知是整型(且不是len()的返回结果)的值与0比较.\nYes: if not users: print 'no users' if foo == 0: self.handle_zero() if i % 10 == 0: self.handle_multiple_of_ten() No: if len(users) == 0: print 'no users' if foo is not None and not foo: self.handle_zero() if not i % 10: self.handle_multiple_of_ten() 注意‘0’(字符串)会被当做true. 14. 词法作用域 嵌套的Python函数可以引用外层函数中定义的变量, 但是不能够对它们赋值. 变量绑定的解析是使用词法作用域, 也就是基于静态的程序文本. 对一个块中的某个名称的任何赋值都会导致Python将对该名称的全部引用当做局部变量, 甚至是赋值前的处理. 如果碰到global声明, 该名称就会被视作全局变量.\n一个使用这个特性的例子:\ndef get_adder(summand1): \"\"\"Returns a function that adds numbers to a given number.\"\"\" def adder(summand2): return summand1 + summand2 return adder (译者注: 这个例子有点诡异, 你应该这样使用这个函数: sum = get_adder(summand1)(summand2) )\n15. 函数与方法装饰器 用于函数及方法的装饰器 (也就是@标记). 最常见的装饰器是@classmethod 和@staticmethod, 用于将常规函数转换成类方法或静态方法. 不过, 装饰器语法也允许用户自定义装饰器. 特别地, 对于某个函数 my_decorator , 下面的两段代码是等效的:\nclass C(object): @my_decorator def method(self): # method body ... class C(object): def method(self): # method body ... method = my_decorator(method) 16. 线程 虽然Python的内建类型例如字典看上去拥有原子操作, 但是在某些情形下它们仍然不是原子的(即: 如果__hash__或__eq__被实现为Python方法)且它们的原子性是靠不住的. 你也不能指望原子变量赋值(因为这个反过来依赖字典).\n优先使用Queue模块的 Queue 数据类型作为线程间的数据通信方式. 另外, 使用threading模块及其锁原语(locking primitives). 了解条件变量的合适使用方式, 这样你就可以使用 threading.Condition 来取代低级别的锁了.\n参考： Google Python语言规范 ","wordCount":"890","inLanguage":"en","datePublished":"2019-06-14T20:26:46+08:00","dateModified":"2019-06-14T20:26:46+08:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhoutao822.github.io/posts/python_language_rules/"},"publisher":{"@type":"Organization","name":"Tao's Notes","logo":{"@type":"ImageObject","url":"https://zhoutao822.github.io/favicon.ico"}}}</script></head><body class=dark id=top><header class=header><nav class=nav><div class=logo><a href=https://zhoutao822.github.io/ accesskey=h title="Home (Alt + H)">Home</a>
<span class=logo-switches></span></div><ul id=menu><li><a href=https://zhoutao822.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://zhoutao822.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://zhoutao822.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://zhoutao822.github.io/series/ title=Series><span>Series</span></a></li><li><a href=https://zhoutao822.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://zhoutao822.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://zhoutao822.github.io/posts/>Posts</a></div><h1 class=post-title>Python语言规范</h1><div class=post-meta><span title='2019-06-14 20:26:46 +0800 +0800'>June 14, 2019</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/Zhoutao822/zhoutao822.github.io/tree/main/content//posts/python_language_rules.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#1-pylint aria-label="1. Pylint">1. Pylint</a></li><li><a href=#2-%e5%af%bc%e5%85%a5 aria-label="2. 导入">2. 导入</a></li><li><a href=#3-%e5%8c%85 aria-label="3. 包">3. 包</a></li><li><a href=#4-%e5%bc%82%e5%b8%b8 aria-label="4. 异常">4. 异常</a></li><li><a href=#5-%e5%85%a8%e5%b1%80%e5%8f%98%e9%87%8f aria-label="5. 全局变量">5. 全局变量</a></li><li><a href=#6-%e5%b5%8c%e5%a5%97%e5%b1%80%e9%83%a8%e5%86%85%e9%83%a8%e7%b1%bb%e6%88%96%e5%87%bd%e6%95%b0 aria-label="6. 嵌套/局部/内部类或函数">6. 嵌套/局部/内部类或函数</a></li><li><a href=#6-%e5%88%97%e8%a1%a8%e6%8e%a8%e5%af%bc aria-label="6. 列表推导">6. 列表推导</a></li><li><a href=#7-%e9%bb%98%e8%ae%a4%e8%bf%ad%e4%bb%a3%e5%99%a8%e5%92%8c%e6%93%8d%e4%bd%9c%e7%ac%a6 aria-label="7. 默认迭代器和操作符">7. 默认迭代器和操作符</a></li><li><a href=#8-%e7%94%9f%e6%88%90%e5%99%a8 aria-label="8. 生成器">8. 生成器</a></li><li><a href=#9-lambda%e5%87%bd%e6%95%b0 aria-label="9. Lambda函数">9. Lambda函数</a></li><li><a href=#10-%e6%9d%a1%e4%bb%b6%e8%a1%a8%e8%be%be%e5%bc%8f aria-label="10. 条件表达式">10. 条件表达式</a></li><li><a href=#11-%e9%bb%98%e8%ae%a4%e5%8f%82%e6%95%b0%e5%80%bc aria-label="11. 默认参数值">11. 默认参数值</a></li><li><a href=#12-%e5%b1%9e%e6%80%a7 aria-label="12. 属性">12. 属性</a></li><li><a href=#13-truefalse%e7%9a%84%e6%b1%82%e5%80%bc aria-label="13. True/False的求值">13. True/False的求值</a></li><li><a href=#14-%e8%af%8d%e6%b3%95%e4%bd%9c%e7%94%a8%e5%9f%9f aria-label="14. 词法作用域">14. 词法作用域</a></li><li><a href=#15-%e5%87%bd%e6%95%b0%e4%b8%8e%e6%96%b9%e6%b3%95%e8%a3%85%e9%a5%b0%e5%99%a8 aria-label="15. 函数与方法装饰器">15. 函数与方法装饰器</a></li><li><a href=#16-%e7%ba%bf%e7%a8%8b aria-label="16. 线程">16. 线程</a></li><li><a href=#%e5%8f%82%e8%80%83 aria-label=参考：>参考：</a></li></ul></div></details></div><div class=post-content><h2 id=1-pylint>1. Pylint<a hidden class=anchor aria-hidden=true href=#1-pylint>#</a></h2><p>pylint是一个可以查找py文件中部分错误以及不规范的语法，虽然pylint还不够完美但是我们可以借助它修正不规范的地方。</p><p>使用方式</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>pylint xxx.py
</span></span></code></pre></div><p>输出类似于</p><pre tabindex=0><code>************* Module wine
wine.py:20:0: C0304: Final newline missing (missing-final-newline)
wine.py:1:0: C0111: Missing module docstring (missing-docstring)
wine.py:3:0: E0401: Unable to import &#39;numpy&#39; (import-error)
wine.py:4:0: E0401: Unable to import &#39;sklearn.datasets&#39; (import-error)
wine.py:5:0: E0401: Unable to import &#39;sklearn.mixture&#39; (import-error)
wine.py:6:0: C0103: Constant name &#34;rawData&#34; doesn&#39;t conform to UPPER_CASE naming style (invalid-name)
wine.py:8:0: C0103: Constant name &#34;data&#34; doesn&#39;t conform to UPPER_CASE naming style (invalid-name)
wine.py:9:0: C0103: Constant name &#34;target&#34; doesn&#39;t conform to UPPER_CASE naming style (invalid-name)
wine.py:11:0: C0103: Constant name &#34;gmm&#34; doesn&#39;t conform to UPPER_CASE naming style (invalid-name)
wine.py:15:0: C0103: Constant name &#34;prediction&#34; doesn&#39;t conform to UPPER_CASE naming style (invalid-name)
wine.py:19:0: C0103: Constant name &#34;acc&#34; doesn&#39;t conform to UPPER_CASE naming style (invalid-name)

---------------------------------------------------------------------
Your code has been rated at -9.17/10 (previous run: 10.00/10, -19.17)
</code></pre><p>也可以通过行注释来抑制警告</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>dict <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;something awful&#39;</span>  <span style=color:#75715e># Bad Idea... pylint: disable=redefined-builtin</span>
</span></span></code></pre></div><p>要抑制”参数未使用”告警, 你可以用”<em>”作为参数标识符, 或者在参数名前加”unused</em>”. 遇到不能改变参数名的情况, 你可以通过在函数开头”提到”它们来消除告警. 例如:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>foo</span>(a, unused_b, unused_c, d<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>, e<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>):
</span></span><span style=display:flex><span>    _ <span style=color:#f92672>=</span> d, e
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> a
</span></span></code></pre></div><h2 id=2-导入>2. 导入<a hidden class=anchor aria-hidden=true href=#2-导入>#</a></h2><ul><li><p>使用 <code>import x</code> 来导入包和模块.</p></li><li><p>使用 <code>from x import y</code>, 其中x是包前缀, y是不带前缀的模块名.</p></li><li><p>使用 <code>from x import y as z</code>, 如果两个要导入的模块都叫做y或者y太长了.</p></li></ul><p>例如, 模块 <code>sound.effects.echo</code> 可以用如下方式导入:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> sound.effects <span style=color:#f92672>import</span> echo
</span></span><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>echo<span style=color:#f92672>.</span>EchoFilter(input, output, delay<span style=color:#f92672>=</span><span style=color:#ae81ff>0.7</span>, atten<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>)
</span></span></code></pre></div><p>导入时不要使用相对名称. 即使模块在同一个包中, 也要使用完整包名. 这能帮助你避免无意间导入一个包两次.</p><h2 id=3-包>3. 包<a hidden class=anchor aria-hidden=true href=#3-包>#</a></h2><p>所有的新代码都应该用完整包名来导入每个模块.</p><p>应该像下面这样导入:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Reference in code with complete name.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> sound.effects.echo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Reference in code with just module name (preferred).</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> sound.effects <span style=color:#f92672>import</span> echo
</span></span></code></pre></div><h2 id=4-异常>4. 异常<a hidden class=anchor aria-hidden=true href=#4-异常>#</a></h2><p>异常必须遵守特定条件:</p><ol><li>像这样触发异常: <code>raise MyException("Error message")</code> 或者 <code>raise MyException</code> . 不要使用两个参数的形式( <code>raise MyException, "Error message"</code> )或者过时的字符串异常( <code>raise "Error message"</code> ).</li><li>模块或包应该定义自己的特定域的异常基类, 这个基类应该从内建的Exception类继承. 模块的异常基类应该叫做”Error”.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Error</span>(<span style=color:#a6e22e>Exception</span>):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span></code></pre></div><ol start=3><li>永远不要使用 <code>except:</code> 语句来捕获所有异常, 也不要捕获 <code>Exception</code> 或者 <code>StandardError</code> , 除非你打算重新触发该异常, 或者你已经在当前线程的最外层(记得还是要打印一条错误消息). 在异常这方面, Python非常宽容, <code>except:</code> 真的会捕获包括Python语法错误在内的任何错误. 使用 <code>except:</code> 很容易隐藏真正的bug.</li><li>尽量减少try/except块中的代码量. try块的体积越大, 期望之外的异常就越容易被触发. 这种情况下, try/except块将隐藏真正的错误.</li><li>使用<code>finally</code>子句来执行那些无论try块中有没有异常都应该被执行的代码. 这对于清理资源常常很有用, 例如关闭文件.</li><li>当捕获异常时, 使用 <code>as</code> 而不要用逗号. 例如</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>raise</span> Error
</span></span><span style=display:flex><span><span style=color:#66d9ef>except</span> Error <span style=color:#66d9ef>as</span> error:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span></code></pre></div><h2 id=5-全局变量>5. 全局变量<a hidden class=anchor aria-hidden=true href=#5-全局变量>#</a></h2><p>避免使用全局变量, 用类变量来代替. 但也有一些例外:</p><ol><li>脚本的默认选项.</li><li>模块级常量. 例如:　PI = 3.14159. 常量应该全大写, 用下划线连接.</li><li>有时候用全局变量来缓存值或者作为函数返回值很有用.</li><li>如果需要, 全局变量应该仅在模块内部可用, 并通过模块级的公共函数来访问.</li></ol><h2 id=6-嵌套局部内部类或函数>6. 嵌套/局部/内部类或函数<a hidden class=anchor aria-hidden=true href=#6-嵌套局部内部类或函数>#</a></h2><p>鼓励使用嵌套/本地/内部类或函数</p><p>类可以定义在方法, 函数或者类中. 函数可以定义在方法或函数中. 封闭区间中定义的变量对嵌套函数是只读的.</p><p>嵌套类或局部类的实例不能序列化(pickled).</p><h2 id=6-列表推导>6. 列表推导<a hidden class=anchor aria-hidden=true href=#6-列表推导>#</a></h2><p>适用于简单情况. 每个部分应该单独置于一行: 映射表达式, for语句, 过滤器表达式. 禁止多重for语句或过滤器表达式. 复杂情况下还是使用循环.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>Yes:
</span></span><span style=display:flex><span>  result <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> x <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>10</span>):
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> y <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>5</span>):
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> x <span style=color:#f92672>*</span> y <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>10</span>:
</span></span><span style=display:flex><span>              result<span style=color:#f92672>.</span>append((x, y))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> x <span style=color:#f92672>in</span> xrange(<span style=color:#ae81ff>5</span>):
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> y <span style=color:#f92672>in</span> xrange(<span style=color:#ae81ff>5</span>):
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> x <span style=color:#f92672>!=</span> y:
</span></span><span style=display:flex><span>              <span style=color:#66d9ef>for</span> z <span style=color:#f92672>in</span> xrange(<span style=color:#ae81ff>5</span>):
</span></span><span style=display:flex><span>                  <span style=color:#66d9ef>if</span> y <span style=color:#f92672>!=</span> z:
</span></span><span style=display:flex><span>                      <span style=color:#66d9ef>yield</span> (x, y, z)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> ((x, complicated_transform(x))
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>for</span> x <span style=color:#f92672>in</span> long_generator_function(parameter)
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> x <span style=color:#f92672>is</span> <span style=color:#f92672>not</span> <span style=color:#66d9ef>None</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  squares <span style=color:#f92672>=</span> [x <span style=color:#f92672>*</span> x <span style=color:#66d9ef>for</span> x <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>10</span>)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  eat(jelly_bean <span style=color:#66d9ef>for</span> jelly_bean <span style=color:#f92672>in</span> jelly_beans
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> jelly_bean<span style=color:#f92672>.</span>color <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;black&#39;</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>No:
</span></span><span style=display:flex><span>  result <span style=color:#f92672>=</span> [(x, y) <span style=color:#66d9ef>for</span> x <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>10</span>) <span style=color:#66d9ef>for</span> y <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>5</span>) <span style=color:#66d9ef>if</span> x <span style=color:#f92672>*</span> y <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>10</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> ((x, y, z)
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>for</span> x <span style=color:#f92672>in</span> xrange(<span style=color:#ae81ff>5</span>)
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>for</span> y <span style=color:#f92672>in</span> xrange(<span style=color:#ae81ff>5</span>)
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> x <span style=color:#f92672>!=</span> y
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>for</span> z <span style=color:#f92672>in</span> xrange(<span style=color:#ae81ff>5</span>)
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> y <span style=color:#f92672>!=</span> z)
</span></span></code></pre></div><h2 id=7-默认迭代器和操作符>7. 默认迭代器和操作符<a hidden class=anchor aria-hidden=true href=#7-默认迭代器和操作符>#</a></h2><p>如果类型支持, 就使用默认迭代器和操作符, 例如列表, 字典和文件. 内建类型也定义了迭代器方法. 优先考虑这些方法, 而不是那些返回列表的方法. 当然，这样遍历容器时，你将不能修改容器.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>Yes:  <span style=color:#66d9ef>for</span> key <span style=color:#f92672>in</span> adict: <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> key <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> adict: <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> obj <span style=color:#f92672>in</span> alist: <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> afile: <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> k, v <span style=color:#f92672>in</span> dict<span style=color:#f92672>.</span>iteritems(): <span style=color:#f92672>...</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>No:   <span style=color:#66d9ef>for</span> key <span style=color:#f92672>in</span> adict<span style=color:#f92672>.</span>keys(): <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> adict<span style=color:#f92672>.</span>has_key(key): <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> afile<span style=color:#f92672>.</span>readlines(): <span style=color:#f92672>...</span>
</span></span></code></pre></div><h2 id=8-生成器>8. 生成器<a hidden class=anchor aria-hidden=true href=#8-生成器>#</a></h2><p>所谓生成器函数, 就是每当它执行一次生成(yield)语句, 它就返回一个迭代器, 这个迭代器生成一个值. 生成值后, 生成器函数的运行状态将被挂起, 直到下一次生成.</p><p>鼓励使用. 注意在生成器函数的文档字符串中使用”Yields:”而不是”Returns:”.</p><h2 id=9-lambda函数>9. Lambda函数<a hidden class=anchor aria-hidden=true href=#9-lambda函数>#</a></h2><p>适用于单行函数. 如果代码超过60-80个字符, 最好还是定义成常规(嵌套)函数.</p><p>对于常见的操作符，例如乘法操作符，使用 <code>operator</code> 模块中的函数以代替lambda函数. 例如, 推荐使用 <code>operator.mul</code> , 而不是 <code>lambda x, y: x * y</code> .</p><h2 id=10-条件表达式>10. 条件表达式<a hidden class=anchor aria-hidden=true href=#10-条件表达式>#</a></h2><p>适用于单行函数. 在其他情况下，推荐使用完整的if语句.</p><h2 id=11-默认参数值>11. 默认参数值<a hidden class=anchor aria-hidden=true href=#11-默认参数值>#</a></h2><p>鼓励使用, 不过有如下注意事项:</p><p>不要在函数或方法定义中使用可变对象作为默认值.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>Yes: <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>foo</span>(a, b<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>):
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>if</span> b <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>             b <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>No:  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>foo</span>(a, b<span style=color:#f92672>=</span>[]):
</span></span><span style=display:flex><span>         <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>No:  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>foo</span>(a, b<span style=color:#f92672>=</span>time<span style=color:#f92672>.</span>time()):  <span style=color:#75715e># The time the module was loaded???</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>No:  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>foo</span>(a, b<span style=color:#f92672>=</span>FLAGS<span style=color:#f92672>.</span>my_thing):  <span style=color:#75715e># sys.argv has not yet been parsed...</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>...</span>
</span></span></code></pre></div><h2 id=12-属性>12. 属性<a hidden class=anchor aria-hidden=true href=#12-属性>#</a></h2><p>你通常习惯于使用访问或设置方法来访问或设置数据, 它们简单而轻量. 不过我们建议你在新的代码中使用属性. 只读属性应该用 <code>@property</code> 装饰器 来创建.</p><p>如果子类没有覆盖属性, 那么属性的继承可能看上去不明显. 因此使用者必须确保访问方法间接被调用, 以保证子类中的重载方法被属性调用(使用模板方法设计模式).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>Yes: <span style=color:#f92672>import</span> math
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Square</span>(object):
</span></span><span style=display:flex><span>         <span style=color:#e6db74>&#34;&#34;&#34;A square with two properties: a writable area and a read-only perimeter.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>         To use:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>         &gt;&gt;&gt; sq = Square(3)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>         &gt;&gt;&gt; sq.area
</span></span></span><span style=display:flex><span><span style=color:#e6db74>         9
</span></span></span><span style=display:flex><span><span style=color:#e6db74>         &gt;&gt;&gt; sq.perimeter
</span></span></span><span style=display:flex><span><span style=color:#e6db74>         12
</span></span></span><span style=display:flex><span><span style=color:#e6db74>         &gt;&gt;&gt; sq.area = 16
</span></span></span><span style=display:flex><span><span style=color:#e6db74>         &gt;&gt;&gt; sq.side
</span></span></span><span style=display:flex><span><span style=color:#e6db74>         4
</span></span></span><span style=display:flex><span><span style=color:#e6db74>         &gt;&gt;&gt; sq.perimeter
</span></span></span><span style=display:flex><span><span style=color:#e6db74>         16
</span></span></span><span style=display:flex><span><span style=color:#e6db74>         &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>def</span> __init__(self, side):
</span></span><span style=display:flex><span>             self<span style=color:#f92672>.</span>side <span style=color:#f92672>=</span> side
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__get_area</span>(self):
</span></span><span style=display:flex><span>             <span style=color:#e6db74>&#34;&#34;&#34;Calculates the &#39;area&#39; property.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>             <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>side <span style=color:#f92672>**</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>___get_area</span>(self):
</span></span><span style=display:flex><span>             <span style=color:#e6db74>&#34;&#34;&#34;Indirect accessor for &#39;area&#39; property.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>             <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>__get_area()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__set_area</span>(self, area):
</span></span><span style=display:flex><span>             <span style=color:#e6db74>&#34;&#34;&#34;Sets the &#39;area&#39; property.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>             self<span style=color:#f92672>.</span>side <span style=color:#f92672>=</span> math<span style=color:#f92672>.</span>sqrt(area)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>___set_area</span>(self, area):
</span></span><span style=display:flex><span>             <span style=color:#e6db74>&#34;&#34;&#34;Indirect setter for &#39;area&#39; property.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>             self<span style=color:#f92672>.</span>_SetArea(area)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>         area <span style=color:#f92672>=</span> property(___get_area, ___set_area,
</span></span><span style=display:flex><span>                         doc<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;&#34;Gets or sets the area of the square.&#34;&#34;&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>         <span style=color:#a6e22e>@property</span>
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>perimeter</span>(self):
</span></span><span style=display:flex><span>             <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>side <span style=color:#f92672>*</span> <span style=color:#ae81ff>4</span>
</span></span></code></pre></div><h2 id=13-truefalse的求值>13. True/False的求值<a hidden class=anchor aria-hidden=true href=#13-truefalse的求值>#</a></h2><p>尽可能使用隐式的false, 例如: 使用 <code>if foo:</code> 而不是 <code>if foo != []:</code> . 不过还是有一些注意事项需要你铭记在心:</p><ol><li><p>永远不要用==或者!=来比较单件, 比如None. 使用is或者is not.</p></li><li><p>注意: 当你写下 <code>if x:</code> 时, 你其实表示的是 <code>if x is not None</code> . 例如: 当你要测试一个默认值是None的变量或参数是否被设为其它值. 这个值在布尔语义下可能是false!</p></li><li><p>永远不要用==将一个布尔量与false相比较. 使用 <code>if not x:</code> 代替. 如果你需要区分false和None, 你应该用像 <code>if not x and x is not None:</code> 这样的语句.</p></li><li><p>对于序列(字符串, 列表, 元组), 要注意空序列是false. 因此 <code>if not seq:</code> 或者 <code>if seq:</code> 比 <code>if len(seq):</code> 或 <code>if not len(seq):</code> 要更好.</p></li><li><p>处理整数时, 使用隐式false可能会得不偿失(即不小心将None当做0来处理). 你可以将一个已知是整型(且不是len()的返回结果)的值与0比较.</p></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>Yes: <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> users:
</span></span><span style=display:flex><span>         print <span style=color:#e6db74>&#39;no users&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>if</span> foo <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>         self<span style=color:#f92672>.</span>handle_zero()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>if</span> i <span style=color:#f92672>%</span> <span style=color:#ae81ff>10</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>         self<span style=color:#f92672>.</span>handle_multiple_of_ten()
</span></span><span style=display:flex><span>No:  <span style=color:#66d9ef>if</span> len(users) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>         print <span style=color:#e6db74>&#39;no users&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>if</span> foo <span style=color:#f92672>is</span> <span style=color:#f92672>not</span> <span style=color:#66d9ef>None</span> <span style=color:#f92672>and</span> <span style=color:#f92672>not</span> foo:
</span></span><span style=display:flex><span>         self<span style=color:#f92672>.</span>handle_zero()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> i <span style=color:#f92672>%</span> <span style=color:#ae81ff>10</span>:
</span></span><span style=display:flex><span>         self<span style=color:#f92672>.</span>handle_multiple_of_ten()
</span></span></code></pre></div><ol start=6><li>注意‘0’(字符串)会被当做true.</li></ol><h2 id=14-词法作用域>14. 词法作用域<a hidden class=anchor aria-hidden=true href=#14-词法作用域>#</a></h2><p>嵌套的Python函数可以引用外层函数中定义的变量, 但是不能够对它们赋值. 变量绑定的解析是使用词法作用域, 也就是基于静态的程序文本. 对一个块中的某个名称的任何赋值都会导致Python将对该名称的全部引用当做局部变量, 甚至是赋值前的处理. 如果碰到global声明, 该名称就会被视作全局变量.</p><p>一个使用这个特性的例子:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_adder</span>(summand1):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;Returns a function that adds numbers to a given number.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>adder</span>(summand2):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> summand1 <span style=color:#f92672>+</span> summand2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> adder
</span></span></code></pre></div><p>(译者注: 这个例子有点诡异, 你应该这样使用这个函数: <code>sum = get_adder(summand1)(summand2)</code> )</p><h2 id=15-函数与方法装饰器>15. 函数与方法装饰器<a hidden class=anchor aria-hidden=true href=#15-函数与方法装饰器>#</a></h2><p>用于函数及方法的装饰器 (也就是@标记). 最常见的装饰器是@classmethod 和@staticmethod, 用于将常规函数转换成类方法或静态方法. 不过, 装饰器语法也允许用户自定义装饰器. 特别地, 对于某个函数 <code>my_decorator</code> , 下面的两段代码是等效的:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>C</span>(object):
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>@my_decorator</span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>method</span>(self):
</span></span><span style=display:flex><span>       <span style=color:#75715e># method body ...</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>C</span>(object):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>method</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#75715e># method body ...</span>
</span></span><span style=display:flex><span>    method <span style=color:#f92672>=</span> my_decorator(method)
</span></span></code></pre></div><h2 id=16-线程>16. 线程<a hidden class=anchor aria-hidden=true href=#16-线程>#</a></h2><p>虽然Python的内建类型例如字典看上去拥有原子操作, 但是在某些情形下它们仍然不是原子的(即: 如果__hash__或__eq__被实现为Python方法)且它们的原子性是靠不住的. 你也不能指望原子变量赋值(因为这个反过来依赖字典).</p><p>优先使用Queue模块的 <code>Queue</code> 数据类型作为线程间的数据通信方式. 另外, 使用threading模块及其锁原语(locking primitives). 了解条件变量的合适使用方式, 这样你就可以使用 <code>threading.Condition</code> 来取代低级别的锁了.</p><h2 id=参考>参考：<a hidden class=anchor aria-hidden=true href=#参考>#</a></h2><ol><li><a href=https://zh-google-styleguide.readthedocs.io/en/latest/google-python-styleguide/python_language_rules/>Google Python语言规范</a></li></ol></div><footer class=post-footer><ul class=post-tags><li><a href=https://zhoutao822.github.io/tags/python/>Python</a></li><li><a href=https://zhoutao822.github.io/tags/pylint/>Pylint</a></li></ul><nav class=paginav><a class=prev href=https://zhoutao822.github.io/posts/python_style_rules/><span class=title>« Prev Page</span><br><span>Python风格规范</span></a>
<a class=next href=https://zhoutao822.github.io/posts/bottomsheetdialog/><span class=title>Next Page »</span><br><span>BottomSheetDialog</span></a></nav></footer><script src=https://utteranc.es/client.js repo=zhoutao822/zhoutao822.github.io issue-term=title theme=github-dark crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2022 <a href=https://zhoutao822.github.io/>Tao's Notes</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>