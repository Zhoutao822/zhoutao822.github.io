<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Android-共享元素动画效果 | Tao's Notes</title><meta name=keywords content="ShareElement"><meta name=description content="共享元素可以在Activity之间或者Fragment之间实现非常舒适的动画效果，如下图所示，特别是在跳转的界面之间拥有相同的界面元素，比如同一张图片但是大小不同，同一个View但是位置不同。需要注意的是最低api需要为21，即Android LOLLIPOP。"><meta name=author content="Me"><link rel=canonical href=https://zhoutao822.github.io/posts/shareelement/><meta name=google-site-verification content="Tao"><meta name=yandex-verification content="Tao"><meta name=msvalidate.01 content="Tao"><link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://zhoutao822.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://zhoutao822.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://zhoutao822.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://zhoutao822.github.io/apple-touch-icon.png><link rel=mask-icon href=https://zhoutao822.github.io/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.103.1"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Android-共享元素动画效果"><meta property="og:description" content="共享元素可以在Activity之间或者Fragment之间实现非常舒适的动画效果，如下图所示，特别是在跳转的界面之间拥有相同的界面元素，比如同一张图片但是大小不同，同一个View但是位置不同。需要注意的是最低api需要为21，即Android LOLLIPOP。"><meta property="og:type" content="article"><meta property="og:url" content="https://zhoutao822.github.io/posts/shareelement/"><meta property="og:image" content="https://zhoutao822.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-01-11T21:30:27+08:00"><meta property="article:modified_time" content="2020-01-11T21:30:27+08:00"><meta property="og:site_name" content="Tao's Notes"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://zhoutao822.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Android-共享元素动画效果"><meta name=twitter:description content="共享元素可以在Activity之间或者Fragment之间实现非常舒适的动画效果，如下图所示，特别是在跳转的界面之间拥有相同的界面元素，比如同一张图片但是大小不同，同一个View但是位置不同。需要注意的是最低api需要为21，即Android LOLLIPOP。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://zhoutao822.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Android-共享元素动画效果","item":"https://zhoutao822.github.io/posts/shareelement/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Android-共享元素动画效果","name":"Android-共享元素动画效果","description":"共享元素可以在Activity之间或者Fragment之间实现非常舒适的动画效果，如下图所示，特别是在跳转的界面之间拥有相同的界面元素，比如同一张图片但是大小不同，同一个View但是位置不同。需要注意的是最低api需要为21，即Android LOLLIPOP。","keywords":["ShareElement"],"articleBody":"共享元素可以在Activity之间或者Fragment之间实现非常舒适的动画效果，如下图所示，特别是在跳转的界面之间拥有相同的界面元素，比如同一张图片但是大小不同，同一个View但是位置不同。需要注意的是最低api需要为21，即Android LOLLIPOP。\n1. Fragment之间共享元素 首先实现在Fragment之间的共享元素动画，因为Fragment可能比Activity更加常用，这两者实现的代码略有区别，而且在我的测试过程中还发现了部分奇怪的问题。\n1.1 简单使用 首先创建两个Fragment，定义各自布局，关键是两个布局中需要共享的元素需要指定一个属性android:transitionName，可以是任何自定义的字符串，其中Fragment1中的共享元素的transitionName可以与Fragment2中的共享元素不同，但是必须要设置（通过xml或者setTransitionName方法），否则会报错。\n// Fragment1.java public class Fragment1 extends Fragment { private static final String ARG_PARAM1 = \"param1\"; private static final String ARG_PARAM2 = \"param2\"; private static final String TAG = Fragment1.class.getSimpleName(); private TextView textView; // Fragment默认生成的实例化方法，参数这里没有用到，无所谓 public static Fragment1 newInstance(String param1, String param2) { Fragment1 fragment = new Fragment1(); Bundle args = new Bundle(); args.putString(ARG_PARAM1, param1); args.putString(ARG_PARAM2, param2); fragment.setArguments(args); return fragment; } @Override public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) { super.onViewCreated(view, savedInstanceState); // 我们仅在Fragment中显示一个TextView textView = view.findViewById(R.id.textView1); textView.setOnClickListener(new View.OnClickListener() { @Override public void onClick(View view) { // 点击跳转到Fragment2，同理参数不重要 Fragment2 destination = Fragment2.newInstance(\"1\", \"2\"); if (Build.VERSION.SDK_INT \u003e= Build.VERSION_CODES.LOLLIPOP) { // 定义共享元素的动画效果 // setSharedElementEnterTransition以及setSharedElementReturnTransition分别设置 // 共享元素的动画效果，在目的地Fragment调用Enter方法，当前Fragment调用Return方法，否则 // 无效，系统提供了一些动画效果，比如move、fade等等，可以直接使用，也可以通过继承 // TransitionSet实现自定义动画效果 destination.setSharedElementEnterTransition(TransitionInflater.from(getContext()).inflateTransition(android.R.transition.move)); setSharedElementReturnTransition(TransitionInflater.from(getContext()).inflateTransition(android.R.transition.move)); // setEnterTransition和setExitTransition设置除了共享元素之外其他View的动画效果 // 一般来说仅需要设置目的地Fragment的Enter效果和当前Fragment的Exit效果，同样系统 // 也提供比如Fade之类的效果 destination.setEnterTransition(new Fade()); setExitTransition(new Fade()); } if (getFragmentManager() != null) { getFragmentManager() .beginTransaction() // 在切换Fragment时调用addSharedElement方法，标记我们的共享元素，参数为共享元素 // 对象以及Fragment2中的共享元素的transitionName，可以写死，需要注意的是，这里传入 // 的transitionName需要与Fragment2中的共享元素相同。以我们的代码为例，只有在两个布 // 局中共享元素transitionName相同时才可以使用ViewCompat.getTransitionName方法获取 .addSharedElement(textView, Objects.requireNonNull(ViewCompat.getTransitionName(textView))) .addToBackStack(TAG) .replace(R.id.container, destination) .commit(); } } }); } @Nullable @Override public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) { return inflater.inflate(R.layout.layout1, container, false); } } // Fragment2.java Fragment2没有加入任何效果，仅显示我们需要的布局 public class Fragment2 extends Fragment { private static final String ARG_PARAM1 = \"param1\"; private static final String ARG_PARAM2 = \"param2\"; public static Fragment2 newInstance(String param1, String param2) { Fragment2 fragment = new Fragment2(); Bundle args = new Bundle(); args.putString(ARG_PARAM1, param1); args.putString(ARG_PARAM2, param2); fragment.setArguments(args); return fragment; } @Nullable @Override public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) { return inflater.inflate(R.layout.layout2, container, false); } } 对应的两个布局文件，两者的区别仅仅是layout1中TextView有上边距，android:transitionName=\"textView\"相同（可以不同，因为Fragment1中的transitionName并不重要）\n\u003c?xml version=\"1.0\" encoding=\"utf-8\"?\u003e ","wordCount":"2366","inLanguage":"en","datePublished":"2020-01-11T21:30:27+08:00","dateModified":"2020-01-11T21:30:27+08:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhoutao822.github.io/posts/shareelement/"},"publisher":{"@type":"Organization","name":"Tao's Notes","logo":{"@type":"ImageObject","url":"https://zhoutao822.github.io/favicon.ico"}}}</script></head><body class=dark id=top><header class=header><nav class=nav><div class=logo><a href=https://zhoutao822.github.io/ accesskey=h title="Home (Alt + H)">Home</a>
<span class=logo-switches></span></div><ul id=menu><li><a href=https://zhoutao822.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://zhoutao822.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://zhoutao822.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://zhoutao822.github.io/series/ title=Series><span>Series</span></a></li><li><a href=https://zhoutao822.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://zhoutao822.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://zhoutao822.github.io/posts/>Posts</a></div><h1 class=post-title>Android-共享元素动画效果</h1><div class=post-meta><span title='2020-01-11 21:30:27 +0800 +0800'>January 11, 2020</span>&nbsp;·&nbsp;12 min&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/Zhoutao822/zhoutao822.github.io/tree/main/content//posts/ShareElement.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#1-fragment%e4%b9%8b%e9%97%b4%e5%85%b1%e4%ba%ab%e5%85%83%e7%b4%a0 aria-label="1. Fragment之间共享元素">1. Fragment之间共享元素</a><ul><li><a href=#11-%e7%ae%80%e5%8d%95%e4%bd%bf%e7%94%a8 aria-label="1.1 简单使用">1.1 简单使用</a></li><li><a href=#12-recyclerview%e4%bb%a5%e5%8f%8a%e5%9b%be%e7%89%87%e7%bc%a9%e6%94%be%e6%95%88%e6%9e%9c aria-label="1.2 RecyclerView以及图片缩放效果">1.2 RecyclerView以及图片缩放效果</a></li></ul></li><li><a href=#2-activity%e4%b9%8b%e9%97%b4%e5%85%b1%e4%ba%ab%e5%85%83%e7%b4%a0 aria-label="2. Activity之间共享元素">2. Activity之间共享元素</a><ul><li><a href=#21-%e7%ae%80%e5%8d%95%e4%bd%bf%e7%94%a8 aria-label="2.1 简单使用">2.1 简单使用</a></li><li><a href=#22-recyclerview%e5%a4%8d%e6%9d%82%e6%95%88%e6%9e%9c aria-label="2.2 RecyclerView复杂效果">2.2 RecyclerView复杂效果</a></li></ul></li><li><a href=#3-%e5%a4%8d%e6%9d%82%e6%95%88%e6%9e%9c%e7%9a%84%e4%bc%98%e5%8c%96 aria-label="3. 复杂效果的优化">3. 复杂效果的优化</a><ul><li><a href=#31-%e6%95%88%e6%9e%9c%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90 aria-label="3.1 效果实现分析">3.1 效果实现分析</a></li><li><a href=#32-%e5%9c%a8fragment%e4%b8%ad%e5%ae%9e%e7%8e%b0%e7%b1%bb%e4%bc%bc%e6%95%88%e6%9e%9c aria-label="3.2 在Fragment中实现类似效果">3.2 在Fragment中实现类似效果</a></li></ul></li><li><a href=#4-%e4%bd%bf%e7%94%a8%e6%8a%80%e5%b7%a7%e6%80%bb%e7%bb%93 aria-label="4. 使用技巧总结">4. 使用技巧总结</a></li><li><a href=#%e5%8f%82%e8%80%83 aria-label=参考：>参考：</a></li></ul></div></details></div><div class=post-content><p>共享元素可以在Activity之间或者Fragment之间实现非常舒适的动画效果，如下图所示，特别是在跳转的界面之间拥有相同的界面元素，比如同一张图片但是大小不同，同一个View但是位置不同。需要注意的是最低api需要为21，即Android LOLLIPOP。</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/Zhoutao822/hugo-pic/pictures/cat.gif alt=cat></p><h2 id=1-fragment之间共享元素>1. Fragment之间共享元素<a hidden class=anchor aria-hidden=true href=#1-fragment之间共享元素>#</a></h2><p>首先实现在Fragment之间的共享元素动画，因为Fragment可能比Activity更加常用，这两者实现的代码略有区别，而且在我的测试过程中还发现了部分奇怪的问题。</p><h3 id=11-简单使用>1.1 简单使用<a hidden class=anchor aria-hidden=true href=#11-简单使用>#</a></h3><p>首先创建两个Fragment，定义各自布局，关键是两个布局中需要共享的元素需要指定一个属性<code>android:transitionName</code>，可以是任何自定义的字符串，其中Fragment1中的共享元素的<code>transitionName</code>可以与Fragment2中的共享元素不同，但是必须要设置（通过xml或者<code>setTransitionName</code>方法），否则会报错。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// Fragment1.java
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Fragment1</span> <span style=color:#66d9ef>extends</span> Fragment <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> String ARG_PARAM1 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;param1&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> String ARG_PARAM2 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;param2&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> String TAG <span style=color:#f92672>=</span> Fragment1<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getSimpleName</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> TextView textView<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Fragment默认生成的实例化方法，参数这里没有用到，无所谓
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> Fragment1 <span style=color:#a6e22e>newInstance</span><span style=color:#f92672>(</span>String param1<span style=color:#f92672>,</span> String param2<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        Fragment1 fragment <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Fragment1<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        Bundle args <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Bundle<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        args<span style=color:#f92672>.</span><span style=color:#a6e22e>putString</span><span style=color:#f92672>(</span>ARG_PARAM1<span style=color:#f92672>,</span> param1<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        args<span style=color:#f92672>.</span><span style=color:#a6e22e>putString</span><span style=color:#f92672>(</span>ARG_PARAM2<span style=color:#f92672>,</span> param2<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        fragment<span style=color:#f92672>.</span><span style=color:#a6e22e>setArguments</span><span style=color:#f92672>(</span>args<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> fragment<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onViewCreated</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> View view<span style=color:#f92672>,</span> <span style=color:#a6e22e>@Nullable</span> Bundle savedInstanceState<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>onViewCreated</span><span style=color:#f92672>(</span>view<span style=color:#f92672>,</span> savedInstanceState<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 我们仅在Fragment中显示一个TextView
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        textView <span style=color:#f92672>=</span> view<span style=color:#f92672>.</span><span style=color:#a6e22e>findViewById</span><span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>textView1</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        textView<span style=color:#f92672>.</span><span style=color:#a6e22e>setOnClickListener</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> View<span style=color:#f92672>.</span><span style=color:#a6e22e>OnClickListener</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onClick</span><span style=color:#f92672>(</span>View view<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>// 点击跳转到Fragment2，同理参数不重要
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                Fragment2 destination <span style=color:#f92672>=</span> Fragment2<span style=color:#f92672>.</span><span style=color:#a6e22e>newInstance</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;1&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;2&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>Build<span style=color:#f92672>.</span><span style=color:#a6e22e>VERSION</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SDK_INT</span> <span style=color:#f92672>&gt;=</span> Build<span style=color:#f92672>.</span><span style=color:#a6e22e>VERSION_CODES</span><span style=color:#f92672>.</span><span style=color:#a6e22e>LOLLIPOP</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#75715e>// 定义共享元素的动画效果
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    <span style=color:#75715e>// setSharedElementEnterTransition以及setSharedElementReturnTransition分别设置
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    <span style=color:#75715e>// 共享元素的动画效果，在目的地Fragment调用Enter方法，当前Fragment调用Return方法，否则
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    <span style=color:#75715e>// 无效，系统提供了一些动画效果，比如move、fade等等，可以直接使用，也可以通过继承
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    <span style=color:#75715e>// TransitionSet实现自定义动画效果
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    destination<span style=color:#f92672>.</span><span style=color:#a6e22e>setSharedElementEnterTransition</span><span style=color:#f92672>(</span>TransitionInflater<span style=color:#f92672>.</span><span style=color:#a6e22e>from</span><span style=color:#f92672>(</span>getContext<span style=color:#f92672>()).</span><span style=color:#a6e22e>inflateTransition</span><span style=color:#f92672>(</span>android<span style=color:#f92672>.</span><span style=color:#a6e22e>R</span><span style=color:#f92672>.</span><span style=color:#a6e22e>transition</span><span style=color:#f92672>.</span><span style=color:#a6e22e>move</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>                    setSharedElementReturnTransition<span style=color:#f92672>(</span>TransitionInflater<span style=color:#f92672>.</span><span style=color:#a6e22e>from</span><span style=color:#f92672>(</span>getContext<span style=color:#f92672>()).</span><span style=color:#a6e22e>inflateTransition</span><span style=color:#f92672>(</span>android<span style=color:#f92672>.</span><span style=color:#a6e22e>R</span><span style=color:#f92672>.</span><span style=color:#a6e22e>transition</span><span style=color:#f92672>.</span><span style=color:#a6e22e>move</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                    <span style=color:#75715e>// setEnterTransition和setExitTransition设置除了共享元素之外其他View的动画效果
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    <span style=color:#75715e>// 一般来说仅需要设置目的地Fragment的Enter效果和当前Fragment的Exit效果，同样系统
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    <span style=color:#75715e>// 也提供比如Fade之类的效果
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    destination<span style=color:#f92672>.</span><span style=color:#a6e22e>setEnterTransition</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> Fade<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>                    setExitTransition<span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> Fade<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>getFragmentManager<span style=color:#f92672>()</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    getFragmentManager<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>                            <span style=color:#f92672>.</span><span style=color:#a6e22e>beginTransaction</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>                            <span style=color:#75715e>// 在切换Fragment时调用addSharedElement方法，标记我们的共享元素，参数为共享元素
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                            <span style=color:#75715e>// 对象以及Fragment2中的共享元素的transitionName，可以写死，需要注意的是，这里传入
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                            <span style=color:#75715e>// 的transitionName需要与Fragment2中的共享元素相同。以我们的代码为例，只有在两个布
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                            <span style=color:#75715e>// 局中共享元素transitionName相同时才可以使用ViewCompat.getTransitionName方法获取
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                            <span style=color:#f92672>.</span><span style=color:#a6e22e>addSharedElement</span><span style=color:#f92672>(</span>textView<span style=color:#f92672>,</span> Objects<span style=color:#f92672>.</span><span style=color:#a6e22e>requireNonNull</span><span style=color:#f92672>(</span>ViewCompat<span style=color:#f92672>.</span><span style=color:#a6e22e>getTransitionName</span><span style=color:#f92672>(</span>textView<span style=color:#f92672>)))</span>
</span></span><span style=display:flex><span>                            <span style=color:#f92672>.</span><span style=color:#a6e22e>addToBackStack</span><span style=color:#f92672>(</span>TAG<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                            <span style=color:#f92672>.</span><span style=color:#a6e22e>replace</span><span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>container</span><span style=color:#f92672>,</span> destination<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                            <span style=color:#f92672>.</span><span style=color:#a6e22e>commit</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Nullable</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> View <span style=color:#a6e22e>onCreateView</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> LayoutInflater inflater<span style=color:#f92672>,</span> <span style=color:#a6e22e>@Nullable</span> ViewGroup container<span style=color:#f92672>,</span> <span style=color:#a6e22e>@Nullable</span> Bundle savedInstanceState<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> inflater<span style=color:#f92672>.</span><span style=color:#a6e22e>inflate</span><span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>layout</span><span style=color:#f92672>.</span><span style=color:#a6e22e>layout1</span><span style=color:#f92672>,</span> container<span style=color:#f92672>,</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Fragment2.java Fragment2没有加入任何效果，仅显示我们需要的布局
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Fragment2</span> <span style=color:#66d9ef>extends</span> Fragment <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> String ARG_PARAM1 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;param1&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> String ARG_PARAM2 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;param2&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> Fragment2 <span style=color:#a6e22e>newInstance</span><span style=color:#f92672>(</span>String param1<span style=color:#f92672>,</span> String param2<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        Fragment2 fragment <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Fragment2<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        Bundle args <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Bundle<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        args<span style=color:#f92672>.</span><span style=color:#a6e22e>putString</span><span style=color:#f92672>(</span>ARG_PARAM1<span style=color:#f92672>,</span> param1<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        args<span style=color:#f92672>.</span><span style=color:#a6e22e>putString</span><span style=color:#f92672>(</span>ARG_PARAM2<span style=color:#f92672>,</span> param2<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        fragment<span style=color:#f92672>.</span><span style=color:#a6e22e>setArguments</span><span style=color:#f92672>(</span>args<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> fragment<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Nullable</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> View <span style=color:#a6e22e>onCreateView</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> LayoutInflater inflater<span style=color:#f92672>,</span> <span style=color:#a6e22e>@Nullable</span> ViewGroup container<span style=color:#f92672>,</span> <span style=color:#a6e22e>@Nullable</span> Bundle savedInstanceState<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> inflater<span style=color:#f92672>.</span><span style=color:#a6e22e>inflate</span><span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>layout</span><span style=color:#f92672>.</span><span style=color:#a6e22e>layout2</span><span style=color:#f92672>,</span> container<span style=color:#f92672>,</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>对应的两个布局文件，两者的区别仅仅是layout1中TextView有上边距，<code>android:transitionName="textView"</code>相同（可以不同，因为Fragment1中的transitionName并不重要）</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!-- layout1.xml --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;LinearLayout</span> <span style=color:#a6e22e>xmlns:android=</span><span style=color:#e6db74>&#34;http://schemas.android.com/apk/res/android&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:orientation=</span><span style=color:#e6db74>&#34;horizontal&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;TextView</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/textView1&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_marginTop=</span><span style=color:#e6db74>&#34;200dp&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:text=</span><span style=color:#e6db74>&#34;qqqqqqqqqqqq&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:textSize=</span><span style=color:#e6db74>&#34;24sp&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:transitionName=</span><span style=color:#e6db74>&#34;textView&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/LinearLayout&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!-- layout2.xml --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;LinearLayout</span> <span style=color:#a6e22e>xmlns:android=</span><span style=color:#e6db74>&#34;http://schemas.android.com/apk/res/android&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:orientation=</span><span style=color:#e6db74>&#34;horizontal&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;TextView</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/textView2&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:text=</span><span style=color:#e6db74>&#34;qqqqqqqqqqqq&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:textSize=</span><span style=color:#e6db74>&#34;24sp&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:transitionName=</span><span style=color:#e6db74>&#34;textView&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/LinearLayout&gt;</span>
</span></span></code></pre></div><p>效果如下</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/Zhoutao822/hugo-pic/pictures/share1.gif alt=share1></p><p>当然我们实际应用中不会使用如此简单的布局，此时我仅仅修改layout2，增加一个ImageView，那么就会出现一个奇怪的Bug现象</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;LinearLayout</span> <span style=color:#a6e22e>xmlns:android=</span><span style=color:#e6db74>&#34;http://schemas.android.com/apk/res/android&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:orientation=</span><span style=color:#e6db74>&#34;horizontal&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;LinearLayout</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:orientation=</span><span style=color:#e6db74>&#34;horizontal&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;ImageView</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;40dp&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;40dp&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:background=</span><span style=color:#e6db74>&#34;@color/colorPrimary&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:src=</span><span style=color:#e6db74>&#34;@drawable/ic_launcher_foreground&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;TextView</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/textView2&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:text=</span><span style=color:#e6db74>&#34;qqqqqqqqqqqq&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:textSize=</span><span style=color:#e6db74>&#34;24sp&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:transitionName=</span><span style=color:#e6db74>&#34;textView&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/LinearLayout&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/LinearLayout&gt;</span>
</span></span></code></pre></div><p>如下图所示，从Fragment1跳转到Fragment2时，TextView并没有按照轨迹移动，而实突然出现在顶部，但是返回时TextView按照轨迹移动，而我仅仅只是增加了一点布局。</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/Zhoutao822/hugo-pic/pictures/share2.gif alt=share2></p><p>更加奇怪的是如果上述布局layout2中，设置第二层LinearLayout的<code>android:layout_marginTop="1dp"</code>，那么又可以正常按照轨迹移动了，这里就不截图了。也就是说如果在实际应用过程中出现这样的显示效果问题，可以通过设置<code>layout_marginTop</code>来避免，但是可能会有1dp的显示问题。</p><h3 id=12-recyclerview以及图片缩放效果>1.2 RecyclerView以及图片缩放效果<a hidden class=anchor aria-hidden=true href=#12-recyclerview以及图片缩放效果>#</a></h3><p>具体可以参考<a href=https://github.com/bherbst/FragmentTransitionSample>FragmentTransitionSample</a>，其中还包括自定义TransitionSet的实现。需要注意的是，在RecyclerView中添加<code>transitionName</code>的方式</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// 这里对应了上面说到的问题，Fragment1中的transitionName不重要，仅仅需要让它们的transitionName唯一即可，
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 否则会出现显示其他图片的异常
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>ViewCompat<span style=color:#f92672>.</span><span style=color:#a6e22e>setTransitionName</span><span style=color:#f92672>(</span>viewHolder<span style=color:#f92672>.</span><span style=color:#a6e22e>image</span><span style=color:#f92672>,</span> position <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;_image&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>getActivity<span style=color:#f92672>().</span><span style=color:#a6e22e>getSupportFragmentManager</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>.</span><span style=color:#a6e22e>beginTransaction</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 只要最终addSharedElement方法添加的transitionName与Fragment2相同即可
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>.</span><span style=color:#a6e22e>addSharedElement</span><span style=color:#f92672>(</span>holder<span style=color:#f92672>.</span><span style=color:#a6e22e>image</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;kittenImage&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>.</span><span style=color:#a6e22e>replace</span><span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>container</span><span style=color:#f92672>,</span> kittenDetails<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>.</span><span style=color:#a6e22e>addToBackStack</span><span style=color:#f92672>(</span><span style=color:#66d9ef>null</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>.</span><span style=color:#a6e22e>commit</span><span style=color:#f92672>();</span>
</span></span></code></pre></div><h2 id=2-activity之间共享元素>2. Activity之间共享元素<a hidden class=anchor aria-hidden=true href=#2-activity之间共享元素>#</a></h2><p>从Fragment提供的方法可知，Fragment之间共享元素仅能实现一个View的动画，如果在一个界面中需要对多个View实现动画就只能在Activity中实现了。</p><h3 id=21-简单使用>2.1 简单使用<a hidden class=anchor aria-hidden=true href=#21-简单使用>#</a></h3><p>首先看看之前在Fragment中存在的问题是否会同样出现在Activity中。与Fragment不同的是，在Activity中启用共享元素需要提前配置一下Theme</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;style</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;AppTheme&#34;</span> <span style=color:#a6e22e>parent=</span><span style=color:#e6db74>&#34;Theme.AppCompat.Light.NoActionBar&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>&lt;!-- Customize your theme here. --&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;colorPrimary&#34;</span><span style=color:#f92672>&gt;</span>@color/colorPrimary<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;colorPrimaryDark&#34;</span><span style=color:#f92672>&gt;</span>@color/colorPrimaryDark<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;colorAccent&#34;</span><span style=color:#f92672>&gt;</span>@color/colorAccent<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>&lt;!-- windowContentTransitions也可以通过getWindow().requestFeature(Window.FEATURE_CONTENT_TRANSITIONS)动态控制 --&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;android:windowContentTransitions&#34;</span><span style=color:#f92672>&gt;</span>true<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>&lt;!-- 也可以通过getWindow().setExitTransition(new Fade())动态控制 --&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>&lt;!-- specify enter and exit transitions --&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;android:windowEnterTransition&#34;</span><span style=color:#f92672>&gt;</span>@android:transition/fade<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;android:windowExitTransition&#34;</span><span style=color:#f92672>&gt;</span>@android:transition/fade<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>&lt;!-- 也可以通过getWindow().setSharedElementEnterTransition()动态控制 --&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>&lt;!-- specify shared element transitions --&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;android:windowSharedElementEnterTransition&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        @android:transition/move
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;android:windowSharedElementExitTransition&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        @android:transition/move
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/style&gt;</span>
</span></span></code></pre></div><p>在Theme中控制和通过代码动态控制的区别是Theme是全局的设置，后续如果在代码中没有显示控制则会使用Theme的效果，动态控制的话可以对不同Activity设置不同的动画效果。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// FirstActivity.java
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FirstActivity</span> <span style=color:#66d9ef>extends</span> AppCompatActivity <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> TextView textView<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onCreate</span><span style=color:#f92672>(</span>Bundle savedInstanceState<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>onCreate</span><span style=color:#f92672>(</span>savedInstanceState<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        setContentView<span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>layout</span><span style=color:#f92672>.</span><span style=color:#a6e22e>activity_first</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        textView <span style=color:#f92672>=</span> findViewById<span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>text_1</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        textView<span style=color:#f92672>.</span><span style=color:#a6e22e>setOnClickListener</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> View<span style=color:#f92672>.</span><span style=color:#a6e22e>OnClickListener</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onClick</span><span style=color:#f92672>(</span>View view<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                Intent intent <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Intent<span style=color:#f92672>(</span>FirstActivity<span style=color:#f92672>.</span><span style=color:#a6e22e>this</span><span style=color:#f92672>,</span> SecondActivity<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>// 由于Activity是通过startActivity启动，所以使用makeSceneTransitionAnimation
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#75715e>// 同理，这里的transitionName为&#34;text&#34;，与SecondActivity相同，而且这里并没有设置
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#75715e>// FirstActivity的transitionName
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                ActivityOptionsCompat options <span style=color:#f92672>=</span> ActivityOptionsCompat<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>makeSceneTransitionAnimation</span><span style=color:#f92672>(</span>FirstActivity<span style=color:#f92672>.</span><span style=color:#a6e22e>this</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                                textView<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                                <span style=color:#e6db74>&#34;text&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                startActivity<span style=color:#f92672>(</span>intent<span style=color:#f92672>,</span> options<span style=color:#f92672>.</span><span style=color:#a6e22e>toBundle</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// SecondActivity.java
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SecondActivity</span> <span style=color:#66d9ef>extends</span> AppCompatActivity <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> TextView textView<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onCreate</span><span style=color:#f92672>(</span>Bundle savedInstanceState<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>onCreate</span><span style=color:#f92672>(</span>savedInstanceState<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        setContentView<span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>layout</span><span style=color:#f92672>.</span><span style=color:#a6e22e>activity_second</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        textView <span style=color:#f92672>=</span> findViewById<span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>text_2</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 动态设置transitionName
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        ViewCompat<span style=color:#f92672>.</span><span style=color:#a6e22e>setTransitionName</span><span style=color:#f92672>(</span>textView<span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;text&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>而且Fragmen中存在的动画效果异常的问题没有出现在Activity中</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!-- activity_first.xml --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;LinearLayout</span> <span style=color:#a6e22e>xmlns:android=</span><span style=color:#e6db74>&#34;http://schemas.android.com/apk/res/android&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:orientation=</span><span style=color:#e6db74>&#34;horizontal&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--    &lt;LinearLayout--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--        android:layout_width=&#34;match_parent&#34;--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--        android:layout_height=&#34;wrap_content&#34;&gt;--&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;TextView</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/text_1&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:layout_marginTop=</span><span style=color:#e6db74>&#34;200dp&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:text=</span><span style=color:#e6db74>&#34;aaaaaaaaaaaaaa&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:textSize=</span><span style=color:#e6db74>&#34;24sp&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--    &lt;/LinearLayout&gt;--&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/LinearLayout&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!-- activity_second.xml --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;LinearLayout</span> <span style=color:#a6e22e>xmlns:android=</span><span style=color:#e6db74>&#34;http://schemas.android.com/apk/res/android&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:orientation=</span><span style=color:#e6db74>&#34;horizontal&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;LinearLayout</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:orientation=</span><span style=color:#e6db74>&#34;horizontal&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;ImageView</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;40dp&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;40dp&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:background=</span><span style=color:#e6db74>&#34;@color/colorPrimary&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:src=</span><span style=color:#e6db74>&#34;@drawable/ic_launcher_foreground&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;TextView</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/text_2&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:text=</span><span style=color:#e6db74>&#34;aaaaaaaaaaaaaa&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:textSize=</span><span style=color:#e6db74>&#34;24sp&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/LinearLayout&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/LinearLayout&gt;</span>
</span></span></code></pre></div><p>具体效果如下，但是仔细观察可以发现存在问题，状态栏在动画过程中会闪烁</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/Zhoutao822/hugo-pic/pictures/share3.gif alt=share3></p><p>解决方法是指定状态栏或者其他控件不参加动画，原理是因为在动画过程中实际是通过一层windows ViewOverlay播放动画，这一层在包括了界面所有的View（状态栏也在其中），当我们指定动画时可以将状态栏的id排除出去就可以实现状态栏不参与动画，也就不会有闪烁的现象。</p><ul><li>Theme控制</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>// styles.xml
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!-- specify enter and exit transitions --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!-- 自定义fade.xml --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;android:windowEnterTransition&#34;</span><span style=color:#f92672>&gt;</span>@transition/fade<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;android:windowExitTransition&#34;</span><span style=color:#f92672>&gt;</span>@transition/fade<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>// fade.xml
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;transitionSet</span> <span style=color:#a6e22e>xmlns:android=</span><span style=color:#e6db74>&#34;http://schemas.android.com/apk/res/android&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;fade</span> <span style=color:#a6e22e>xmlns:android=</span><span style=color:#e6db74>&#34;http://schemas.android.com/apk/res/android&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;targets&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>&lt;!-- 可以设置statusBarBackground的id，也可以是我们自定义的控件的id，比如Toolbar --&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;target</span> <span style=color:#a6e22e>android:excludeId=</span><span style=color:#e6db74>&#34;@android:id/statusBarBackground&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;target</span> <span style=color:#a6e22e>android:excludeId=</span><span style=color:#e6db74>&#34;@android:id/navigationBarBackground&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--            &lt;target android:excludeId=&#34;@id/appBar&#34; /&gt;--&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/targets&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/fade&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/transitionSet&gt;</span>
</span></span></code></pre></div><ul><li>动态代码控制</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// 当前Activity设置Exit效果，目的地Activity设置Enter效果
</span></span></span><span style=display:flex><span><span style=color:#75715e>// FirstActivity.java
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>Fade fade <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Fade<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>fade<span style=color:#f92672>.</span><span style=color:#a6e22e>excludeTarget</span><span style=color:#f92672>(</span>android<span style=color:#f92672>.</span><span style=color:#a6e22e>R</span><span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>statusBarBackground</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>fade<span style=color:#f92672>.</span><span style=color:#a6e22e>excludeTarget</span><span style=color:#f92672>(</span>android<span style=color:#f92672>.</span><span style=color:#a6e22e>R</span><span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>navigationBarBackground</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>getWindow<span style=color:#f92672>().</span><span style=color:#a6e22e>setExitTransition</span><span style=color:#f92672>(</span>fade<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// SecondActivity.java
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>Fade fade <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Fade<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>fade<span style=color:#f92672>.</span><span style=color:#a6e22e>excludeTarget</span><span style=color:#f92672>(</span>android<span style=color:#f92672>.</span><span style=color:#a6e22e>R</span><span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>statusBarBackground</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>fade<span style=color:#f92672>.</span><span style=color:#a6e22e>excludeTarget</span><span style=color:#f92672>(</span>android<span style=color:#f92672>.</span><span style=color:#a6e22e>R</span><span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>navigationBarBackground</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>getWindow<span style=color:#f92672>().</span><span style=color:#a6e22e>setEnterTransition</span><span style=color:#f92672>(</span>fade<span style=color:#f92672>);</span>
</span></span></code></pre></div><ul><li>Activity设置独立Theme</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>// styles.xml
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;style</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;DefaultActivity&#34;</span> <span style=color:#a6e22e>parent=</span><span style=color:#e6db74>&#34;AppTheme&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;android:windowEnterTransition&#34;</span><span style=color:#f92672>&gt;</span>@transition/fade<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;android:windowExitTransition&#34;</span><span style=color:#f92672>&gt;</span>@transition/fade<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/style&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>// AndroidManifest.xml
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;activity</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;.SecondActivity&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:theme=</span><span style=color:#e6db74>&#34;@style/DefaultActivity&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;activity</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;.FirstActivity&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:theme=</span><span style=color:#e6db74>&#34;@style/DefaultActivity&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span></code></pre></div><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/Zhoutao822/hugo-pic/pictures/share4.gif alt=share4></p><h3 id=22-recyclerview复杂效果>2.2 RecyclerView复杂效果<a hidden class=anchor aria-hidden=true href=#22-recyclerview复杂效果>#</a></h3><p>上面写的代码都是用的本地图片，如果从网络中加载图片并在不同Activity中跳转，那么必然需要考虑在两个Activity中加载图片时的缓存时间，常用的图片加载框架有Picasso和Glide，可以参考上面给出的<a href=https://mikescamell.com/shared-element-transitions-part-4-recyclerview/>链接</a>。</p><p>首先获取图片数据</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Constants</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>static</span> List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getImageUrls</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> data <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>        data<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;https://i.loli.net/2020/01/02/ClMXcUkJNETpYHb.jpg&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        data<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;https://i.loli.net/2020/01/02/ulnhD8S79w4IfaY.jpg&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        data<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;https://i.loli.net/2020/01/02/i9IFevNYqKVRcXP.jpg&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        data<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;https://i.loli.net/2020/01/02/7QDskmZunBg4GEj.jpg&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        data<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;https://i.loli.net/2020/01/02/eHzuXSqIoUbh8Mc.jpg&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        data<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;https://i.loli.net/2020/01/02/biSqYO73CLvjh8p.jpg&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        data<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;https://i.loli.net/2020/01/02/a4NjuqfMmckoVT2.jpg&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        data<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;https://i.loli.net/2020/01/02/jSoFtq7VRBM6TUZ.jpg&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        data<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;https://i.loli.net/2020/01/02/nw3vUZBlyIph1oH.jpg&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        data<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;https://i.loli.net/2020/01/02/y3wGlkoXq4EWSDt.jpg&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> data<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>然后定义RecyclerView相关代码</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyAdapter</span> <span style=color:#66d9ef>extends</span> RecyclerView<span style=color:#f92672>.</span><span style=color:#a6e22e>Adapter</span><span style=color:#f92672>&lt;</span>MyAdapter<span style=color:#f92672>.</span><span style=color:#a6e22e>MyViewHolder</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> data<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Context context<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>MyAdapter</span><span style=color:#f92672>(</span>List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> data<span style=color:#f92672>,</span> Context context<span style=color:#f92672>,</span> OnItemClickListener onItemClickListener<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> data<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>context</span> <span style=color:#f92672>=</span> context<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>onItemClickListener</span> <span style=color:#f92672>=</span> onItemClickListener<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NonNull</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> MyViewHolder <span style=color:#a6e22e>onCreateViewHolder</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> ViewGroup parent<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> viewType<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        View view <span style=color:#f92672>=</span> LayoutInflater<span style=color:#f92672>.</span><span style=color:#a6e22e>from</span><span style=color:#f92672>(</span>context<span style=color:#f92672>).</span><span style=color:#a6e22e>inflate</span><span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>layout</span><span style=color:#f92672>.</span><span style=color:#a6e22e>layout_item</span><span style=color:#f92672>,</span> parent<span style=color:#f92672>,</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> MyViewHolder<span style=color:#f92672>(</span>view<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onBindViewHolder</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> <span style=color:#66d9ef>final</span> MyViewHolder holder<span style=color:#f92672>,</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> position<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 这里没有设置imageView和textView的transitionName也可以正常运行
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        String url <span style=color:#f92672>=</span> data<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>position<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        holder<span style=color:#f92672>.</span><span style=color:#a6e22e>textView</span><span style=color:#f92672>.</span><span style=color:#a6e22e>setText</span><span style=color:#f92672>(</span>url<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        loadImage<span style=color:#f92672>(</span>url<span style=color:#f92672>,</span> holder<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        holder<span style=color:#f92672>.</span><span style=color:#a6e22e>imageView</span><span style=color:#f92672>.</span><span style=color:#a6e22e>setOnClickListener</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> View<span style=color:#f92672>.</span><span style=color:#a6e22e>OnClickListener</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onClick</span><span style=color:#f92672>(</span>View view<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                onItemClickListener<span style=color:#f92672>.</span><span style=color:#a6e22e>onItemClick</span><span style=color:#f92672>(</span>holder<span style=color:#f92672>,</span> position<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 分别通过Glide和Picasso加载图片
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>loadImage</span><span style=color:#f92672>(</span>String url<span style=color:#f92672>,</span> MyViewHolder holder<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        Glide<span style=color:#f92672>.</span><span style=color:#a6e22e>with</span><span style=color:#f92672>(</span>context<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>load</span><span style=color:#f92672>(</span>url<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>centerCrop</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>into</span><span style=color:#f92672>(</span>holder<span style=color:#f92672>.</span><span style=color:#a6e22e>imageView</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//        Picasso.get()
</span></span></span><span style=display:flex><span><span style=color:#75715e>//                .load(url)
</span></span></span><span style=display:flex><span><span style=color:#75715e>//                .fit()
</span></span></span><span style=display:flex><span><span style=color:#75715e>//                .centerCrop()
</span></span></span><span style=display:flex><span><span style=color:#75715e>//                .into(holder.imageView);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getItemCount</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> data<span style=color:#f92672>.</span><span style=color:#a6e22e>size</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyViewHolder</span> <span style=color:#66d9ef>extends</span> RecyclerView<span style=color:#f92672>.</span><span style=color:#a6e22e>ViewHolder</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> ImageView imageView<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> TextView textView<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>MyViewHolder</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> View itemView<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>super</span><span style=color:#f92672>(</span>itemView<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            imageView <span style=color:#f92672>=</span> itemView<span style=color:#f92672>.</span><span style=color:#a6e22e>findViewById</span><span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>item_image</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            textView <span style=color:#f92672>=</span> itemView<span style=color:#f92672>.</span><span style=color:#a6e22e>findViewById</span><span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>item_text</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> OnItemClickListener onItemClickListener<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>OnItemClickListener</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onItemClick</span><span style=color:#f92672>(</span>MyViewHolder viewHolder<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> position<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!-- layout_item.xml --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;LinearLayout</span> <span style=color:#a6e22e>xmlns:android=</span><span style=color:#e6db74>&#34;http://schemas.android.com/apk/res/android&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>xmlns:tools=</span><span style=color:#e6db74>&#34;http://schemas.android.com/tools&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;150dp&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:layout_marginBottom=</span><span style=color:#e6db74>&#34;10dp&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:orientation=</span><span style=color:#e6db74>&#34;vertical&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;ImageView</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/item_image&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;0dp&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_weight=</span><span style=color:#e6db74>&#34;1&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_gravity=</span><span style=color:#e6db74>&#34;center&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>tools:src=</span><span style=color:#e6db74>&#34;@drawable/ic_launcher_foreground&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;TextView</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/item_text&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_gravity=</span><span style=color:#e6db74>&#34;center&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:lines=</span><span style=color:#e6db74>&#34;1&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:textSize=</span><span style=color:#e6db74>&#34;16sp&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>tools:text=</span><span style=color:#e6db74>&#34;aaaaaa&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/LinearLayout&gt;</span>
</span></span></code></pre></div><p>然后是Activity的代码</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// ThirdActivity.java
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ThirdActivity</span> <span style=color:#66d9ef>extends</span> AppCompatActivity <span style=color:#66d9ef>implements</span> MyAdapter<span style=color:#f92672>.</span><span style=color:#a6e22e>OnItemClickListener</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> RecyclerView recyclerView<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onCreate</span><span style=color:#f92672>(</span>Bundle savedInstanceState<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>onCreate</span><span style=color:#f92672>(</span>savedInstanceState<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        setContentView<span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>layout</span><span style=color:#f92672>.</span><span style=color:#a6e22e>activity_third</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        MyAdapter adapter <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MyAdapter<span style=color:#f92672>(</span>Constants<span style=color:#f92672>.</span><span style=color:#a6e22e>getImageUrls</span><span style=color:#f92672>(),</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        recyclerView <span style=color:#f92672>=</span> findViewById<span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>list</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        recyclerView<span style=color:#f92672>.</span><span style=color:#a6e22e>setLayoutManager</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> GridLayoutManager<span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>,</span> 2<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>        recyclerView<span style=color:#f92672>.</span><span style=color:#a6e22e>setAdapter</span><span style=color:#f92672>(</span>adapter<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onItemClick</span><span style=color:#f92672>(</span>MyAdapter<span style=color:#f92672>.</span><span style=color:#a6e22e>MyViewHolder</span> viewHolder<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> position<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        Intent intent <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Intent<span style=color:#f92672>(</span>ThirdActivity<span style=color:#f92672>.</span><span style=color:#a6e22e>this</span><span style=color:#f92672>,</span> ForthActivity<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        intent<span style=color:#f92672>.</span><span style=color:#a6e22e>putExtra</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;position&#34;</span><span style=color:#f92672>,</span> position<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 与单个共享元素不同的是，多个共享元素动画需要使用Pair传参，而且需要强制转换类型为View
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        Pair<span style=color:#f92672>&lt;</span>View<span style=color:#f92672>,</span> String<span style=color:#f92672>&gt;</span> imagePair <span style=color:#f92672>=</span> Pair<span style=color:#f92672>.</span><span style=color:#a6e22e>create</span><span style=color:#f92672>((</span>View<span style=color:#f92672>)</span>viewHolder<span style=color:#f92672>.</span><span style=color:#a6e22e>imageView</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;image&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        Pair<span style=color:#f92672>&lt;</span>View<span style=color:#f92672>,</span> String<span style=color:#f92672>&gt;</span> textPair <span style=color:#f92672>=</span> Pair<span style=color:#f92672>.</span><span style=color:#a6e22e>create</span><span style=color:#f92672>((</span>View<span style=color:#f92672>)</span>viewHolder<span style=color:#f92672>.</span><span style=color:#a6e22e>textView</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;text&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        ActivityOptionsCompat options <span style=color:#f92672>=</span> ActivityOptionsCompat<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>makeSceneTransitionAnimation</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>,</span> imagePair<span style=color:#f92672>,</span> textPair<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        startActivity<span style=color:#f92672>(</span>intent<span style=color:#f92672>,</span> options<span style=color:#f92672>.</span><span style=color:#a6e22e>toBundle</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ForthActivity.java
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ForthActivity</span> <span style=color:#66d9ef>extends</span> AppCompatActivity <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> TextView textView<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> ImageView imageView<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onCreate</span><span style=color:#f92672>(</span>Bundle savedInstanceState<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>onCreate</span><span style=color:#f92672>(</span>savedInstanceState<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        setContentView<span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>layout</span><span style=color:#f92672>.</span><span style=color:#a6e22e>activity_forth</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> position <span style=color:#f92672>=</span> getIntent<span style=color:#f92672>().</span><span style=color:#a6e22e>getIntExtra</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;position&#34;</span><span style=color:#f92672>,</span> 0<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        textView <span style=color:#f92672>=</span> findViewById<span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>text_detail</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        imageView <span style=color:#f92672>=</span> findViewById<span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>image_detail</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        textView<span style=color:#f92672>.</span><span style=color:#a6e22e>setText</span><span style=color:#f92672>(</span>Constants<span style=color:#f92672>.</span><span style=color:#a6e22e>getImageUrls</span><span style=color:#f92672>().</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>position<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>        loadImage<span style=color:#f92672>(</span>Constants<span style=color:#f92672>.</span><span style=color:#a6e22e>getImageUrls</span><span style=color:#f92672>().</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>position<span style=color:#f92672>),</span> imageView<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 分别通过Glide和Picasso加载图片，注意这里与MyAdapter使用不同的框架也是没有问题的
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>loadImage</span><span style=color:#f92672>(</span>String url<span style=color:#f92672>,</span> ImageView view<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 关键代码supportPostponeEnterTransition()方法，可以使得Activity
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// 延迟显示，直到执行了supportStartPostponedEnterTransition()方法。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// 也就是说，为了使图片能够先从网络上缓存下来再显示，可以在图片缓存成功的
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// 回调方法中调用supportStartPostponedEnterTransition()
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        supportPostponeEnterTransition<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Glide<span style=color:#f92672>.</span><span style=color:#a6e22e>with</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>load</span><span style=color:#f92672>(</span>url<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>centerCrop</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>dontAnimate</span><span style=color:#f92672>()</span> <span style=color:#75715e>// 实测这一行没有什么用
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>listener</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> RequestListener<span style=color:#f92672>&lt;</span>Drawable<span style=color:#f92672>&gt;()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>onLoadFailed</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@Nullable</span> GlideException e<span style=color:#f92672>,</span> Object model<span style=color:#f92672>,</span> Target<span style=color:#f92672>&lt;</span>Drawable<span style=color:#f92672>&gt;</span> target<span style=color:#f92672>,</span> <span style=color:#66d9ef>boolean</span> isFirstResource<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                        supportStartPostponedEnterTransition<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>onResourceReady</span><span style=color:#f92672>(</span>Drawable resource<span style=color:#f92672>,</span> Object model<span style=color:#f92672>,</span> Target<span style=color:#f92672>&lt;</span>Drawable<span style=color:#f92672>&gt;</span> target<span style=color:#f92672>,</span> DataSource dataSource<span style=color:#f92672>,</span> <span style=color:#66d9ef>boolean</span> isFirstResource<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                        supportStartPostponedEnterTransition<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>})</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>into</span><span style=color:#f92672>(</span>view<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//        Picasso.get()
</span></span></span><span style=display:flex><span><span style=color:#75715e>//                .load(url)
</span></span></span><span style=display:flex><span><span style=color:#75715e>//                .noFade()  // 实测这一行没有什么用
</span></span></span><span style=display:flex><span><span style=color:#75715e>//                .into(view, new Callback() {
</span></span></span><span style=display:flex><span><span style=color:#75715e>//                    @Override
</span></span></span><span style=display:flex><span><span style=color:#75715e>//                    public void onSuccess() {
</span></span></span><span style=display:flex><span><span style=color:#75715e>//                        supportStartPostponedEnterTransition();
</span></span></span><span style=display:flex><span><span style=color:#75715e>//                    }
</span></span></span><span style=display:flex><span><span style=color:#75715e>//
</span></span></span><span style=display:flex><span><span style=color:#75715e>//                    @Override
</span></span></span><span style=display:flex><span><span style=color:#75715e>//                    public void onError(Exception e) {
</span></span></span><span style=display:flex><span><span style=color:#75715e>//                        supportStartPostponedEnterTransition();
</span></span></span><span style=display:flex><span><span style=color:#75715e>//                    }
</span></span></span><span style=display:flex><span><span style=color:#75715e>//                });
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>最终效果</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/Zhoutao822/hugo-pic/pictures/share5.gif alt=share5></p><p>这个显示效果有几个问题，一是TextView字体大小突变，二是图片返回时会有微小的大小反弹现象，三是图片如果卡在状态栏上会出现短时间覆盖状态栏的现象，最后是点击时不会立即跳转，会出现明显的卡顿。如果需要解决上述几个问题，可以参考<a href=https://github.com/android/animation-samples>Github animation-samples</a>中的Unslpash示例。</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/Zhoutao822/hugo-pic/pictures/share6.gif alt=share6></p><p>可以发现这个示例没有出现上面我所发生的显示效果问题，如果仔细查看代码可以发现为了优化这个效果加入了一些的自定义动画以及自定义View。</p><h2 id=3-复杂效果的优化>3. 复杂效果的优化<a hidden class=anchor aria-hidden=true href=#3-复杂效果的优化>#</a></h2><p>具体可以参考<a href=https://github.com/android/animation-samples>Github animation-samples</a>中的Unslpash示例。</p><p>Unslpash示例具体实现了一下几个细节效果：</p><ol><li>在图片详情页使用了ViewPager，可以左右滑动切换图片；</li><li>当我们左右滑动切换图片再返回时，RecyclerView会滑动到对应的图片，而且有返回动画效果；</li><li>点击查看图片详情时动画没有卡顿的感觉，而且字体大小有良好的变换动画效果，不是突变；</li><li>ViewPager左右滑动也没有产生加载的卡顿现象。</li></ol><h3 id=31-效果实现分析>3.1 效果实现分析<a hidden class=anchor aria-hidden=true href=#31-效果实现分析>#</a></h3><p>首先是数据来源，Unslpash示例数据来自于<code>https://unsplash.it</code>，通过Retrofit获取，示例仅获取12张图片，构造的Photo数据结构就不用分析了，很简单。</p><p>然后是两个Activity的动画效果，是通过Theme设置的，分别对MainActivity和DetailActivity使用不同的Theme，即最主要的动画效果是通过xml定义的，java代码只控制逻辑</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!-- MainActivity --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;style</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;App.Home&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;android:windowExitTransition&#34;</span><span style=color:#f92672>&gt;</span>@transition/grid_exit<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;android:windowReenterTransition&#34;</span><span style=color:#f92672>&gt;</span>@transition/grid_reenter<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/style&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!-- DetailActivity --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;style</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;App.Details&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;android:windowSharedElementEnterTransition&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        @transition/shared_main_detail
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/style&gt;</span>
</span></span></code></pre></div><p>MainActivity的非共享元素移出界面时的效果是grid_exit，即爆炸效果；返回MainActivity时是grid_reenter，即从上向下滑动效果；DetailActivity的共享元素进入界面的效果是shared_main_detail，分别定义了photo和text的动画效果，photo使用了传统的几个动画就不说了，text使用的是自定义的动画，这个TextResize类还是有点复杂，所以会用就行了，而且不会出现在java代码中。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!-- grid_exit.xml --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;explode</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!-- grid_reenter.xml --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;slide</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>xmlns:android=</span><span style=color:#e6db74>&#34;http://schemas.android.com/apk/res/android&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:slideEdge=</span><span style=color:#e6db74>&#34;top&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:duration=</span><span style=color:#e6db74>&#34;300&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:interpolator=</span><span style=color:#e6db74>&#34;@android:interpolator/linear_out_slow_in&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/slide&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!-- shared_main_detail.xml --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;transitionSet</span> <span style=color:#a6e22e>xmlns:android=</span><span style=color:#e6db74>&#34;http://schemas.android.com/apk/res/android&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;transitionSet&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;targets&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;target</span> <span style=color:#a6e22e>android:targetId=</span><span style=color:#e6db74>&#34;@id/photo&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/targets&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;changeBounds&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;arcMotion</span> <span style=color:#a6e22e>android:maximumAngle=</span><span style=color:#e6db74>&#34;50&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/changeBounds&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;changeTransform</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;changeClipBounds</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;changeImageTransform</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/transitionSet&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;transitionSet&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;targets&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;target</span> <span style=color:#a6e22e>android:targetId=</span><span style=color:#e6db74>&#34;@id/author&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/targets&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;transition</span> <span style=color:#a6e22e>class=</span><span style=color:#e6db74>&#34;com.example.android.unsplash.transition.TextResize&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;changeBounds</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/transitionSet&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>&lt;!-- recolor不知道有什么用，删了也没有区别 --&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;recolor&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;targets&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;target</span> <span style=color:#a6e22e>android:targetId=</span><span style=color:#e6db74>&#34;@android:id/statusBarBackground&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;target</span> <span style=color:#a6e22e>android:targetId=</span><span style=color:#e6db74>&#34;@android:id/navigationBarBackground&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/targets&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/recolor&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/transitionSet&gt;</span>
</span></span></code></pre></div><p>从MainActivity点击跳转到DetailActivity时需要通过Intent传入几个数据，比如当前界面中text的属性值，点击的图片索引以及从网络请求得到的图片url等等</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@NonNull</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> Intent <span style=color:#a6e22e>getDetailActivityStartIntent</span><span style=color:#f92672>(</span>Activity host<span style=color:#f92672>,</span> ArrayList<span style=color:#f92672>&lt;</span>Photo<span style=color:#f92672>&gt;</span> photos<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                                                    <span style=color:#66d9ef>int</span> position<span style=color:#f92672>,</span> PhotoItemBinding binding<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>final</span> Intent intent <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Intent<span style=color:#f92672>(</span>host<span style=color:#f92672>,</span> DetailActivity<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    intent<span style=color:#f92672>.</span><span style=color:#a6e22e>setAction</span><span style=color:#f92672>(</span>Intent<span style=color:#f92672>.</span><span style=color:#a6e22e>ACTION_VIEW</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    intent<span style=color:#f92672>.</span><span style=color:#a6e22e>putParcelableArrayListExtra</span><span style=color:#f92672>(</span>IntentUtil<span style=color:#f92672>.</span><span style=color:#a6e22e>PHOTO</span><span style=color:#f92672>,</span> photos<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    intent<span style=color:#f92672>.</span><span style=color:#a6e22e>putExtra</span><span style=color:#f92672>(</span>IntentUtil<span style=color:#f92672>.</span><span style=color:#a6e22e>SELECTED_ITEM_POSITION</span><span style=color:#f92672>,</span> position<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    intent<span style=color:#f92672>.</span><span style=color:#a6e22e>putExtra</span><span style=color:#f92672>(</span>IntentUtil<span style=color:#f92672>.</span><span style=color:#a6e22e>FONT_SIZE</span><span style=color:#f92672>,</span> binding<span style=color:#f92672>.</span><span style=color:#a6e22e>author</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getTextSize</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    intent<span style=color:#f92672>.</span><span style=color:#a6e22e>putExtra</span><span style=color:#f92672>(</span>IntentUtil<span style=color:#f92672>.</span><span style=color:#a6e22e>PADDING</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> Rect<span style=color:#f92672>(</span>binding<span style=color:#f92672>.</span><span style=color:#a6e22e>author</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getPaddingLeft</span><span style=color:#f92672>(),</span>
</span></span><span style=display:flex><span>                    binding<span style=color:#f92672>.</span><span style=color:#a6e22e>author</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getPaddingTop</span><span style=color:#f92672>(),</span>
</span></span><span style=display:flex><span>                    binding<span style=color:#f92672>.</span><span style=color:#a6e22e>author</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getPaddingRight</span><span style=color:#f92672>(),</span>
</span></span><span style=display:flex><span>                    binding<span style=color:#f92672>.</span><span style=color:#a6e22e>author</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getPaddingBottom</span><span style=color:#f92672>()));</span>
</span></span><span style=display:flex><span>    intent<span style=color:#f92672>.</span><span style=color:#a6e22e>putExtra</span><span style=color:#f92672>(</span>IntentUtil<span style=color:#f92672>.</span><span style=color:#a6e22e>TEXT_COLOR</span><span style=color:#f92672>,</span> binding<span style=color:#f92672>.</span><span style=color:#a6e22e>author</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getCurrentTextColor</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> intent<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>在DetailActivity中通过getIntent方法获取传入的数据，构造DetailSharedElementEnterCallback，通过setEnterSharedElementCallback设置回调；setEnterSharedElementCallback可以监听共享元素进入此Activity时的状态，由sharedElementCallback自定义</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onCreate</span><span style=color:#f92672>(</span>Bundle savedInstanceState<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    Intent intent <span style=color:#f92672>=</span> getIntent<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    sharedElementCallback <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> DetailSharedElementEnterCallback<span style=color:#f92672>(</span>intent<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    setEnterSharedElementCallback<span style=color:#f92672>(</span>sharedElementCallback<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    initialItem <span style=color:#f92672>=</span> intent<span style=color:#f92672>.</span><span style=color:#a6e22e>getIntExtra</span><span style=color:#f92672>(</span>IntentUtil<span style=color:#f92672>.</span><span style=color:#a6e22e>SELECTED_ITEM_POSITION</span><span style=color:#f92672>,</span> 0<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    setUpViewPager<span style=color:#f92672>(</span>intent<span style=color:#f92672>.&lt;</span>Photo<span style=color:#f92672>&gt;</span>getParcelableArrayListExtra<span style=color:#f92672>(</span>IntentUtil<span style=color:#f92672>.</span><span style=color:#a6e22e>PHOTO</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>DetailSharedElementEnterCallback的主要功能是在Activity切换时调整TextView的属性以及对共享元素进行绑定。从这个Callback可以看出来实际动画效果是发生在DetailActivity中，首先当处于onCreate方法中，在调用<code>super.onCreate(savedInstanceState);</code>之前设置DetailSharedElementEnterCallback，此时动画还未开始。</p><p>按照顺序执行<code>onMapSharedElements->onSharedElementStart->onSharedElementEnd</code>方法，在onMapSharedElements方法中需要将对应的共享元素View与其transitionName关联起来，这里的作用其实等价于在MainActivity中生成的Pair对象，试想一下如果我们在点击时绑定的是position为1的ImageView，而如果我们在ViewPager中滑动后position变为4，那么我们就需要更新Pair对象，否则返回时动画效果就不是返回position为4的ImageView。所以只能在Callback中处理，由于使用了Databinding而且两个Activity中的ImageView的transitionName相同，所以简单的添加即可，将其他不需要变换动画的元素移出Map也可以在这里操作。</p><p>然后在onSharedElementStart方法中会先将DetailActivity中的TextView的属性修改为MainActivity中对应TextView的属性，最后在onSharedElementEnd方法中将TextView设置为DetailActivity中原本的属性即可，也就是说从<code>onSharedElementStart->onSharedElementEnd</code>就是动画的过程了，实际动画控制是由上面transitionSet定义的，这里仅提供最初和最终状态。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DetailSharedElementEnterCallback</span> <span style=color:#66d9ef>extends</span> SharedElementCallback <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onSharedElementStart</span><span style=color:#f92672>(</span>List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> sharedElementNames<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                                     List<span style=color:#f92672>&lt;</span>View<span style=color:#f92672>&gt;</span> sharedElements<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                                     List<span style=color:#f92672>&lt;</span>View<span style=color:#f92672>&gt;</span> sharedElementSnapshots<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        TextView author <span style=color:#f92672>=</span> getAuthor<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        targetTextSize <span style=color:#f92672>=</span> author<span style=color:#f92672>.</span><span style=color:#a6e22e>getTextSize</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        targetTextColors <span style=color:#f92672>=</span> author<span style=color:#f92672>.</span><span style=color:#a6e22e>getTextColors</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        targetPadding <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Rect<span style=color:#f92672>(</span>author<span style=color:#f92672>.</span><span style=color:#a6e22e>getPaddingLeft</span><span style=color:#f92672>(),</span>
</span></span><span style=display:flex><span>                author<span style=color:#f92672>.</span><span style=color:#a6e22e>getPaddingTop</span><span style=color:#f92672>(),</span>
</span></span><span style=display:flex><span>                author<span style=color:#f92672>.</span><span style=color:#a6e22e>getPaddingRight</span><span style=color:#f92672>(),</span>
</span></span><span style=display:flex><span>                author<span style=color:#f92672>.</span><span style=color:#a6e22e>getPaddingBottom</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>IntentUtil<span style=color:#f92672>.</span><span style=color:#a6e22e>hasAll</span><span style=color:#f92672>(</span>intent<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                IntentUtil<span style=color:#f92672>.</span><span style=color:#a6e22e>TEXT_COLOR</span><span style=color:#f92672>,</span> IntentUtil<span style=color:#f92672>.</span><span style=color:#a6e22e>FONT_SIZE</span><span style=color:#f92672>,</span> IntentUtil<span style=color:#f92672>.</span><span style=color:#a6e22e>PADDING</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            author<span style=color:#f92672>.</span><span style=color:#a6e22e>setTextColor</span><span style=color:#f92672>(</span>intent<span style=color:#f92672>.</span><span style=color:#a6e22e>getIntExtra</span><span style=color:#f92672>(</span>IntentUtil<span style=color:#f92672>.</span><span style=color:#a6e22e>TEXT_COLOR</span><span style=color:#f92672>,</span> Color<span style=color:#f92672>.</span><span style=color:#a6e22e>BLACK</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>float</span> textSize <span style=color:#f92672>=</span> intent<span style=color:#f92672>.</span><span style=color:#a6e22e>getFloatExtra</span><span style=color:#f92672>(</span>IntentUtil<span style=color:#f92672>.</span><span style=color:#a6e22e>FONT_SIZE</span><span style=color:#f92672>,</span> targetTextSize<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            author<span style=color:#f92672>.</span><span style=color:#a6e22e>setTextSize</span><span style=color:#f92672>(</span>TypedValue<span style=color:#f92672>.</span><span style=color:#a6e22e>COMPLEX_UNIT_PX</span><span style=color:#f92672>,</span> textSize<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            Rect padding <span style=color:#f92672>=</span> intent<span style=color:#f92672>.</span><span style=color:#a6e22e>getParcelableExtra</span><span style=color:#f92672>(</span>IntentUtil<span style=color:#f92672>.</span><span style=color:#a6e22e>PADDING</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            author<span style=color:#f92672>.</span><span style=color:#a6e22e>setPadding</span><span style=color:#f92672>(</span>padding<span style=color:#f92672>.</span><span style=color:#a6e22e>left</span><span style=color:#f92672>,</span> padding<span style=color:#f92672>.</span><span style=color:#a6e22e>top</span><span style=color:#f92672>,</span> padding<span style=color:#f92672>.</span><span style=color:#a6e22e>right</span><span style=color:#f92672>,</span> padding<span style=color:#f92672>.</span><span style=color:#a6e22e>bottom</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onSharedElementEnd</span><span style=color:#f92672>(</span>List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> sharedElementNames<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                                   List<span style=color:#f92672>&lt;</span>View<span style=color:#f92672>&gt;</span> sharedElements<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                                   List<span style=color:#f92672>&lt;</span>View<span style=color:#f92672>&gt;</span> sharedElementSnapshots<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        TextView author <span style=color:#f92672>=</span> getAuthor<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        author<span style=color:#f92672>.</span><span style=color:#a6e22e>setTextSize</span><span style=color:#f92672>(</span>TypedValue<span style=color:#f92672>.</span><span style=color:#a6e22e>COMPLEX_UNIT_PX</span><span style=color:#f92672>,</span> targetTextSize<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>targetTextColors <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            author<span style=color:#f92672>.</span><span style=color:#a6e22e>setTextColor</span><span style=color:#f92672>(</span>targetTextColors<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>targetPadding <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            author<span style=color:#f92672>.</span><span style=color:#a6e22e>setPadding</span><span style=color:#f92672>(</span>targetPadding<span style=color:#f92672>.</span><span style=color:#a6e22e>left</span><span style=color:#f92672>,</span> targetPadding<span style=color:#f92672>.</span><span style=color:#a6e22e>top</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                    targetPadding<span style=color:#f92672>.</span><span style=color:#a6e22e>right</span><span style=color:#f92672>,</span> targetPadding<span style=color:#f92672>.</span><span style=color:#a6e22e>bottom</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>currentDetailBinding <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            forceSharedElementLayout<span style=color:#f92672>(</span>currentDetailBinding<span style=color:#f92672>.</span><span style=color:#a6e22e>description</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>    
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onMapSharedElements</span><span style=color:#f92672>(</span>List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> names<span style=color:#f92672>,</span> Map<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> View<span style=color:#f92672>&gt;</span> sharedElements<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        removeObsoleteElements<span style=color:#f92672>(</span>names<span style=color:#f92672>,</span> sharedElements<span style=color:#f92672>,</span> mapObsoleteElements<span style=color:#f92672>(</span>names<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>        mapSharedElement<span style=color:#f92672>(</span>names<span style=color:#f92672>,</span> sharedElements<span style=color:#f92672>,</span> getAuthor<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        mapSharedElement<span style=color:#f92672>(</span>names<span style=color:#f92672>,</span> sharedElements<span style=color:#f92672>,</span> getPhoto<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setBinding</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> DetailViewBinding binding<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        currentDetailBinding <span style=color:#f92672>=</span> binding<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        currentPhotoBinding <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setBinding</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> PhotoItemBinding binding<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        currentPhotoBinding <span style=color:#f92672>=</span> binding<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        currentDetailBinding <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> TextView <span style=color:#a6e22e>getAuthor</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>currentPhotoBinding <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> currentPhotoBinding<span style=color:#f92672>.</span><span style=color:#a6e22e>author</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>currentDetailBinding <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> currentDetailBinding<span style=color:#f92672>.</span><span style=color:#a6e22e>author</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> NullPointerException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Must set a binding before transitioning.&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> ImageView <span style=color:#a6e22e>getPhoto</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>currentPhotoBinding <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> currentPhotoBinding<span style=color:#f92672>.</span><span style=color:#a6e22e>photo</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>currentDetailBinding <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> currentDetailBinding<span style=color:#f92672>.</span><span style=color:#a6e22e>photo</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> NullPointerException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Must set a binding before transitioning.&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Maps all views that don&#39;t start with &#34;android&#34; namespace.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param names All shared element names.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return The obsolete shared element names.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NonNull</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>mapObsoleteElements</span><span style=color:#f92672>(</span>List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> names<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> elementsToRemove <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;(</span>names<span style=color:#f92672>.</span><span style=color:#a6e22e>size</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>String name <span style=color:#f92672>:</span> names<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>name<span style=color:#f92672>.</span><span style=color:#a6e22e>startsWith</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;android&#34;</span><span style=color:#f92672>))</span> <span style=color:#66d9ef>continue</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            elementsToRemove<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span>name<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> elementsToRemove<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Removes obsolete elements from names and shared elements.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param names            Shared element names.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param sharedElements   Shared elements.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param elementsToRemove The elements that should be removed.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>removeObsoleteElements</span><span style=color:#f92672>(</span>List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> names<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                                        Map<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> View<span style=color:#f92672>&gt;</span> sharedElements<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                                        List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> elementsToRemove<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>elementsToRemove<span style=color:#f92672>.</span><span style=color:#a6e22e>size</span><span style=color:#f92672>()</span> <span style=color:#f92672>&gt;</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            names<span style=color:#f92672>.</span><span style=color:#a6e22e>removeAll</span><span style=color:#f92672>(</span>elementsToRemove<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>String elementToRemove <span style=color:#f92672>:</span> elementsToRemove<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                sharedElements<span style=color:#f92672>.</span><span style=color:#a6e22e>remove</span><span style=color:#f92672>(</span>elementToRemove<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Puts a shared element to transitions and names.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param names          The names for this transition.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param sharedElements The elements for this transition.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param view           The view to add.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>mapSharedElement</span><span style=color:#f92672>(</span>List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> names<span style=color:#f92672>,</span> Map<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> View<span style=color:#f92672>&gt;</span> sharedElements<span style=color:#f92672>,</span> View view<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        String transitionName <span style=color:#f92672>=</span> view<span style=color:#f92672>.</span><span style=color:#a6e22e>getTransitionName</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        names<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span>transitionName<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        sharedElements<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span>transitionName<span style=color:#f92672>,</span> view<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>    
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>forceSharedElementLayout</span><span style=color:#f92672>(</span>View view<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> widthSpec <span style=color:#f92672>=</span> View<span style=color:#f92672>.</span><span style=color:#a6e22e>MeasureSpec</span><span style=color:#f92672>.</span><span style=color:#a6e22e>makeMeasureSpec</span><span style=color:#f92672>(</span>view<span style=color:#f92672>.</span><span style=color:#a6e22e>getWidth</span><span style=color:#f92672>(),</span>
</span></span><span style=display:flex><span>                View<span style=color:#f92672>.</span><span style=color:#a6e22e>MeasureSpec</span><span style=color:#f92672>.</span><span style=color:#a6e22e>EXACTLY</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> heightSpec <span style=color:#f92672>=</span> View<span style=color:#f92672>.</span><span style=color:#a6e22e>MeasureSpec</span><span style=color:#f92672>.</span><span style=color:#a6e22e>makeMeasureSpec</span><span style=color:#f92672>(</span>view<span style=color:#f92672>.</span><span style=color:#a6e22e>getHeight</span><span style=color:#f92672>(),</span>
</span></span><span style=display:flex><span>                View<span style=color:#f92672>.</span><span style=color:#a6e22e>MeasureSpec</span><span style=color:#f92672>.</span><span style=color:#a6e22e>EXACTLY</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        view<span style=color:#f92672>.</span><span style=color:#a6e22e>measure</span><span style=color:#f92672>(</span>widthSpec<span style=color:#f92672>,</span> heightSpec<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        view<span style=color:#f92672>.</span><span style=color:#a6e22e>layout</span><span style=color:#f92672>(</span>view<span style=color:#f92672>.</span><span style=color:#a6e22e>getLeft</span><span style=color:#f92672>(),</span> view<span style=color:#f92672>.</span><span style=color:#a6e22e>getTop</span><span style=color:#f92672>(),</span> view<span style=color:#f92672>.</span><span style=color:#a6e22e>getRight</span><span style=color:#f92672>(),</span> view<span style=color:#f92672>.</span><span style=color:#a6e22e>getBottom</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>以上就是从MainActivity点击跳转到DetailActivity的全部流程，当然Unsplash示例还有ViewPager以及返回动画效果。</p><p>当我们左右滑动时会调用DetailViewPagerAdapter的setPrimaryItem，在这个方法中我们设置的上面Callback的View binding，将其置为当前的ImageView，此时如果点击返回键，那么Callback的执行顺序是<code>onMapSharedElements->onMapSharedElements->onSharedElementEnd->onSharedElementStart->onSharedElementStart->onSharedElementEnd</code>，且都是在DetailActivity的onPause之前执行的，这里分为两个阶段，因为此时在两个Activity中都有Callback，第一个onMapSharedElements是DetailActivity的，这里重新绑定position为4的ImageView；第二个onMapSharedElements是MainActivity的的，在onActivityReenter方法（Activity返回）中被调用，此时MainActivity已经知道了当前position为4，因此滑动RecyclerView到position为4的位置，并且将其对应的binding传入MainActivity的Callback中；然后是<code>onSharedElementEnd->onSharedElementStart</code>，这个状态是DetailActivity的动作，很显然这个效果就是上面动画的逆过程；再是<code>onSharedElementStart->onSharedElementEnd</code>，这个是MainActivity的动画过程，前面已经在onActivityReenter方法中获取了position和binding等数据，此时传入Callback中的Intent没有存储TextView的属性，因此这个过程在MainActivity中没有对共享元素产生任何动画效果。</p><h3 id=32-在fragment中实现类似效果>3.2 在Fragment中实现类似效果<a hidden class=anchor aria-hidden=true href=#32-在fragment中实现类似效果>#</a></h3><p>在Fragment中实现类似ImageView共享元素+ViewPager的效果会遇到几个问题，一是Fragment仅支持一个元素的动画，所以不能再使用TextView和ImageView一起变化；二是Fragment没有类似Activity的onActivityReenter方法，因此Fragment无法知道是从哪个position返回的，也就是说返回动画可能会出错，当然通过传参的方式（可能有传空数据的异常）或者ViewModel的方式是可以共享数据，如果没有使用ViewModel，那么可以考虑禁用返回动画来避免错误，当然动画效果就不是很好。具体代码可参考<a href=https://github.com/android/animation-samples>Github animation-samples</a>中的GridToPager示例。</p><p>如果使用ViewModel来实现相同的效果可以参考<a href=https://github.com/zhuantou233/ShareElementWithViewModel>ShareElementWithViewModel</a>。大部分代码都是参考<a href=https://github.com/android/animation-samples>Github animation-samples</a>中的示例，仅修改了数据处理部分以使用ViewModel。下面大致说明一下修改的思路。</p><p>首先是依赖库，包括ViewModel和Navigation，以及使用了Databinding，用Glide加载图片</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gradle data-lang=gradle><span style=display:flex><span>android <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    dataBinding <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        enabled <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dependencies <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    implementation <span style=color:#a6e22e>fileTree</span><span style=color:#f92672>(</span>dir: <span style=color:#e6db74>&#39;libs&#39;</span><span style=color:#f92672>,</span> include: <span style=color:#f92672>[</span><span style=color:#e6db74>&#39;*.jar&#39;</span><span style=color:#f92672>])</span>
</span></span><span style=display:flex><span>    implementation <span style=color:#e6db74>&#39;androidx.appcompat:appcompat:1.1.0&#39;</span>
</span></span><span style=display:flex><span>    implementation <span style=color:#e6db74>&#39;androidx.constraintlayout:constraintlayout:1.1.3&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> lifecycle_version <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;2.1.0&#34;</span>
</span></span><span style=display:flex><span>    implementation <span style=color:#e6db74>&#34;androidx.lifecycle:lifecycle-extensions:$lifecycle_version&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    implementation <span style=color:#e6db74>&#34;androidx.recyclerview:recyclerview:1.1.0&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> nav_version <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;2.1.0&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Java language implementation
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    implementation <span style=color:#e6db74>&#34;androidx.navigation:navigation-fragment:$nav_version&#34;</span>
</span></span><span style=display:flex><span>    implementation <span style=color:#e6db74>&#34;androidx.navigation:navigation-ui:$nav_version&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    implementation <span style=color:#e6db74>&#39;com.github.bumptech.glide:glide:4.10.0&#39;</span>
</span></span><span style=display:flex><span>    implementation <span style=color:#e6db74>&#39;androidx.legacy:legacy-support-v4:1.0.0&#39;</span>
</span></span><span style=display:flex><span>    annotationProcessor <span style=color:#e6db74>&#39;com.github.bumptech.glide:compiler:4.10.0&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    implementation <span style=color:#e6db74>&#39;com.google.android.material:material:1.0.0&#39;</span>
</span></span><span style=display:flex><span>    implementation <span style=color:#e6db74>&#39;com.squareup.retrofit2:retrofit:2.7.1&#39;</span>
</span></span><span style=display:flex><span>    implementation <span style=color:#e6db74>&#39;com.squareup.retrofit2:converter-gson:2.7.1&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    testImplementation <span style=color:#e6db74>&#39;junit:junit:4.12&#39;</span>
</span></span><span style=display:flex><span>    androidTestImplementation <span style=color:#e6db74>&#39;androidx.test.ext:junit:1.1.1&#39;</span>
</span></span><span style=display:flex><span>    androidTestImplementation <span style=color:#e6db74>&#39;androidx.test.espresso:espresso-core:3.2.0&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>使用Navigation控制Fragment跳转，而且仅使用GridListFragment跳转到DetailPagerFragment，同时MainActivity不再进行任何操作。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;navigation</span> <span style=color:#a6e22e>xmlns:android=</span><span style=color:#e6db74>&#34;http://schemas.android.com/apk/res/android&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>xmlns:app=</span><span style=color:#e6db74>&#34;http://schemas.android.com/apk/res-auto&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>xmlns:tools=</span><span style=color:#e6db74>&#34;http://schemas.android.com/tools&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/nav_graph&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>app:startDestination=</span><span style=color:#e6db74>&#34;@id/listFragment&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;fragment</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/listFragment&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;us.zoom.shareelementwithviewmodel.ui.grid.GridListFragment&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:label=</span><span style=color:#e6db74>&#34;fragment_list&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>tools:layout=</span><span style=color:#e6db74>&#34;@layout/fragment_list&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;action</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/action_listFragment_to_detailPagerFragment&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>app:destination=</span><span style=color:#e6db74>&#34;@id/detailPagerFragment&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/fragment&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;fragment</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/detailPagerFragment&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;us.zoom.shareelementwithviewmodel.ui.pager.DetailPagerFragment&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:label=</span><span style=color:#e6db74>&#34;fragment_detail_pager&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>tools:layout=</span><span style=color:#e6db74>&#34;@layout/fragment_detail_pager&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/navigation&gt;</span>
</span></span></code></pre></div><p>实现ImageListViewModel，用于保存数据</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ImageListViewModel</span> <span style=color:#66d9ef>extends</span> ViewModel <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 保存从api获取到的数据
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> MutableLiveData<span style=color:#f92672>&lt;</span>List<span style=color:#f92672>&lt;</span>Photo<span style=color:#f92672>&gt;&gt;</span> photos <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MutableLiveData<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> LiveData<span style=color:#f92672>&lt;</span>List<span style=color:#f92672>&lt;</span>Photo<span style=color:#f92672>&gt;&gt;</span> <span style=color:#a6e22e>getPhotos</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> photos<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 保存请求过程的状态
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> MutableLiveData<span style=color:#f92672>&lt;</span>Boolean<span style=color:#f92672>&gt;</span> isLoading <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MutableLiveData<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> LiveData<span style=color:#f92672>&lt;</span>Boolean<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getIsLoading</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> isLoading<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 保存ViewPager中当前位置
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> MutableLiveData<span style=color:#f92672>&lt;</span>Integer<span style=color:#f92672>&gt;</span> currentPosition <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MutableLiveData<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> LiveData<span style=color:#f92672>&lt;</span>Integer<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getCurrentPosition</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> currentPosition<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setCurrentPosition</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> position<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        currentPosition<span style=color:#f92672>.</span><span style=color:#a6e22e>setValue</span><span style=color:#f92672>(</span>position<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        loadPhotos<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        setCurrentPosition<span style=color:#f92672>(</span>0<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>loadPhotos</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        isLoading<span style=color:#f92672>.</span><span style=color:#a6e22e>setValue</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        UnsplashService unsplashApi <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Retrofit<span style=color:#f92672>.</span><span style=color:#a6e22e>Builder</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>baseUrl</span><span style=color:#f92672>(</span>UnsplashService<span style=color:#f92672>.</span><span style=color:#a6e22e>BASEURL</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>addConverterFactory</span><span style=color:#f92672>(</span>GsonConverterFactory<span style=color:#f92672>.</span><span style=color:#a6e22e>create</span><span style=color:#f92672>())</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>build</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>create</span><span style=color:#f92672>(</span>UnsplashService<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        unsplashApi<span style=color:#f92672>.</span><span style=color:#a6e22e>getPhoto</span><span style=color:#f92672>().</span><span style=color:#a6e22e>enqueue</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> Callback<span style=color:#f92672>&lt;</span>List<span style=color:#f92672>&lt;</span>Photo<span style=color:#f92672>&gt;&gt;()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onResponse</span><span style=color:#f92672>(</span>Call<span style=color:#f92672>&lt;</span>List<span style=color:#f92672>&lt;</span>Photo<span style=color:#f92672>&gt;&gt;</span> call<span style=color:#f92672>,</span> Response<span style=color:#f92672>&lt;</span>List<span style=color:#f92672>&lt;</span>Photo<span style=color:#f92672>&gt;&gt;</span> response<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                List<span style=color:#f92672>&lt;</span>Photo<span style=color:#f92672>&gt;</span> list <span style=color:#f92672>=</span> response<span style=color:#f92672>.</span><span style=color:#a6e22e>body</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>list <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span>list<span style=color:#f92672>.</span><span style=color:#a6e22e>isEmpty</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    photos<span style=color:#f92672>.</span><span style=color:#a6e22e>setValue</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;(</span>list<span style=color:#f92672>.</span><span style=color:#a6e22e>subList</span><span style=color:#f92672>(</span>list<span style=color:#f92672>.</span><span style=color:#a6e22e>size</span><span style=color:#f92672>()</span> <span style=color:#f92672>-</span> PHOTO_COUNT<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                            list<span style=color:#f92672>.</span><span style=color:#a6e22e>size</span><span style=color:#f92672>())));</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                isLoading<span style=color:#f92672>.</span><span style=color:#a6e22e>setValue</span><span style=color:#f92672>(</span><span style=color:#66d9ef>false</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onFailure</span><span style=color:#f92672>(</span>Call<span style=color:#f92672>&lt;</span>List<span style=color:#f92672>&lt;</span>Photo<span style=color:#f92672>&gt;&gt;</span> call<span style=color:#f92672>,</span> Throwable t<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                Log<span style=color:#f92672>.</span><span style=color:#a6e22e>i</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;ShareElement&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;UnsplashService onFailure: &#34;</span> <span style=color:#f92672>+</span> t<span style=color:#f92672>.</span><span style=color:#a6e22e>getMessage</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>                isLoading<span style=color:#f92672>.</span><span style=color:#a6e22e>setValue</span><span style=color:#f92672>(</span><span style=color:#66d9ef>false</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Unsplash示例使用的api有时候会用不了，可以用本地的url替代，对应需要修改Photo的getPhotoUrl方法
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// List&lt;Photo&gt; data = new ArrayList&lt;&gt;();
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// for (String url : Constants.getImageUrls()) {
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>//     Photo photo = new Photo(&#34;&#34;, 0, 0, &#34;&#34;, url.hashCode(), &#34;&#34;, &#34;&#34;, url);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>//     data.add(photo);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// }
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// photos.setValue(data);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// isLoading.setValue(false);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Databinding适配，修改BindingAdapters，实现Glide加载并增加回调，回调会影响后续Fragment跳转的动画</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BindingAdapters</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 绑定RecyclerView的list数据
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>@BindingAdapter</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;listData&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>bindRecyclerView</span><span style=color:#f92672>(</span>RecyclerView recyclerView<span style=color:#f92672>,</span> List<span style=color:#f92672>&lt;</span>Photo<span style=color:#f92672>&gt;</span> data<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        GridPhotoAdapter adapter <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>GridPhotoAdapter<span style=color:#f92672>)</span> recyclerView<span style=color:#f92672>.</span><span style=color:#a6e22e>getAdapter</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>assert</span> adapter <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        adapter<span style=color:#f92672>.</span><span style=color:#a6e22e>submitList</span><span style=color:#f92672>(</span>data<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 绑定Progressbar的状态
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>@BindingAdapter</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;loadingStatus&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>bindStatus</span><span style=color:#f92672>(</span>ProgressBar progressBar<span style=color:#f92672>,</span> Boolean isLoading<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>isLoading<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            progressBar<span style=color:#f92672>.</span><span style=color:#a6e22e>setVisibility</span><span style=color:#f92672>(</span>View<span style=color:#f92672>.</span><span style=color:#a6e22e>VISIBLE</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            progressBar<span style=color:#f92672>.</span><span style=color:#a6e22e>setVisibility</span><span style=color:#f92672>(</span>View<span style=color:#f92672>.</span><span style=color:#a6e22e>GONE</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Glide加载以及增加回调
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>@BindingAdapter</span><span style=color:#f92672>(</span>value <span style=color:#f92672>=</span> <span style=color:#f92672>{</span><span style=color:#e6db74>&#34;imageUrl&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;glideListener&#34;</span><span style=color:#f92672>})</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>bindImage</span><span style=color:#f92672>(</span>ImageView imageView<span style=color:#f92672>,</span> Photo photo<span style=color:#f92672>,</span> OnGlideRequestListener listener<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> requestedPhotoWidth <span style=color:#f92672>=</span> imageView<span style=color:#f92672>.</span><span style=color:#a6e22e>getContext</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getResources</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getDisplayMetrics</span><span style=color:#f92672>().</span><span style=color:#a6e22e>widthPixels</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        Glide<span style=color:#f92672>.</span><span style=color:#a6e22e>with</span><span style=color:#f92672>(</span>imageView<span style=color:#f92672>.</span><span style=color:#a6e22e>getContext</span><span style=color:#f92672>())</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>load</span><span style=color:#f92672>(</span>photo<span style=color:#f92672>.</span><span style=color:#a6e22e>getPhotoUrl</span><span style=color:#f92672>(</span>requestedPhotoWidth<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>placeholder</span><span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>drawable</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ic_launcher_foreground</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>override</span><span style=color:#f92672>(</span>ImageSize<span style=color:#f92672>.</span><span style=color:#a6e22e>NORMAL</span><span style=color:#f92672>[</span>0<span style=color:#f92672>],</span> ImageSize<span style=color:#f92672>.</span><span style=color:#a6e22e>NORMAL</span><span style=color:#f92672>[</span>1<span style=color:#f92672>])</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>addListener</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> RequestListener<span style=color:#f92672>&lt;</span>Drawable<span style=color:#f92672>&gt;()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>onLoadFailed</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@Nullable</span> GlideException e<span style=color:#f92672>,</span> Object model<span style=color:#f92672>,</span> Target<span style=color:#f92672>&lt;</span>Drawable<span style=color:#f92672>&gt;</span> target<span style=color:#f92672>,</span> <span style=color:#66d9ef>boolean</span> isFirstResource<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                        listener<span style=color:#f92672>.</span><span style=color:#a6e22e>onLoadFailed</span><span style=color:#f92672>(</span>e<span style=color:#f92672>,</span> model<span style=color:#f92672>,</span> target<span style=color:#f92672>,</span> isFirstResource<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>onResourceReady</span><span style=color:#f92672>(</span>Drawable resource<span style=color:#f92672>,</span> Object model<span style=color:#f92672>,</span> Target<span style=color:#f92672>&lt;</span>Drawable<span style=color:#f92672>&gt;</span> target<span style=color:#f92672>,</span> DataSource dataSource<span style=color:#f92672>,</span> <span style=color:#66d9ef>boolean</span> isFirstResource<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                        listener<span style=color:#f92672>.</span><span style=color:#a6e22e>onResourceReady</span><span style=color:#f92672>(</span>resource<span style=color:#f92672>,</span> model<span style=color:#f92672>,</span> target<span style=color:#f92672>,</span> dataSource<span style=color:#f92672>,</span> isFirstResource<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>})</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>into</span><span style=color:#f92672>(</span>imageView<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>因为使用ViewModel在GridListFragment和DetailPagerFragment共享数据，所以ViewModel与MainActivity绑定</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>viewModel <span style=color:#f92672>=</span> ViewModelProviders<span style=color:#f92672>.</span><span style=color:#a6e22e>of</span><span style=color:#f92672>(</span>requireActivity<span style=color:#f92672>()).</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>ImageListViewModel<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span></code></pre></div><p>GridListFragment使用了RecyclerView和Databinding，所以GridPhotoAdapter继承自ListAdapter，并实现DiffUtil.ItemCallback，以及点击事件的监听，又因为共享元素动画效果受Glide加载状态影响，所以需要把加载状态再通过OnLoadCompletedListener传到Fragment中，PhotoViewHolder采用Databinding实现。</p><p>在GridListFragment使用<code>postponeEnterTransition()</code>控制加载动画，但是我遇到了一些非常奇怪的问题，所以只能在<code>onStart()</code>中调用</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onStart</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>onStart</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 其他生命周期会触发不显示RecyclerView
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    postponeEnterTransition<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>因为通过GridPhotoAdapter传出了Glide的状态，所以可以在这里控制<code>startPostponedEnterTransition</code>，否则需要将Fragment实例传给Adapter</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onImageLoadCompleted</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> position<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Call startPostponedEnterTransition only when the &#39;selected&#39; image loading is completed.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>currentPosition <span style=color:#f92672>!=</span> position<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    startPostponedEnterTransition<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>点击跳转Fragment也可以通过Navigation实现了，同时更新ViewModel的数据，共享元素的绑定也是通过FragmentNavigator.Extras实现，不过看了这个的代码后发现似乎使用Navigation可以实现在Fragment中同时有多个共享元素动画。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onListItemClick</span><span style=color:#f92672>(</span>View view<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> position<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Update the position.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    viewModel<span style=color:#f92672>.</span><span style=color:#a6e22e>setCurrentPosition</span><span style=color:#f92672>(</span>position<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Exclude the clicked card from the exit transition (e.g. the card will disappear immediately
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// instead of fading out with the rest to prevent an overlapping animation of fade and move).
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>assert</span> getExitTransition<span style=color:#f92672>()</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>((</span>TransitionSet<span style=color:#f92672>)</span> getExitTransition<span style=color:#f92672>()).</span><span style=color:#a6e22e>excludeTarget</span><span style=color:#f92672>(</span>view<span style=color:#f92672>,</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    ImageView transitioningView <span style=color:#f92672>=</span> view<span style=color:#f92672>.</span><span style=color:#a6e22e>findViewById</span><span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>photo</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    FragmentNavigator<span style=color:#f92672>.</span><span style=color:#a6e22e>Extras</span> extras <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> FragmentNavigator<span style=color:#f92672>.</span><span style=color:#a6e22e>Extras</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Builder</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>addSharedElement</span><span style=color:#f92672>(</span>transitioningView<span style=color:#f92672>,</span> transitioningView<span style=color:#f92672>.</span><span style=color:#a6e22e>getTransitionName</span><span style=color:#f92672>())</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>build</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    Navigation<span style=color:#f92672>.</span><span style=color:#a6e22e>findNavController</span><span style=color:#f92672>(</span>view<span style=color:#f92672>).</span><span style=color:#a6e22e>navigate</span><span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>action_listFragment_to_detailPagerFragment</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>,</span> extras<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>然后是DetailPagerFragment和DetailFragment，因为在实现过程中DetailFragment其实不是非常依赖ViewModel的数据，它只是作为显示结果被使用的，无论是当前位置还是全部图片数据都不需要获取或修改，所以DetailFragment仅需要进行Databinding即可，其他左右滑动数据修改都是在DetailPagerFragment中处理</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DetailFragment</span> <span style=color:#66d9ef>extends</span> Fragment <span style=color:#66d9ef>implements</span> OnGlideRequestListener <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> String TAG <span style=color:#f92672>=</span> DetailFragment<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getSimpleName</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Photo photo<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 仅需要Photo数据
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    DetailFragment<span style=color:#f92672>(</span>Photo photo<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>photo</span> <span style=color:#f92672>=</span> photo<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> View <span style=color:#a6e22e>onCreateView</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> LayoutInflater inflater<span style=color:#f92672>,</span> ViewGroup container<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                             Bundle savedInstanceState<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Inflate the layout for this fragment
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        FragmentDetailBinding binding <span style=color:#f92672>=</span> FragmentDetailBinding<span style=color:#f92672>.</span><span style=color:#a6e22e>inflate</span><span style=color:#f92672>(</span>inflater<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        binding<span style=color:#f92672>.</span><span style=color:#a6e22e>setLifecycleOwner</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        binding<span style=color:#f92672>.</span><span style=color:#a6e22e>setListener</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        binding<span style=color:#f92672>.</span><span style=color:#a6e22e>setData</span><span style=color:#f92672>(</span>photo<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> binding<span style=color:#f92672>.</span><span style=color:#a6e22e>getRoot</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 同样需要处理动画
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onLoadFailed</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@Nullable</span> GlideException e<span style=color:#f92672>,</span> Object model<span style=color:#f92672>,</span> Target<span style=color:#f92672>&lt;</span>Drawable<span style=color:#f92672>&gt;</span> target<span style=color:#f92672>,</span> <span style=color:#66d9ef>boolean</span> isFirstResource<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        requireParentFragment<span style=color:#f92672>().</span><span style=color:#a6e22e>startPostponedEnterTransition</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onResourceReady</span><span style=color:#f92672>(</span>Drawable resource<span style=color:#f92672>,</span> Object model<span style=color:#f92672>,</span> Target<span style=color:#f92672>&lt;</span>Drawable<span style=color:#f92672>&gt;</span> target<span style=color:#f92672>,</span> DataSource dataSource<span style=color:#f92672>,</span> <span style=color:#66d9ef>boolean</span> isFirstResource<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        requireParentFragment<span style=color:#f92672>().</span><span style=color:#a6e22e>startPostponedEnterTransition</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>DetailViewPagerAdapter的实现就比较简单了，继承自FragmentStatePagerAdapter</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DetailViewPagerAdapter</span> <span style=color:#66d9ef>extends</span> FragmentStatePagerAdapter <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> size<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> List<span style=color:#f92672>&lt;</span>Photo<span style=color:#f92672>&gt;</span> photos<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    DetailViewPagerAdapter<span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> FragmentManager fm<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> size<span style=color:#f92672>,</span> List<span style=color:#f92672>&lt;</span>Photo<span style=color:#f92672>&gt;</span> photos<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>(</span>fm<span style=color:#f92672>,</span> BEHAVIOR_RESUME_ONLY_CURRENT_FRAGMENT<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>size</span> <span style=color:#f92672>=</span> size<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>photos</span> <span style=color:#f92672>=</span> photos<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getCount</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> size<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NonNull</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Fragment <span style=color:#a6e22e>getItem</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> position<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> DetailFragment<span style=color:#f92672>(</span>photos<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>position<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>最后是DetailPagerFragment，ViewModel中Photo数据的观察，以及Toolbar返回功能的修改</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// 返回现过必须通过onBackPressed实现，否则共享元素动画会消失
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>private</span> View<span style=color:#f92672>.</span><span style=color:#a6e22e>OnClickListener</span> navigateListener <span style=color:#f92672>=</span> view <span style=color:#f92672>-&gt;</span> requireActivity<span style=color:#f92672>().</span><span style=color:#a6e22e>onBackPressed</span><span style=color:#f92672>();</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>viewModel<span style=color:#f92672>.</span><span style=color:#a6e22e>getPhotos</span><span style=color:#f92672>().</span><span style=color:#a6e22e>observe</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>,</span> photos <span style=color:#f92672>-&gt;</span> viewPager<span style=color:#f92672>.</span><span style=color:#a6e22e>setAdapter</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> DetailViewPagerAdapter<span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>        getChildFragmentManager<span style=color:#f92672>(),</span> photos<span style=color:#f92672>.</span><span style=color:#a6e22e>size</span><span style=color:#f92672>(),</span> photos<span style=color:#f92672>)));</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Set the current position and add a listener that will update the selection coordinator when
</span></span></span><span style=display:flex><span><span style=color:#75715e>// paging the images.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>viewModel<span style=color:#f92672>.</span><span style=color:#a6e22e>getCurrentPosition</span><span style=color:#f92672>().</span><span style=color:#a6e22e>observe</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>,</span> position <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    viewPager<span style=color:#f92672>.</span><span style=color:#a6e22e>setCurrentItem</span><span style=color:#f92672>(</span>position<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    currentPosition <span style=color:#f92672>=</span> position<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Toolbar toolbar <span style=color:#f92672>=</span> view<span style=color:#f92672>.</span><span style=color:#a6e22e>findViewById</span><span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>toolbar</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>toolbar<span style=color:#f92672>.</span><span style=color:#a6e22e>setNavigationOnClickListener</span><span style=color:#f92672>(</span>navigateListener<span style=color:#f92672>);</span>
</span></span></code></pre></div><h2 id=4-使用技巧总结>4. 使用技巧总结<a hidden class=anchor aria-hidden=true href=#4-使用技巧总结>#</a></h2><ol><li>Fragment中使用时，当前Fragment的共享元素的<code>transitionName</code>必须存在但是与目的地Fragment不同也能用，且RecyclerView中的每一个共享元素都必须设置为不同的<code>transitionName</code>（Activity中当前Activity的<code>transitionName</code>可以不设置，包括使用了RecyclerView，目的地Activity必须设置），<strong>但是实际使用时请务必将对应共享元素的<code>transitionName</code>设置为相同（RecyclerView除外）</strong>；</li><li>Fragment中使用时，当目的地Fragment中共享元素被嵌套了多层，则可能出现滑动动画缺失现象，可以通过<code>marginTop:1dp</code>解决；Activity中不会有这种现象；</li><li>切换动画产生时会导致状态栏、ActionBar以及Toolbar的闪烁，可以通过在动画中将这些View的id排除即可避免；</li><li>如果使用了Glide或者Picasso等图片加载框架从网络请求加载图片，可以在Activity中设置<code>supportPostponeEnterTransition()</code>以及<code>supportStartPostponedEnterTransition()</code>方法来确保图片能够先缓存再显示（或者是<code>postponeEnterTransition()</code>和<code>startPostponedEnterTransition()</code>），但是会导致另一个问题，点击跳转非常卡顿；</li><li>ViewPager配合使用实现左右滑动查看图片时，返回动画会出错，显示错误的图片，此时可以通过对ViewPager中的Fragment设置<code>setSharedElementReturnTransition(null)</code>来禁用返回动画（<a href=https://mikescamell.com/shared-element-transitions-part-4-recyclerview/>参考</a>）；</li><li>如果需要完成良好的动画效果体验，请参考Github上的示例，在SharedElementCallback中处理共享元素匹配，并在合适的实际调用<code>postponeEnterTransition()</code>和<code>startPostponedEnterTransition()</code>。</li></ol><h2 id=参考>参考：<a hidden class=anchor aria-hidden=true href=#参考>#</a></h2><ol><li><a href=https://developer.android.com/training/transitions/start-activity>Android Developers文档指南</a></li><li><a href=https://github.com/android/animation-samples>Github animation-samples</a></li><li><a href=https://mikescamell.com/shared-element-transitions-part-1/>Shared Element Transitions - Part 1: Activities</a></li><li><a href=https://mikescamell.com/shared-element-transitions-part-2/>Shared Element Transitions - Part 2: Fragments</a></li><li><a href=https://mikescamell.com/shared-element-transitions-part-3/>Shared Element Transitions - Part 3: Picasso & Glide</a></li><li><a href=https://github.com/codepath/android_guides/wiki/Shared-Element-Activity-Transition>android_guides</a></li><li><a href=https://medium.com/@bherbst/fragment-transitions-with-shared-elements-7c7d71d31cbb>Fragment transitions with shared elements</a></li></ol></div><footer class=post-footer><ul class=post-tags><li><a href=https://zhoutao822.github.io/tags/shareelement/>ShareElement</a></li></ul><nav class=paginav><a class=prev href=https://zhoutao822.github.io/posts/hugo-on-mac/><span class=title>« Prev Page</span><br><span>Hugo On Mac</span></a>
<a class=next href=https://zhoutao822.github.io/posts/saf/><span class=title>Next Page »</span><br><span>Android-Q适配-存储方式</span></a></nav></footer><script src=https://utteranc.es/client.js repo=zhoutao822/zhoutao822.github.io issue-term=title theme=github-dark crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2022 <a href=https://zhoutao822.github.io/>Tao's Notes</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>