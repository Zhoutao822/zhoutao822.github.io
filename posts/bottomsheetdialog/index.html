<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>BottomSheetDialog | Tao's Notes</title><meta name=keywords content="android,MD,BottomSheetDialog"><meta name=description content="BottomSheetDialog使用以及相关问题"><meta name=author content="Me"><link rel=canonical href=https://zhoutao822.github.io/posts/bottomsheetdialog/><meta name=google-site-verification content="Tao"><meta name=yandex-verification content="Tao"><meta name=msvalidate.01 content="Tao"><link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://zhoutao822.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://zhoutao822.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://zhoutao822.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://zhoutao822.github.io/apple-touch-icon.png><link rel=mask-icon href=https://zhoutao822.github.io/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.103.1"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="BottomSheetDialog"><meta property="og:description" content="BottomSheetDialog使用以及相关问题"><meta property="og:type" content="article"><meta property="og:url" content="https://zhoutao822.github.io/posts/bottomsheetdialog/"><meta property="og:image" content="https://zhoutao822.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-06-14T20:21:20+08:00"><meta property="article:modified_time" content="2019-06-14T20:21:20+08:00"><meta property="og:site_name" content="Tao's Notes"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://zhoutao822.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="BottomSheetDialog"><meta name=twitter:description content="BottomSheetDialog使用以及相关问题"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://zhoutao822.github.io/posts/"},{"@type":"ListItem","position":2,"name":"BottomSheetDialog","item":"https://zhoutao822.github.io/posts/bottomsheetdialog/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"BottomSheetDialog","name":"BottomSheetDialog","description":"BottomSheetDialog使用以及相关问题","keywords":["android","MD","BottomSheetDialog"],"articleBody":"BottomSheetDialog，顾名思义就是从界面底部往上出现的Dialog，它是Material Design的控件之一，目前在Material Components库中。\n1. 准备工作 Google推出的Material Components库包括了很多常用的控件，我们只需要直接用这些控件就可以实现很多复杂的功能或界面，但是在使用之前还需要一些准备工作，大致在Getting started with Material Components for Android也给出了，我这里简要描述一下：\n首先使是依赖（建议更新项目到androidx再继续），需要在build.gradle中加入Google’s Maven Repository google()，然后加入库； allprojects { repositories { google() jcenter() } } dependencies { // ... // 目前最新版为1.1.0-alpha07，有部分控件还是存在Bug implementation 'com.google.android.material:material:1.1.0-alpha07' // ... } 其次是compileSdkVersion需要在28或以上才能使用Material控件； 然后需要使用或继承AppCompatActivity，AppCompatActivity是专门为Material控件设计的Activity，如果不能继承则需要使用AppCompatDelegate； 最后是需要修改AppTheme，在AndroidManifest.xml里面修改主题，需要继承自Material Components themes，具体有哪些可以看上面给的地址，如果暂时不允许修改AppTheme，可以使用Material Components Bridge themes，这里的区别在于使用Material Components themes可能会导致你原来的应用中某些布局颜色UI发生改变，这时候需要重新修改一些资源文件；如果使用Bridge themes则不会修改原来应用的布局颜色UI等，却可以使用Material组件。 ","wordCount":"6550","inLanguage":"en","datePublished":"2019-06-14T20:21:20+08:00","dateModified":"2019-06-14T20:21:20+08:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhoutao822.github.io/posts/bottomsheetdialog/"},"publisher":{"@type":"Organization","name":"Tao's Notes","logo":{"@type":"ImageObject","url":"https://zhoutao822.github.io/favicon.ico"}}}</script></head><body class=dark id=top><header class=header><nav class=nav><div class=logo><a href=https://zhoutao822.github.io/ accesskey=h title="Home (Alt + H)">Home</a>
<span class=logo-switches></span></div><ul id=menu><li><a href=https://zhoutao822.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://zhoutao822.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://zhoutao822.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://zhoutao822.github.io/series/ title=Series><span>Series</span></a></li><li><a href=https://zhoutao822.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://zhoutao822.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://zhoutao822.github.io/posts/>Posts</a></div><h1 class=post-title>BottomSheetDialog</h1><div class=post-meta><span title='2019-06-14 20:21:20 +0800 +0800'>June 14, 2019</span>&nbsp;·&nbsp;31 min&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/Zhoutao822/zhoutao822.github.io/tree/main/content//posts/BottomSheetDialog.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#1-%e5%87%86%e5%a4%87%e5%b7%a5%e4%bd%9c aria-label="1. 准备工作">1. 准备工作</a></li><li><a href=#2-bottomsheetdialog%e4%bd%bf%e7%94%a8 aria-label="2. BottomSheetDialog使用">2. BottomSheetDialog使用</a><ul><li><a href=#21-persistent-bottomsheetdialog aria-label="2.1 Persistent BottomSheetDialog">2.1 Persistent BottomSheetDialog</a></li><li><a href=#22-modal-bottomsheetdialog aria-label="2.2 Modal BottomSheetDialog">2.2 Modal BottomSheetDialog</a></li></ul></li><li><a href=#3-bottomsheetdialog%e8%bf%9b%e9%98%b6%e4%b8%8ebug aria-label="3. BottomSheetDialog进阶与Bug">3. BottomSheetDialog进阶与Bug</a></li><li><a href=#4-%e8%a7%a3%e5%86%b3%e6%96%b9%e6%b3%95 aria-label="4. 解决方法">4. 解决方法</a><ul><li><a href=#41-%e9%87%8d%e5%86%99viewpager%e7%9a%84adapter%e7%9a%84setprimaryitem%e6%96%b9%e6%b3%95 aria-label="4.1 重写ViewPager的Adapter的setPrimaryItem方法">4.1 重写ViewPager的Adapter的setPrimaryItem方法</a></li><li><a href=#42-%e9%87%8d%e5%86%99bottomsheetbehavior%e7%9a%84findscrollingchild%e6%96%b9%e6%b3%95 aria-label="4.2 重写BottomSheetBehavior的findScrollingChild方法">4.2 重写BottomSheetBehavior的findScrollingChild方法</a></li></ul></li><li><a href=#%e5%8f%82%e8%80%83 aria-label=参考：>参考：</a></li></ul></div></details></div><div class=post-content><p>BottomSheetDialog，顾名思义就是从界面底部往上出现的Dialog，它是Material Design的控件之一，目前在<a href=https://github.com/material-components/material-components-android>Material Components</a>库中。</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/Zhoutao822/hugo-pic/pictures/bottomsheet-1.gif alt=bottomsheet-1></p><h2 id=1-准备工作>1. 准备工作<a hidden class=anchor aria-hidden=true href=#1-准备工作>#</a></h2><p>Google推出的<a href=https://github.com/material-components/material-components-android>Material Components</a>库包括了很多常用的控件，我们只需要直接用这些控件就可以实现很多复杂的功能或界面，但是在使用之前还需要一些准备工作，大致在<a href=https://github.com/material-components/material-components-android/blob/master/docs/getting-started.md>Getting started with Material Components for Android</a>也给出了，我这里简要描述一下：</p><ul><li>首先使是依赖（建议更新项目到androidx再继续），需要在<code>build.gradle</code>中加入Google&rsquo;s Maven Repository <code>google()</code>，然后加入库；</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gradle data-lang=gradle><span style=display:flex><span>  allprojects <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    repositories <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      google<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>      jcenter<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gradle data-lang=gradle><span style=display:flex><span>dependencies <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// 目前最新版为1.1.0-alpha07，有部分控件还是存在Bug
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    implementation <span style=color:#e6db74>&#39;com.google.android.material:material:1.1.0-alpha07&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#f92672>}</span>
</span></span></code></pre></div><ul><li>其次是<code>compileSdkVersion</code>需要在<code>28</code>或以上才能使用Material控件；</li><li>然后需要使用或继承<code>AppCompatActivity</code>，<code>AppCompatActivity</code>是专门为Material控件设计的Activity，如果不能继承则需要使用<code>AppCompatDelegate</code>；</li><li>最后是需要修改<code>AppTheme</code>，在<code>AndroidManifest.xml</code>里面修改主题，需要继承自Material Components themes，具体有哪些可以看上面给的地址，如果暂时不允许修改<code>AppTheme</code>，可以使用Material Components Bridge themes，这里的区别在于使用Material Components themes可能会导致你原来的应用中某些布局颜色UI发生改变，这时候需要重新修改一些资源文件；如果使用Bridge themes则不会修改原来应用的布局颜色UI等，却可以使用Material组件。</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>    <span style=color:#f92672>&lt;style</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;AppTheme&#34;</span> <span style=color:#a6e22e>parent=</span><span style=color:#e6db74>&#34;Theme.MaterialComponents.NoActionBar.Bridge&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>&lt;!-- Customize your theme here. --&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;colorPrimary&#34;</span><span style=color:#f92672>&gt;</span>@color/colorPrimary<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;colorPrimaryDark&#34;</span><span style=color:#f92672>&gt;</span>@color/colorPrimaryDark<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;colorAccent&#34;</span><span style=color:#f92672>&gt;</span>@color/colorAccent<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/style&gt;</span>
</span></span></code></pre></div><p>到这里，准备工作基本完成，可以进行下一步使用Material组件了。</p><h2 id=2-bottomsheetdialog使用>2. BottomSheetDialog使用<a hidden class=anchor aria-hidden=true href=#2-bottomsheetdialog使用>#</a></h2><p>根据官网说明，BottomSheetDialog有两种使用方式（这里很多博客没有说明就直接给代码了），一种是Persistent，另一种是Modal，简而言之就是前者是固定的BottomSheetDialog，后者是动态调用的。</p><h3 id=21-persistent-bottomsheetdialog>2.1 Persistent BottomSheetDialog<a hidden class=anchor aria-hidden=true href=#21-persistent-bottomsheetdialog>#</a></h3><p>设想一个使用场景，某个界面必定包含BottomSheetDialog，需要靠它实现其他功能的选择，举个例子，知乎的评论就是依靠BottomSheetDialog来实现的（一个东西看起来像鸭子，吃起来也像鸭子，那么它就是鸭子），而且有很明显的特征：在回答界面必定存在这个评论功能，那么我们可以将它视为Persistent固定场景，此时实现BottomSheetDialog的方式是使用BottomSheetBehavior，而不是<code>new BottomSheetDialog()</code>，实例代码如下：</p><ul><li>首先是activity的布局文件<code>activity_second.xml</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!-- 注意要使用BottomSheetBehavior，则必须使用CoordinatorLayout作为父布局，而且需要xmlns:app --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;androidx.coordinatorlayout.widget.CoordinatorLayout</span> <span style=color:#a6e22e>xmlns:android=</span><span style=color:#e6db74>&#34;http://schemas.android.com/apk/res/android&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>xmlns:app=</span><span style=color:#e6db74>&#34;http://schemas.android.com/apk/res-auto&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;match_parent&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;LinearLayout</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:orientation=</span><span style=color:#e6db74>&#34;vertical&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;Button</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/btn_show&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:layout_gravity=</span><span style=color:#e6db74>&#34;center&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:text=</span><span style=color:#e6db74>&#34;Show&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/LinearLayout&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>&lt;!-- BottomSheetBehavior需要一个寄主，可以是LinearLayout也可以是其他，这个layout就是弹出的dialog布局，
</span></span></span><span style=display:flex><span><span style=color:#75715e>     同时需要几个属性：
</span></span></span><span style=display:flex><span><span style=color:#75715e>     app:behavior_hideable=&#34;true&#34;否则BottomSheetDialog不会收起来
</span></span></span><span style=display:flex><span><span style=color:#75715e>     app:behavior_peekHeight=&#34;300dp&#34;设置BottomSheetDialog在STATE_COLLAPSED状态的高度，也可以不设置，这个会产生一种弹性收缩的效果，具体自行尝试
</span></span></span><span style=display:flex><span><span style=color:#75715e>     app:elevation=&#34;6dp&#34;设置z轴高度，可以产生一种悬浮效果，可以不设置
</span></span></span><span style=display:flex><span><span style=color:#75715e>     app:layout_behavior=&#34;com.google.android.material.bottomsheet.BottomSheetBehavior&#34;最重要的属性，简而言之就是让LinearLayout
</span></span></span><span style=display:flex><span><span style=color:#75715e>     的行为变成BottomSheetDialog的行为，这样我们就不需要实例化一个BottomSheetDialog，取而代之的是通过BottomSheetBehavior来实现，
</span></span></span><span style=display:flex><span><span style=color:#75715e>     需要注意的地方是，app:layout_behavior只能在CoordinatorLayout下直接子控件中使用，像这里的CoordinatorLayout-&gt;LinearLayout就可以
</span></span></span><span style=display:flex><span><span style=color:#75715e>      --&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;LinearLayout</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/bottom_sheet&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:background=</span><span style=color:#e6db74>&#34;@color/white&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:orientation=</span><span style=color:#e6db74>&#34;vertical&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>app:behavior_hideable=</span><span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>app:behavior_peekHeight=</span><span style=color:#e6db74>&#34;300dp&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>app:elevation=</span><span style=color:#e6db74>&#34;6dp&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>app:layout_behavior=</span><span style=color:#e6db74>&#34;com.google.android.material.bottomsheet.BottomSheetBehavior&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>&lt;!-- 这里随便加了几个子项，在BottomSheetBehavior布局下的子控件都是BottomSheetDialog一部分 --&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;LinearLayout</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:orientation=</span><span style=color:#e6db74>&#34;horizontal&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;ImageView</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>style=</span><span style=color:#e6db74>&#34;@style/MenuIcon&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>android:src=</span><span style=color:#e6db74>&#34;@drawable/ic_share_black_24dp&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;TextView</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>style=</span><span style=color:#e6db74>&#34;@style/MenuText&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>android:text=</span><span style=color:#e6db74>&#34;Share&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/LinearLayout&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;LinearLayout</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:orientation=</span><span style=color:#e6db74>&#34;horizontal&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;ImageView</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>style=</span><span style=color:#e6db74>&#34;@style/MenuIcon&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>android:src=</span><span style=color:#e6db74>&#34;@drawable/ic_cloud_upload_black_24dp&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;TextView</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>style=</span><span style=color:#e6db74>&#34;@style/MenuText&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>android:text=</span><span style=color:#e6db74>&#34;Upload&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/LinearLayout&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;LinearLayout</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:orientation=</span><span style=color:#e6db74>&#34;horizontal&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;ImageView</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>style=</span><span style=color:#e6db74>&#34;@style/MenuIcon&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>android:src=</span><span style=color:#e6db74>&#34;@drawable/ic_content_copy_black_24dp&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;TextView</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>style=</span><span style=color:#e6db74>&#34;@style/MenuText&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>android:text=</span><span style=color:#e6db74>&#34;Copy&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/LinearLayout&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;LinearLayout</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:orientation=</span><span style=color:#e6db74>&#34;horizontal&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;ImageView</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>style=</span><span style=color:#e6db74>&#34;@style/MenuIcon&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>android:src=</span><span style=color:#e6db74>&#34;@drawable/ic_print_black_24dp&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;TextView</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>style=</span><span style=color:#e6db74>&#34;@style/MenuText&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>android:text=</span><span style=color:#e6db74>&#34;Print&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/LinearLayout&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/LinearLayout&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/androidx.coordinatorlayout.widget.CoordinatorLayout&gt;</span>
</span></span></code></pre></div><p>这里用了<code>styles.xml</code>减少重复代码</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>    <span style=color:#f92672>&lt;style</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;MenuIcon&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;android:layout_height&#34;</span><span style=color:#f92672>&gt;</span>30dp<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;android:layout_width&#34;</span><span style=color:#f92672>&gt;</span>30dp<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;android:layout_margin&#34;</span><span style=color:#f92672>&gt;</span>15dp<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/style&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;style</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;MenuText&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;android:layout_gravity&#34;</span><span style=color:#f92672>&gt;</span>center_vertical<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;android:layout_marginStart&#34;</span><span style=color:#f92672>&gt;</span>30dp<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;android:gravity&#34;</span><span style=color:#f92672>&gt;</span>start<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;android:textColor&#34;</span><span style=color:#f92672>&gt;</span>#00574B<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;android:textSize&#34;</span><span style=color:#f92672>&gt;</span>20sp<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/style&gt;</span>
</span></span></code></pre></div><ul><li>然后是activity的代码<code>SecondActivity.java</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SecondActivity</span> <span style=color:#66d9ef>extends</span> AppCompatActivity <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onCreate</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@Nullable</span> Bundle savedInstanceState<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>onCreate</span><span style=color:#f92672>(</span>savedInstanceState<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        setContentView<span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>layout</span><span style=color:#f92672>.</span><span style=color:#a6e22e>activity_second</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// BottomSheetBehavior一共有5个状态：STATE_COLLAPSED/STATE_EXPANDED/STATE_DRAGGING/STATE_SETTLING/STATE_HIDDEN
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// 当你的布局文件中BottomSheetBehavior控件高度大于设置behavior_peekHeight，则Dialog会产生三种位置，一个是隐藏STATE_HIDDEN，
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// 另一个是STATE_EXPANDED即BottomSheetBehavior控件全部显示出来的位置，还有一个是介于前两者之间的STATE_COLLAPSED状态，
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// 此时露出来的Dialog高度为behavior_peekHeight；
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// 另一种情况是behavior_peekHeight大于BottomSheetBehavior控件高度，那么会产生一种弹性收缩的效果
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        BottomSheetBehavior bottomSheetBehavior <span style=color:#f92672>=</span> BottomSheetBehavior<span style=color:#f92672>.</span><span style=color:#a6e22e>from</span><span style=color:#f92672>(</span>findViewById<span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>bottom_sheet</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>        bottomSheetBehavior<span style=color:#f92672>.</span><span style=color:#a6e22e>setState</span><span style=color:#f92672>(</span>BottomSheetBehavior<span style=color:#f92672>.</span><span style=color:#a6e22e>STATE_HIDDEN</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        findViewById<span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>btn_show</span><span style=color:#f92672>).</span><span style=color:#a6e22e>setOnClickListener</span><span style=color:#f92672>(</span>v <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 这里通过判断当前状态来进行收缩和打开，与此同时Dialog支持直接滑动关闭
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>bottomSheetBehavior<span style=color:#f92672>.</span><span style=color:#a6e22e>getState</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> BottomSheetBehavior<span style=color:#f92672>.</span><span style=color:#a6e22e>STATE_HIDDEN</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                bottomSheetBehavior<span style=color:#f92672>.</span><span style=color:#a6e22e>setState</span><span style=color:#f92672>(</span>BottomSheetBehavior<span style=color:#f92672>.</span><span style=color:#a6e22e>STATE_COLLAPSED</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>bottomSheetBehavior<span style=color:#f92672>.</span><span style=color:#a6e22e>getState</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> BottomSheetBehavior<span style=color:#f92672>.</span><span style=color:#a6e22e>STATE_COLLAPSED</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                bottomSheetBehavior<span style=color:#f92672>.</span><span style=color:#a6e22e>setState</span><span style=color:#f92672>(</span>BottomSheetBehavior<span style=color:#f92672>.</span><span style=color:#a6e22e>STATE_HIDDEN</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 通过设置BottomSheetCallback来控制状态变化产生的其他效果，也可以控制滑动过程中产生其他效果
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        bottomSheetBehavior<span style=color:#f92672>.</span><span style=color:#a6e22e>setBottomSheetCallback</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> BottomSheetBehavior<span style=color:#f92672>.</span><span style=color:#a6e22e>BottomSheetCallback</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onStateChanged</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> View bottomSheet<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> newState<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>//拖动
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onSlide</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> View bottomSheet<span style=color:#f92672>,</span> <span style=color:#66d9ef>float</span> slideOffset<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>//状态变化
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><ul><li>在设备屏幕旋转时BottomSheetDialog会消失，通过在<code>AndroidManifest.xml</code>设置<code>configChanges</code>可以避免</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>        <span style=color:#f92672>&lt;activity</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;.SecondActivity&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:configChanges=</span><span style=color:#e6db74>&#34;orientation&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span></code></pre></div><p>至此，简单的通过BottomSheetBehavior实现BottomSheetDialog就结束了，更复杂的效果是添加RecyclerView到BottomSheetDialog
中，同时增加点击事件监听等等，接下来介绍如何动态使用BottomSheetDialog。</p><h3 id=22-modal-bottomsheetdialog>2.2 Modal BottomSheetDialog<a hidden class=anchor aria-hidden=true href=#22-modal-bottomsheetdialog>#</a></h3><p>如果你使用过AlertDialog那么就应该知道了，动态调用就是直接new一个出来，然后show一下就完事了，同理对BottomSheetDialog也成立，
因此不需要固定的BottomSheetBehavior，而直接new也分为两种方式，一个是<code>new BottomSheetDialog()</code>，另一个是<code>new BottomSheetDialog()</code>，
两者显示效果相同，但是后者通过fragment控制生命周期更合理，所以使用后者，简单使用的话只需要三步：</p><ol><li>继承自<strong>BottomSheetDialogFragment</strong>；</li><li>重写<strong>onCreateView</strong>方法，加入你自定义的布局；</li><li>调用<strong>show</strong>方法，这里需要<strong>Activity.getSupportFragmentManager()</strong>。</li></ol><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/Zhoutao822/hugo-pic/pictures/design1.png alt=design1></p><p>我这里实现一个相对复杂的布局，如上图所示，具体包括两部分，一个是header，header可以是一个自定义view，也可以将header隐藏，header与下面的Menu之间是透明的，下面的Menu通过RecyclerView控制选项数量，点击单个选项有水波纹效果，代码如下：</p><ul><li>首先是Dialog的布局文件<code>dialog_option.xml</code>，根据上面的描述就知道是一个RecyclerView</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;LinearLayout</span> <span style=color:#a6e22e>xmlns:android=</span><span style=color:#e6db74>&#34;http://schemas.android.com/apk/res/android&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/forget_psw_bottom_sheet_layout&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:orientation=</span><span style=color:#e6db74>&#34;vertical&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;androidx.recyclerview.widget.RecyclerView</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/menu_list&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/LinearLayout&gt;</span>
</span></span></code></pre></div><ul><li>然后是需要实现这个Dialog为透明背景，这是因为header也在RecyclerView中，那么只有透明背景才可以实现header悬浮的效果，Dialog透明背景需要styles文件</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>    <span style=color:#f92672>&lt;style</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;SheetDialog&#34;</span> <span style=color:#a6e22e>parent=</span><span style=color:#e6db74>&#34;Theme.Design.Light.BottomSheetDialog&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>&lt;!-- 关键属性是colorBackground，transparent可以是背景透明，但是这会导致一个问题，此处伏笔 --&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;android:windowIsTranslucent&#34;</span><span style=color:#f92672>&gt;</span>true<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;android:windowContentOverlay&#34;</span><span style=color:#f92672>&gt;</span>@null<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;android:colorBackground&#34;</span><span style=color:#f92672>&gt;</span>@android:color/transparent<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;android:backgroundDimEnabled&#34;</span><span style=color:#f92672>&gt;</span>true<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;android:backgroundDimAmount&#34;</span><span style=color:#f92672>&gt;</span>0.3<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;android:windowFrame&#34;</span><span style=color:#f92672>&gt;</span>@null<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;android:windowIsFloating&#34;</span><span style=color:#f92672>&gt;</span>true<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/style&gt;</span>
</span></span></code></pre></div><ul><li>以及header的布局文件<code>card_layout.xml</code>和Menu Item的布局文件<code>menu_item.xml</code>，header有圆角，可以用另一种Material组件实现CardView</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!-- card_layout.xml --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;LinearLayout</span> <span style=color:#a6e22e>xmlns:android=</span><span style=color:#e6db74>&#34;http://schemas.android.com/apk/res/android&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>xmlns:app=</span><span style=color:#e6db74>&#34;http://schemas.android.com/apk/res-auto&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:orientation=</span><span style=color:#e6db74>&#34;horizontal&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:padding=</span><span style=color:#e6db74>&#34;8dp&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;androidx.cardview.widget.CardView</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;0dp&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_margin=</span><span style=color:#e6db74>&#34;4dp&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_weight=</span><span style=color:#e6db74>&#34;1&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:elevation=</span><span style=color:#e6db74>&#34;4dp&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>app:cardCornerRadius=</span><span style=color:#e6db74>&#34;10dp&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;LinearLayout</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:background=</span><span style=color:#e6db74>&#34;@color/white&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:orientation=</span><span style=color:#e6db74>&#34;horizontal&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:padding=</span><span style=color:#e6db74>&#34;12dp&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;TextView</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>style=</span><span style=color:#e6db74>&#34;@style/Image&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>android:text=</span><span style=color:#e6db74>&#34;@string/glass&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;TextView</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>style=</span><span style=color:#e6db74>&#34;@style/Image&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>android:text=</span><span style=color:#e6db74>&#34;@string/clap&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;TextView</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>style=</span><span style=color:#e6db74>&#34;@style/Image&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>android:text=</span><span style=color:#e6db74>&#34;@string/cry&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;TextView</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>style=</span><span style=color:#e6db74>&#34;@style/Image&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>android:text=</span><span style=color:#e6db74>&#34;@string/party&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;TextView</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>style=</span><span style=color:#e6db74>&#34;@style/Image&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>android:text=</span><span style=color:#e6db74>&#34;@string/heart&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;TextView</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>style=</span><span style=color:#e6db74>&#34;@style/Image&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>android:text=</span><span style=color:#e6db74>&#34;@string/thumb&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;ImageView</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>style=</span><span style=color:#e6db74>&#34;@style/Image&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>android:src=</span><span style=color:#e6db74>&#34;@drawable/ic_keyboard_arrow_right_black_24dp&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/LinearLayout&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/androidx.cardview.widget.CardView&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;androidx.cardview.widget.CardView</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_margin=</span><span style=color:#e6db74>&#34;4dp&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:elevation=</span><span style=color:#e6db74>&#34;4dp&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>app:cardCornerRadius=</span><span style=color:#e6db74>&#34;10dp&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;LinearLayout</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:background=</span><span style=color:#e6db74>&#34;@color/white&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:orientation=</span><span style=color:#e6db74>&#34;horizontal&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:padding=</span><span style=color:#e6db74>&#34;12dp&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;ImageView</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;20dp&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;20dp&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>android:layout_gravity=</span><span style=color:#e6db74>&#34;center&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>android:src=</span><span style=color:#e6db74>&#34;@drawable/outline&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/LinearLayout&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/androidx.cardview.widget.CardView&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/LinearLayout&gt;</span>
</span></span></code></pre></div><p>这里使用了strings的资源，通过Unicode表示表情符号</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;resources&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;string</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;thumb&#34;</span><span style=color:#f92672>&gt;</span>&amp;#128532;<span style=color:#f92672>&lt;/string&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;string</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;heart&#34;</span><span style=color:#f92672>&gt;</span>❤️<span style=color:#f92672>&lt;/string&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;string</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;party&#34;</span><span style=color:#f92672>&gt;</span>&amp;#128222;<span style=color:#f92672>&lt;/string&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;string</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;cry&#34;</span><span style=color:#f92672>&gt;</span>&amp;#128722;<span style=color:#f92672>&lt;/string&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;string</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;clap&#34;</span><span style=color:#f92672>&gt;</span>&amp;#128512;<span style=color:#f92672>&lt;/string&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;string</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;glass&#34;</span><span style=color:#f92672>&gt;</span>&amp;#128522;<span style=color:#f92672>&lt;/string&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/resources&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!-- menu_item.xml --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;LinearLayout</span> <span style=color:#a6e22e>xmlns:android=</span><span style=color:#e6db74>&#34;http://schemas.android.com/apk/res/android&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>&lt;!-- 注意这里伏笔就来了，设置为透明背景的Dialog中，子控件也会是透明的，而且若对子控件的background
</span></span></span><span style=display:flex><span><span style=color:#75715e>    设置为某种颜色则无法产生水波纹效果，所以需要自定义@drawable/touch_bg --&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;TextView</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/menu_text&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>style=</span><span style=color:#e6db74>&#34;@style/BottomDialog&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:background=</span><span style=color:#e6db74>&#34;@drawable/touch_bg&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/LinearLayout&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>    <span style=color:#f92672>&lt;style</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;BottomDialog&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;android:padding&#34;</span><span style=color:#f92672>&gt;</span>16dp<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;android:textSize&#34;</span><span style=color:#f92672>&gt;</span>16sp<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;android:textColor&#34;</span><span style=color:#f92672>&gt;</span>@color/black<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;android:gravity&#34;</span><span style=color:#f92672>&gt;</span>center<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;android:textStyle&#34;</span><span style=color:#f92672>&gt;</span>normal<span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/style&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!-- touch_bg.xml --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--Use an almost transparent color for the ripple itself--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;ripple</span> <span style=color:#a6e22e>xmlns:android=</span><span style=color:#e6db74>&#34;http://schemas.android.com/apk/res/android&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>android:color=</span><span style=color:#e6db74>&#34;#22000000&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--Use this to define the shape of the ripple effect (rectangle, oval, ring or line). 
</span></span></span><span style=display:flex><span><span style=color:#75715e>The color specified here isn&#39;t used anyway--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;item</span> <span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@android:id/mask&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;shape</span> <span style=color:#a6e22e>android:shape=</span><span style=color:#e6db74>&#34;rectangle&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;solid</span> <span style=color:#a6e22e>android:color=</span><span style=color:#e6db74>&#34;#000000&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/shape&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--This is the background for your button--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;item&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>&lt;!--Use the shape you want here--&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;shape</span> <span style=color:#a6e22e>android:shape=</span><span style=color:#e6db74>&#34;rectangle&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>&lt;!--Use the solid tag to define the background color you want (here white)--&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;solid</span> <span style=color:#a6e22e>android:color=</span><span style=color:#e6db74>&#34;@color/white&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>&lt;!--Use the stroke tag for a border--&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;stroke</span> <span style=color:#a6e22e>android:width=</span><span style=color:#e6db74>&#34;1dp&#34;</span> <span style=color:#a6e22e>android:color=</span><span style=color:#e6db74>&#34;@color/white&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/shape&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/ripple&gt;</span>
</span></span></code></pre></div><ul><li>接下来就是主要java代码了，包括<code>MenuBottomSheetDialog.java</code>和<code>MenuListAdapter.java</code>，前者是我们最终调用的Dialog，后者是RecyclerView的Adapter，以及自定义一个Menu Item的实体类<code>OptionMenuItem.java</code>用于保存信息</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OptionMenuItem</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// label表示选项的名称最终会显示在Dialog，action表示该选项的行为，这里可以自定义增加其他内容，
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// 比如增加一个state属性表示该选项是否可用等等，如不可用，则颜色为灰色且不可点击，不过我没加
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> String label<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> action<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>OptionMenuItem</span><span style=color:#f92672>(</span>String label<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> action<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>label</span> <span style=color:#f92672>=</span> label<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>action</span> <span style=color:#f92672>=</span> action<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>getLabel</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> label<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setLabel</span><span style=color:#f92672>(</span>String label<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>label</span> <span style=color:#f92672>=</span> label<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getAction</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> action<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setAction</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> action<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>action</span> <span style=color:#f92672>=</span> action<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MenuBottomSheetDialog</span> <span style=color:#66d9ef>extends</span> BottomSheetDialogFragment <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> String TAG <span style=color:#f92672>=</span> MenuBottomSheetDialog<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getSimpleName</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> RecyclerView recyclerView<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> MenuListAdapter adapter<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 这里还加了一个参数hasItemDecoration用于控制是否显示选项之间的分割线
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> Boolean hasItemDecoration <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Context context<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> MenuBottomSheetDialog <span style=color:#a6e22e>newInstance</span><span style=color:#f92672>(</span>Builder builder<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        MenuBottomSheetDialog fragment <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MenuBottomSheetDialog<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//        Bundle bundle = new Bundle();
</span></span></span><span style=display:flex><span><span style=color:#75715e>//        fragment.setArguments(bundle);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        fragment<span style=color:#f92672>.</span><span style=color:#a6e22e>setHasItemDecoration</span><span style=color:#f92672>(</span>builder<span style=color:#f92672>.</span><span style=color:#a6e22e>hasItemDecoration</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        fragment<span style=color:#f92672>.</span><span style=color:#a6e22e>setAdapter</span><span style=color:#f92672>(</span>builder<span style=color:#f92672>.</span><span style=color:#a6e22e>adapter</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        fragment<span style=color:#f92672>.</span><span style=color:#a6e22e>setContext</span><span style=color:#f92672>(</span>builder<span style=color:#f92672>.</span><span style=color:#a6e22e>context</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> fragment<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NonNull</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Dialog <span style=color:#a6e22e>onCreateDialog</span><span style=color:#f92672>(</span>Bundle savedInstanceState<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// R.style.SheetDialog 透明背景需要在onCreateDialog方法引入
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> BottomSheetDialog<span style=color:#f92672>(</span>context<span style=color:#f92672>,</span> R<span style=color:#f92672>.</span><span style=color:#a6e22e>style</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SheetDialog</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Nullable</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> View <span style=color:#a6e22e>onCreateView</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> LayoutInflater inflater<span style=color:#f92672>,</span> <span style=color:#a6e22e>@Nullable</span> ViewGroup container<span style=color:#f92672>,</span> 
</span></span><span style=display:flex><span>                              <span style=color:#a6e22e>@Nullable</span> Bundle savedInstanceState<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 在onCreateView引入定义的dialog布局
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>return</span> inflater<span style=color:#f92672>.</span><span style=color:#a6e22e>inflate</span><span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>layout</span><span style=color:#f92672>.</span><span style=color:#a6e22e>dialog_option</span><span style=color:#f92672>,</span> container<span style=color:#f92672>,</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onViewCreated</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> View view<span style=color:#f92672>,</span> <span style=color:#a6e22e>@Nullable</span> Bundle savedInstanceState<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>onViewCreated</span><span style=color:#f92672>(</span>view<span style=color:#f92672>,</span> savedInstanceState<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// onViewCreated中进行初始化，这里就很简单的使用了RecyclerView
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        recyclerView <span style=color:#f92672>=</span> view<span style=color:#f92672>.</span><span style=color:#a6e22e>findViewById</span><span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>menu_list</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        recyclerView<span style=color:#f92672>.</span><span style=color:#a6e22e>setLayoutManager</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> LinearLayoutManager<span style=color:#f92672>(</span>getContext<span style=color:#f92672>()));</span>
</span></span><span style=display:flex><span>        recyclerView<span style=color:#f92672>.</span><span style=color:#a6e22e>setAdapter</span><span style=color:#f92672>(</span>adapter<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>hasItemDecoration<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// DividerItemDecoration可以方便的加入到RecyclerView，形成分割线，布局文件在下面
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            DividerItemDecoration dec <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> DividerItemDecoration<span style=color:#f92672>(</span>context<span style=color:#f92672>,</span> DividerItemDecoration<span style=color:#f92672>.</span><span style=color:#a6e22e>VERTICAL</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            dec<span style=color:#f92672>.</span><span style=color:#a6e22e>setDrawable</span><span style=color:#f92672>(</span>getResources<span style=color:#f92672>().</span><span style=color:#a6e22e>getDrawable</span><span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>drawable</span><span style=color:#f92672>.</span><span style=color:#a6e22e>divider_line</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>            recyclerView<span style=color:#f92672>.</span><span style=color:#a6e22e>addItemDecoration</span><span style=color:#f92672>(</span>dec<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 最终我们通过show方法调用
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>show</span><span style=color:#f92672>(</span>FragmentManager fragmentManager<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        FragmentTransaction transaction <span style=color:#f92672>=</span> fragmentManager<span style=color:#f92672>.</span><span style=color:#a6e22e>beginTransaction</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        Fragment prevFragment <span style=color:#f92672>=</span> fragmentManager<span style=color:#f92672>.</span><span style=color:#a6e22e>findFragmentByTag</span><span style=color:#f92672>(</span>TAG<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>prevFragment <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            transaction<span style=color:#f92672>.</span><span style=color:#a6e22e>remove</span><span style=color:#f92672>(</span>prevFragment<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        transaction<span style=color:#f92672>.</span><span style=color:#a6e22e>addToBackStack</span><span style=color:#f92672>(</span><span style=color:#66d9ef>null</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        show<span style=color:#f92672>(</span>transaction<span style=color:#f92672>,</span> TAG<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 这里因为参数可能会有很多，所以采用建造者模式实现
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> Builder <span style=color:#a6e22e>builder</span><span style=color:#f92672>(</span>Context context<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Builder<span style=color:#f92672>(</span>context<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Builder</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 建造者模式需要传入的参数有三个
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>private</span> MenuListAdapter adapter<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> Boolean hasItemDecoration<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> Context context<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>Builder</span><span style=color:#f92672>(</span>Context context<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>context</span> <span style=color:#f92672>=</span> context<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 以下都是建造者模式可调用的方法
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>public</span> Builder <span style=color:#a6e22e>setAdapter</span><span style=color:#f92672>(</span>MenuListAdapter adapter<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>adapter</span> <span style=color:#f92672>=</span> adapter<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> Builder <span style=color:#a6e22e>setHasItemDecoration</span><span style=color:#f92672>(</span>Boolean hasItemDecoration<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>hasItemDecoration</span> <span style=color:#f92672>=</span> hasItemDecoration<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> MenuBottomSheetDialog <span style=color:#a6e22e>build</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> newInstance<span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> MenuBottomSheetDialog <span style=color:#a6e22e>show</span><span style=color:#f92672>(</span>FragmentManager fragmentManager<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            MenuBottomSheetDialog dialog <span style=color:#f92672>=</span> build<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            dialog<span style=color:#f92672>.</span><span style=color:#a6e22e>show</span><span style=color:#f92672>(</span>fragmentManager<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> dialog<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setAdapter</span><span style=color:#f92672>(</span>MenuListAdapter adapter<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>adapter</span> <span style=color:#f92672>=</span> adapter<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setContext</span><span style=color:#f92672>(</span>Context context<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>context</span> <span style=color:#f92672>=</span> context<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setHasItemDecoration</span><span style=color:#f92672>(</span>Boolean hasItemDecoration<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>hasItemDecoration</span> <span style=color:#f92672>=</span> hasItemDecoration<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!-- divider_line.xml --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;layer-list</span> <span style=color:#a6e22e>xmlns:android=</span><span style=color:#e6db74>&#34;http://schemas.android.com/apk/res/android&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>&lt;!--分割线左右边距--&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;item&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;shape&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;solid</span> <span style=color:#a6e22e>android:color=</span><span style=color:#e6db74>&#34;@color/split_line_grey&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;size</span> <span style=color:#a6e22e>android:height=</span><span style=color:#e6db74>&#34;1dp&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/shape&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/item&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/layer-list&gt;</span>
</span></span></code></pre></div><ul><li>接下来是RecyclerView的Adapter文件<code>MenuListAdapter.java</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MenuListAdapter</span> <span style=color:#66d9ef>extends</span> RecyclerView<span style=color:#f92672>.</span><span style=color:#a6e22e>Adapter</span><span style=color:#f92672>&lt;</span>RecyclerView<span style=color:#f92672>.</span><span style=color:#a6e22e>ViewHolder</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 通过hasHeader控制是否显示header，这里是通过MenuListAdapter传入的参数，没有用上面建造者模式
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> Boolean hasHeader<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 监听选项点击，这里我仅仅对选项做监听没有对header进行任何控制，所以header只是个没有灵魂的花瓶
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> OnMenuItemClickListener onMenuClickListener<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 传入的选项list
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> List<span style=color:#f92672>&lt;</span>OptionMenuItem<span style=color:#f92672>&gt;</span> options<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// onCreateViewHolder判断是否为header的参数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> VIEW_TYPE_HEADER <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> VIEW_TYPE_ITEM <span style=color:#f92672>=</span> 1<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>MenuListAdapter</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>options</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>MenuListAdapter</span><span style=color:#f92672>(</span>List<span style=color:#f92672>&lt;</span>OptionMenuItem<span style=color:#f92672>&gt;</span> options<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>options</span> <span style=color:#f92672>=</span> options<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NonNull</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> RecyclerView<span style=color:#f92672>.</span><span style=color:#a6e22e>ViewHolder</span> <span style=color:#a6e22e>onCreateViewHolder</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> ViewGroup parent<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> viewType<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        RecyclerView<span style=color:#f92672>.</span><span style=color:#a6e22e>ViewHolder</span> viewHolder <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>switch</span> <span style=color:#f92672>(</span>viewType<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 这里也比较好理解，如果为header传入header的布局，如果为Menu Item则传入Item的布局
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>case</span> VIEW_TYPE_HEADER<span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                viewHolder <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HeaderViewHolder<span style=color:#f92672>(</span>LayoutInflater<span style=color:#f92672>.</span><span style=color:#a6e22e>from</span><span style=color:#f92672>(</span>parent<span style=color:#f92672>.</span><span style=color:#a6e22e>getContext</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>inflate</span><span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>layout</span><span style=color:#f92672>.</span><span style=color:#a6e22e>card_layout</span><span style=color:#f92672>,</span> parent<span style=color:#f92672>,</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> VIEW_TYPE_ITEM<span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                viewHolder <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MenuItemViewHolder<span style=color:#f92672>(</span>LayoutInflater<span style=color:#f92672>.</span><span style=color:#a6e22e>from</span><span style=color:#f92672>(</span>parent<span style=color:#f92672>.</span><span style=color:#a6e22e>getContext</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>inflate</span><span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>layout</span><span style=color:#f92672>.</span><span style=color:#a6e22e>menu_item</span><span style=color:#f92672>,</span> parent<span style=color:#f92672>,</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> viewHolder<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onBindViewHolder</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> RecyclerView<span style=color:#f92672>.</span><span style=color:#a6e22e>ViewHolder</span> holder<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> position<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>switch</span> <span style=color:#f92672>(</span>holder<span style=color:#f92672>.</span><span style=color:#a6e22e>getItemViewType</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> VIEW_TYPE_HEADER<span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>// todo add header view listener
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#66d9ef>break</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> VIEW_TYPE_ITEM<span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>// 注意这里positon与header存在与否的关系，然后通过接口把点击事件传出去
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                OptionMenuItem menuItem <span style=color:#f92672>=</span> options<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>hasHeader <span style=color:#f92672>?</span> position <span style=color:#f92672>-</span> 1 <span style=color:#f92672>:</span> position<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>((</span>MenuItemViewHolder<span style=color:#f92672>)</span> holder<span style=color:#f92672>).</span><span style=color:#a6e22e>bind</span><span style=color:#f92672>(</span>menuItem<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                holder<span style=color:#f92672>.</span><span style=color:#a6e22e>itemView</span><span style=color:#f92672>.</span><span style=color:#a6e22e>setOnClickListener</span><span style=color:#f92672>(</span>v <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    Log<span style=color:#f92672>.</span><span style=color:#a6e22e>i</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;aaa&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;click&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>onMenuClickListener <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                        onMenuClickListener<span style=color:#f92672>.</span><span style=color:#a6e22e>onMenuClick</span><span style=color:#f92672>(</span>holder<span style=color:#f92672>.</span><span style=color:#a6e22e>itemView</span><span style=color:#f92672>,</span> menuItem<span style=color:#f92672>.</span><span style=color:#a6e22e>getAction</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getItemViewType</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> position<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 在getItemViewType定义type，从而在前面两个方法中获取
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>hasHeader<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>position <span style=color:#f92672>==</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> VIEW_TYPE_HEADER<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> VIEW_TYPE_ITEM<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getItemCount</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 同理options.size()与hasHeader的关系
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>return</span> hasHeader <span style=color:#f92672>?</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>(</span>options<span style=color:#f92672>.</span><span style=color:#a6e22e>size</span><span style=color:#f92672>()</span> <span style=color:#f92672>+</span> 1<span style=color:#f92672>)</span> <span style=color:#f92672>:</span> options<span style=color:#f92672>.</span><span style=color:#a6e22e>size</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MenuItemViewHolder</span> <span style=color:#66d9ef>extends</span> RecyclerView<span style=color:#f92672>.</span><span style=color:#a6e22e>ViewHolder</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        TextView text<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 正如我在Menu Item实体类中所设想的，我们可以在这里根据state进行额外的控制
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>MenuItemViewHolder</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> View itemView<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>super</span><span style=color:#f92672>(</span>itemView<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            text <span style=color:#f92672>=</span> itemView<span style=color:#f92672>.</span><span style=color:#a6e22e>findViewById</span><span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>menu_text</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>bind</span><span style=color:#f92672>(</span>OptionMenuItem optionMenuItem<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            text<span style=color:#f92672>.</span><span style=color:#a6e22e>setText</span><span style=color:#f92672>(</span>optionMenuItem<span style=color:#f92672>.</span><span style=color:#a6e22e>getLabel</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>HeaderViewHolder</span> <span style=color:#66d9ef>extends</span> RecyclerView<span style=color:#f92672>.</span><span style=color:#a6e22e>ViewHolder</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>HeaderViewHolder</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> View itemView<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>super</span><span style=color:#f92672>(</span>itemView<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addAll</span><span style=color:#f92672>(</span>List<span style=color:#f92672>&lt;</span>OptionMenuItem<span style=color:#f92672>&gt;</span> options<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>options</span><span style=color:#f92672>.</span><span style=color:#a6e22e>clear</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>options</span><span style=color:#f92672>.</span><span style=color:#a6e22e>addAll</span><span style=color:#f92672>(</span>options<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        notifyDataSetChanged<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>add</span><span style=color:#f92672>(</span>OptionMenuItem option<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>options <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>options</span><span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span>option<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            notifyDataSetChanged<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setHasHeader</span><span style=color:#f92672>(</span>Boolean hasHeader<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>hasHeader</span> <span style=color:#f92672>=</span> hasHeader<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 对外暴露的接口以及设置监听的方法
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>OnMenuItemClickListener</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onMenuClick</span><span style=color:#f92672>(</span>View view<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> action<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setOnMenuItemClickListener</span><span style=color:#f92672>(</span>OnMenuItemClickListener listener<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>onMenuClickListener</span> <span style=color:#f92672>=</span> listener<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><ul><li>最后是直接使用的方式<code>ThirdActivity.java</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ThirdActivity</span> <span style=color:#66d9ef>extends</span> AppCompatActivity <span style=color:#66d9ef>implements</span> MenuListAdapter<span style=color:#f92672>.</span><span style=color:#a6e22e>OnMenuItemClickListener</span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onCreate</span><span style=color:#f92672>(</span>Bundle savedInstanceState<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>onCreate</span><span style=color:#f92672>(</span>savedInstanceState<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        setContentView<span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>layout</span><span style=color:#f92672>.</span><span style=color:#a6e22e>activity_third</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        ArrayList<span style=color:#f92672>&lt;</span>OptionMenuItem<span style=color:#f92672>&gt;</span> list <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>        list<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> OptionMenuItem<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Forward&#34;</span><span style=color:#f92672>,</span> 98<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>        list<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> OptionMenuItem<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Copy&#34;</span><span style=color:#f92672>,</span> 2121<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>        list<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> OptionMenuItem<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Mark as unread&#34;</span><span style=color:#f92672>,</span> 111<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>        list<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> OptionMenuItem<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Star message&#34;</span><span style=color:#f92672>,</span> 66<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>        list<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> OptionMenuItem<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Cancel&#34;</span><span style=color:#f92672>,</span> 2<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        MenuListAdapter menuListAdapter <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MenuListAdapter<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        menuListAdapter<span style=color:#f92672>.</span><span style=color:#a6e22e>addAll</span><span style=color:#f92672>(</span>list<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        menuListAdapter<span style=color:#f92672>.</span><span style=color:#a6e22e>setHasHeader</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        menuListAdapter<span style=color:#f92672>.</span><span style=color:#a6e22e>setOnMenuItemClickListener</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        findViewById<span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>button2</span><span style=color:#f92672>).</span><span style=color:#a6e22e>setOnClickListener</span><span style=color:#f92672>(</span>v <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 两种方式等效
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#75715e>// MenuBottomSheetDialog.builder(ThirdActivity.this)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#75715e>//         .setAdapter(menuListAdapter)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#75715e>//         .setHasItemDecoration(true)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#75715e>//         .show(getSupportFragmentManager());
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>            MenuBottomSheetDialog dialog <span style=color:#f92672>=</span> MenuBottomSheetDialog<span style=color:#f92672>.</span><span style=color:#a6e22e>builder</span><span style=color:#f92672>(</span>ThirdActivity<span style=color:#f92672>.</span><span style=color:#a6e22e>this</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>.</span><span style=color:#a6e22e>setAdapter</span><span style=color:#f92672>(</span>menuListAdapter<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>.</span><span style=color:#a6e22e>setHasItemDecoration</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>.</span><span style=color:#a6e22e>build</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            dialog<span style=color:#f92672>.</span><span style=color:#a6e22e>show</span><span style=color:#f92672>(</span>getSupportFragmentManager<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onMenuClick</span><span style=color:#f92672>(</span>View view<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> action<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 点击事件的回调
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        Toast<span style=color:#f92672>.</span><span style=color:#a6e22e>makeText</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;action &#34;</span> <span style=color:#f92672>+</span> action<span style=color:#f92672>,</span> Toast<span style=color:#f92672>.</span><span style=color:#a6e22e>LENGTH_SHORT</span><span style=color:#f92672>).</span><span style=color:#a6e22e>show</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=3-bottomsheetdialog进阶与bug>3. BottomSheetDialog进阶与Bug<a hidden class=anchor aria-hidden=true href=#3-bottomsheetdialog进阶与bug>#</a></h2><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/Zhoutao822/hugo-pic/pictures/design2.gif alt=design2></p><p>上图即BottomSheetDialog与ViewPager以及RecyclerView之间的Bug，简而言之就是ViewPager下除了第一个页面可以滑动之外，其他页面均不可滑动，具体的<a href="https://stackoverflow.com/questions/39326321/scroll-not-working-for-multiple-recyclerview-in-bottomsheet?noredirect=1&lq=1">Error link</a>以及我在Github上提的<a href=https://github.com/material-components/material-components-android/issues/373>issue</a>，这个问题已经有大神给出了解决方法，但是官方目前还是没有引入。</p><p>下面我们就来复现这种状况，不过我的设计效果与上图略有不同，增加了一些内容，首先是TabLayout的title，它是由两部分组成，前面是一个Unicode表情，后面是数字，数值表示在这个表情下的list的大小；TabLayout下面对应不同的Fragment，Fragment中显示当前的list，我这里生成的Item都是简单写一下，没有具体意义；整个设计思路是，自定义一个<code>ListBottomSheetDialog</code>，这个dialog由ViewPager + TabLayout + Fragment + RecyclerView组成，先从Fragment开始实现步骤</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/Zhoutao822/hugo-pic/pictures/design3.png alt=design3></p><ul><li><code>ListObjectFragment</code>布局文件<code>fragment_list.xml</code>与Item布局文件<code>item_list.xml</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!-- fragment_list.xml --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!-- 首先暂时使用CoordinatorLayout，可能后续会修改为NestedScrollView，此处伏笔 --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!-- 而且background=&#34;@color/white&#34;是由于后面Dialog为透明背景，这里需要白色背景避免Fragment切换时背景突变透明 --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;androidx.coordinatorlayout.widget.CoordinatorLayout</span> <span style=color:#a6e22e>xmlns:android=</span><span style=color:#e6db74>&#34;http://schemas.android.com/apk/res/android&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>xmlns:app=</span><span style=color:#e6db74>&#34;http://schemas.android.com/apk/res-auto&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:background=</span><span style=color:#e6db74>&#34;@color/white&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:orientation=</span><span style=color:#e6db74>&#34;vertical&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;androidx.recyclerview.widget.RecyclerView</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/list_view&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>app:layout_behavior=</span><span style=color:#e6db74>&#34;com.google.android.material.bottomsheet.BottomSheetBehavior&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/androidx.coordinatorlayout.widget.CoordinatorLayout&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!-- item_list.xml --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!-- 注意这里也使用了上面文中出现的水波纹效果背景touch_bg，这是因为要实现圆角背景 --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;LinearLayout</span> <span style=color:#a6e22e>xmlns:android=</span><span style=color:#e6db74>&#34;http://schemas.android.com/apk/res/android&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:background=</span><span style=color:#e6db74>&#34;@drawable/touch_bg&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:orientation=</span><span style=color:#e6db74>&#34;horizontal&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:padding=</span><span style=color:#e6db74>&#34;10dp&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;ImageView</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/avatar&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;40dp&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;40dp&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:background=</span><span style=color:#e6db74>&#34;@color/holo_blue_light&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;TextView</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/name&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;0dp&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_gravity=</span><span style=color:#e6db74>&#34;center&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_marginStart=</span><span style=color:#e6db74>&#34;10dp&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_weight=</span><span style=color:#e6db74>&#34;1&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:padding=</span><span style=color:#e6db74>&#34;5dp&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:text=</span><span style=color:#e6db74>&#34;name&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:textColor=</span><span style=color:#e6db74>&#34;@color/black&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:textSize=</span><span style=color:#e6db74>&#34;20sp&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/LinearLayout&gt;</span>
</span></span></code></pre></div><ul><li>然后是RecyclerView的Adapter <code>ListViewAdapter.java</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ListViewAdapter</span> <span style=color:#66d9ef>extends</span> RecyclerView<span style=color:#f92672>.</span><span style=color:#a6e22e>Adapter</span><span style=color:#f92672>&lt;</span>ListViewAdapter<span style=color:#f92672>.</span><span style=color:#a6e22e>MyViewHolder</span><span style=color:#f92672>&gt;{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 这里加了点击事件的接口
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> ItemClickListener onItemClickListener<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 显示的Item就是一个一个的User信息，User信息也很简单，avatar和name，但是avatar没有赋值
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> data<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>ListViewAdapter</span><span style=color:#f92672>(</span>List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> data<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> data<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NonNull</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> MyViewHolder <span style=color:#a6e22e>onCreateViewHolder</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> ViewGroup parent<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> viewType<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 常见方式
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        View view <span style=color:#f92672>=</span> LayoutInflater<span style=color:#f92672>.</span><span style=color:#a6e22e>from</span><span style=color:#f92672>(</span>parent<span style=color:#f92672>.</span><span style=color:#a6e22e>getContext</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>inflate</span><span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>layout</span><span style=color:#f92672>.</span><span style=color:#a6e22e>item_list</span><span style=color:#f92672>,</span> parent<span style=color:#f92672>,</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        MyViewHolder holder <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MyViewHolder<span style=color:#f92672>(</span>view<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> holder<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onBindViewHolder</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> MyViewHolder holder<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> position<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        User user <span style=color:#f92672>=</span> data<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>position<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 这里avatar写死了，没有赋值，偷个懒
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        holder<span style=color:#f92672>.</span><span style=color:#a6e22e>avatar</span><span style=color:#f92672>.</span><span style=color:#a6e22e>setImageResource</span><span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>drawable</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ic_launcher_foreground</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        holder<span style=color:#f92672>.</span><span style=color:#a6e22e>name</span><span style=color:#f92672>.</span><span style=color:#a6e22e>setText</span><span style=color:#f92672>(</span>user<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 把点击事件传出去
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        holder<span style=color:#f92672>.</span><span style=color:#a6e22e>itemView</span><span style=color:#f92672>.</span><span style=color:#a6e22e>setOnClickListener</span><span style=color:#f92672>(</span>v <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>onItemClickListener <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                onItemClickListener<span style=color:#f92672>.</span><span style=color:#a6e22e>onItemClick</span><span style=color:#f92672>(</span>holder<span style=color:#f92672>.</span><span style=color:#a6e22e>itemView</span><span style=color:#f92672>,</span> position<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getItemCount</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> data<span style=color:#f92672>.</span><span style=color:#a6e22e>size</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyViewHolder</span> <span style=color:#66d9ef>extends</span> RecyclerView<span style=color:#f92672>.</span><span style=color:#a6e22e>ViewHolder</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        ImageView avatar<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        TextView name<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>MyViewHolder</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> View itemView<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>super</span><span style=color:#f92672>(</span>itemView<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            avatar <span style=color:#f92672>=</span> itemView<span style=color:#f92672>.</span><span style=color:#a6e22e>findViewById</span><span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>avatar</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            name <span style=color:#f92672>=</span> itemView<span style=color:#f92672>.</span><span style=color:#a6e22e>findViewById</span><span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>name</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>ItemClickListener</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onItemClick</span><span style=color:#f92672>(</span>View view<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> position<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setItemClickListener</span><span style=color:#f92672>(</span>ItemClickListener clickListener<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        onItemClickListener <span style=color:#f92672>=</span> clickListener<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>User</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String avatar<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String name<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>User</span><span style=color:#f92672>(</span>String avatar<span style=color:#f92672>,</span> String name<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>avatar</span> <span style=color:#f92672>=</span> avatar<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> name<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>getAvatar</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> avatar<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setAvatar</span><span style=color:#f92672>(</span>String avatar<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>avatar</span> <span style=color:#f92672>=</span> avatar<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>getName</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> name<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setName</span><span style=color:#f92672>(</span>String name<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> name<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><ul><li>Fragment <code>ListObjectFragment.java</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ListObjectFragment</span> <span style=color:#66d9ef>extends</span> Fragment <span style=color:#66d9ef>implements</span> ListViewAdapter<span style=color:#f92672>.</span><span style=color:#a6e22e>ItemClickListener</span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// emoji表示Unicode表情，count表示list大小
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> count<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String emoji<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> list<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> ListViewAdapter listViewAdapter<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> RecyclerView recyclerView<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 加了几个参数用于仅在Fragment对用户可见时加载数据，针对ViewPager预加载
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>boolean</span> isViewInitiated<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>boolean</span> isVisibleToUser<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>boolean</span> isDataInitiated<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 这里传入了list，但是在onResume时才是真实加载数据的时候
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>ListObjectFragment</span><span style=color:#f92672>(</span>String emoji<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> count<span style=color:#f92672>,</span> List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> list<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>emoji</span> <span style=color:#f92672>=</span> emoji<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>count</span> <span style=color:#f92672>=</span> count<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>list</span> <span style=color:#f92672>=</span> list<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> View <span style=color:#a6e22e>onCreateView</span><span style=color:#f92672>(</span>LayoutInflater inflater<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                             ViewGroup container<span style=color:#f92672>,</span> Bundle savedInstanceState<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> inflater<span style=color:#f92672>.</span><span style=color:#a6e22e>inflate</span><span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>layout</span><span style=color:#f92672>.</span><span style=color:#a6e22e>fragment_list_test</span><span style=color:#f92672>,</span> container<span style=color:#f92672>,</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onResume</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>onResume</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        isVisibleToUser <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        prepareFetchData<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        listViewAdapter <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ListViewAdapter<span style=color:#f92672>(</span>list<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        listViewAdapter<span style=color:#f92672>.</span><span style=color:#a6e22e>setItemClickListener</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        recyclerView<span style=color:#f92672>.</span><span style=color:#a6e22e>setLayoutManager</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> LinearLayoutManager<span style=color:#f92672>(</span>getContext<span style=color:#f92672>()));</span>
</span></span><span style=display:flex><span>        recyclerView<span style=color:#f92672>.</span><span style=color:#a6e22e>setAdapter</span><span style=color:#f92672>(</span>listViewAdapter<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onStop</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>onStop</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        isVisibleToUser <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>fetchData</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 真实加载list的地方，这里仅模拟
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        list <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span> i <span style=color:#f92672>&lt;</span> count<span style=color:#f92672>;</span> i<span style=color:#f92672>++)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            list<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> User<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;name&#34;</span> <span style=color:#f92672>+</span> i<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>prepareFetchData</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> prepareFetchData<span style=color:#f92672>(</span><span style=color:#66d9ef>false</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>prepareFetchData</span><span style=color:#f92672>(</span><span style=color:#66d9ef>boolean</span> forceUpdate<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>isVisibleToUser <span style=color:#f92672>&amp;&amp;</span> isViewInitiated <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>(!</span>isDataInitiated <span style=color:#f92672>||</span> forceUpdate<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            fetchData<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            isDataInitiated <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onViewCreated</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> View view<span style=color:#f92672>,</span> <span style=color:#a6e22e>@Nullable</span> Bundle savedInstanceState<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        isViewInitiated <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        recyclerView <span style=color:#f92672>=</span> view<span style=color:#f92672>.</span><span style=color:#a6e22e>findViewById</span><span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>list_view</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onItemClick</span><span style=color:#f92672>(</span>View view<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> position<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 点击事件回调
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        Toast<span style=color:#f92672>.</span><span style=color:#a6e22e>makeText</span><span style=color:#f92672>(</span>getContext<span style=color:#f92672>(),</span> <span style=color:#e6db74>&#34;position&#34;</span> <span style=color:#f92672>+</span> position<span style=color:#f92672>,</span> Toast<span style=color:#f92672>.</span><span style=color:#a6e22e>LENGTH_SHORT</span><span style=color:#f92672>).</span><span style=color:#a6e22e>show</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><ul><li>自定义BottomSheetDialog的布局文件<code>dialog_list.xml</code>，圆角背景<code>radius_background.xml</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;LinearLayout</span> <span style=color:#a6e22e>xmlns:android=</span><span style=color:#e6db74>&#34;http://schemas.android.com/apk/res/android&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>xmlns:app=</span><span style=color:#e6db74>&#34;http://schemas.android.com/apk/res-auto&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:orientation=</span><span style=color:#e6db74>&#34;vertical&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;com.google.android.material.tabs.TabLayout</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/tablayout&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:background=</span><span style=color:#e6db74>&#34;@drawable/radius_background&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>app:tabIndicatorColor=</span><span style=color:#e6db74>&#34;@color/colorPrimaryDark&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>app:tabMode=</span><span style=color:#e6db74>&#34;scrollable&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>app:tabTextColor=</span><span style=color:#e6db74>&#34;@color/black&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;View</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;1dp&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:background=</span><span style=color:#e6db74>&#34;@color/split_line_grey&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;com.tao.bottomsheetdemo.custom.CustomViewPager</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/viewpager&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;match_parent&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/LinearLayout&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!-- radius_background.xml --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;shape</span> <span style=color:#a6e22e>xmlns:android=</span><span style=color:#e6db74>&#34;http://schemas.android.com/apk/res/android&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;solid</span> <span style=color:#a6e22e>android:color=</span><span style=color:#e6db74>&#34;@color/white&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;corners</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:topLeftRadius=</span><span style=color:#e6db74>&#34;10dp&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:topRightRadius=</span><span style=color:#e6db74>&#34;10dp&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/shape&gt;</span>
</span></span></code></pre></div><ul><li>自定义ViewPager <code>CustomViewPager.java</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CustomViewPager</span> <span style=color:#66d9ef>extends</span> ViewPager <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// CustomViewPager control scroll enable
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>boolean</span> enabled<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>CustomViewPager</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> Context context<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>(</span>context<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>enabled</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>CustomViewPager</span><span style=color:#f92672>(</span>Context context<span style=color:#f92672>,</span> AttributeSet attrs<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>(</span>context<span style=color:#f92672>,</span> attrs<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>enabled</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>onTouchEvent</span><span style=color:#f92672>(</span>MotionEvent event<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>enabled</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>onTouchEvent</span><span style=color:#f92672>(</span>event<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>onInterceptTouchEvent</span><span style=color:#f92672>(</span>MotionEvent event<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 事件传递控制是否支持左右滑动
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>enabled</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>onInterceptTouchEvent</span><span style=color:#f92672>(</span>event<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setPagingEnabled</span><span style=color:#f92672>(</span><span style=color:#66d9ef>boolean</span> enabled<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>enabled</span> <span style=color:#f92672>=</span> enabled<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><ul><li>自定义BottomSheetDialog <code>ListBottomSheetDialog.java</code>与ViewPager的Adapter <code>ListPagerAdapter.java</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ListBottomSheetDialog</span> <span style=color:#66d9ef>extends</span> BottomSheetDialogFragment <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> String TAG <span style=color:#f92672>=</span> ListBottomSheetDialog<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getSimpleName</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 这里的ViewPager为自定义的CustomViewPager，多了额外的功能：可以控制是否支持左右滑动切换Fragment
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> TabLayout tabLayout<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> CustomViewPager viewPager<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// offscreenPageLimit设置可以使ViewPager下的Fragment缓存数据，数值表示缓存数据的Fragment数量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> offscreenPageLimit <span style=color:#f92672>=</span> 10<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 通过参数控制是否支持左右滑动
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> Boolean enableScroll<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// EmojiItem是包含emoji/count/list的实体类，所以可知传入Dialog的数据是一种嵌套list形式
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> List<span style=color:#f92672>&lt;</span>EmojiItem<span style=color:#f92672>&gt;</span> emojiItemList<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Context context<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ViewPager的Adapter
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> ListPagerAdapter adapter<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> ListBottomSheetDialog <span style=color:#a6e22e>newInstance</span><span style=color:#f92672>(</span>ListBottomSheetDialog<span style=color:#f92672>.</span><span style=color:#a6e22e>Builder</span> builder<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        ListBottomSheetDialog fragment <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ListBottomSheetDialog<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//        Bundle bundle = new Bundle();
</span></span></span><span style=display:flex><span><span style=color:#75715e>//        fragment.setArguments(bundle);
</span></span></span><span style=display:flex><span><span style=color:#75715e>//        fragment.setHeight(builder.peekHeight, builder.maxHeight);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        fragment<span style=color:#f92672>.</span><span style=color:#a6e22e>setEmojiItemList</span><span style=color:#f92672>(</span>builder<span style=color:#f92672>.</span><span style=color:#a6e22e>emojiItemList</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        fragment<span style=color:#f92672>.</span><span style=color:#a6e22e>setContext</span><span style=color:#f92672>(</span>builder<span style=color:#f92672>.</span><span style=color:#a6e22e>context</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        fragment<span style=color:#f92672>.</span><span style=color:#a6e22e>setOffscreenPageLimit</span><span style=color:#f92672>(</span>builder<span style=color:#f92672>.</span><span style=color:#a6e22e>offscreenPageLimit</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        fragment<span style=color:#f92672>.</span><span style=color:#a6e22e>setEnableScroll</span><span style=color:#f92672>(</span>builder<span style=color:#f92672>.</span><span style=color:#a6e22e>enableScroll</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> fragment<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NonNull</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Dialog <span style=color:#a6e22e>onCreateDialog</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@Nullable</span> Bundle savedInstanceState<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//      由于需要首先圆角背景，所以这里也使用了透明背景  
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        BottomSheetDialog dialog <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> BottomSheetDialog<span style=color:#f92672>(</span>context<span style=color:#f92672>,</span> R<span style=color:#f92672>.</span><span style=color:#a6e22e>style</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SheetDialog</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//        set dialog peek height and max height
</span></span></span><span style=display:flex><span><span style=color:#75715e>//        dialog.setPeekHeight(peekHeight);
</span></span></span><span style=display:flex><span><span style=color:#75715e>//        dialog.setMaxHeight(maxHeight);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>return</span> dialog<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Nullable</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> View <span style=color:#a6e22e>onCreateView</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> LayoutInflater inflater<span style=color:#f92672>,</span> <span style=color:#a6e22e>@Nullable</span> ViewGroup container<span style=color:#f92672>,</span> <span style=color:#a6e22e>@Nullable</span> Bundle savedInstanceState<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> inflater<span style=color:#f92672>.</span><span style=color:#a6e22e>inflate</span><span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>layout</span><span style=color:#f92672>.</span><span style=color:#a6e22e>dialog_list</span><span style=color:#f92672>,</span> container<span style=color:#f92672>,</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onViewCreated</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> View view<span style=color:#f92672>,</span> <span style=color:#a6e22e>@Nullable</span> Bundle savedInstanceState<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>onViewCreated</span><span style=color:#f92672>(</span>view<span style=color:#f92672>,</span> savedInstanceState<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        viewPager <span style=color:#f92672>=</span> view<span style=color:#f92672>.</span><span style=color:#a6e22e>findViewById</span><span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>viewpager</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        tabLayout <span style=color:#f92672>=</span> view<span style=color:#f92672>.</span><span style=color:#a6e22e>findViewById</span><span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>tablayout</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>viewPager <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span> tabLayout <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            initViewPager<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>initViewPager</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// ListPagerAdapter.BEHAVIOR_RESUME_ONLY_CURRENT_FRAGMENT参数控制仅在Fragment对用户可见时调用onResume，这也是对应了上面在
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// Fragment中数据加载
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        adapter <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ListPagerAdapter<span style=color:#f92672>(</span>getChildFragmentManager<span style=color:#f92672>(),</span> ListPagerAdapter<span style=color:#f92672>.</span><span style=color:#a6e22e>BEHAVIOR_RESUME_ONLY_CURRENT_FRAGMENT</span><span style=color:#f92672>,</span> context<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 这里的emojiItemList比较简单，没有其他参数，理论上需要根据定义的其他参数传入到Fragment中再进行进一步请求数据
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        adapter<span style=color:#f92672>.</span><span style=color:#a6e22e>setEmojiItemList</span><span style=color:#f92672>(</span>emojiItemList<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        viewPager<span style=color:#f92672>.</span><span style=color:#a6e22e>setAdapter</span><span style=color:#f92672>(</span>adapter<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        viewPager<span style=color:#f92672>.</span><span style=color:#a6e22e>setOffscreenPageLimit</span><span style=color:#f92672>(</span>offscreenPageLimit<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 这里可以控制是否左右滑动
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        viewPager<span style=color:#f92672>.</span><span style=color:#a6e22e>setPagingEnabled</span><span style=color:#f92672>(</span>enableScroll<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// TabLayout与ViewPager关联，自动实现滑动切换或者点击切换的效果
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        tabLayout<span style=color:#f92672>.</span><span style=color:#a6e22e>setupWithViewPager</span><span style=color:#f92672>(</span>viewPager<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>show</span><span style=color:#f92672>(</span>FragmentManager fragmentManager<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        FragmentTransaction transaction <span style=color:#f92672>=</span> fragmentManager<span style=color:#f92672>.</span><span style=color:#a6e22e>beginTransaction</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        Fragment prevFragment <span style=color:#f92672>=</span> fragmentManager<span style=color:#f92672>.</span><span style=color:#a6e22e>findFragmentByTag</span><span style=color:#f92672>(</span>TAG<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>prevFragment <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            transaction<span style=color:#f92672>.</span><span style=color:#a6e22e>remove</span><span style=color:#f92672>(</span>prevFragment<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        transaction<span style=color:#f92672>.</span><span style=color:#a6e22e>addToBackStack</span><span style=color:#f92672>(</span><span style=color:#66d9ef>null</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        show<span style=color:#f92672>(</span>transaction<span style=color:#f92672>,</span> TAG<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 建造者模式，同上
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> Builder <span style=color:#a6e22e>builder</span><span style=color:#f92672>(</span>Context context<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Builder<span style=color:#f92672>(</span>context<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Builder</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// private int peekHeight;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// private int maxHeight;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> offscreenPageLimit<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> Boolean enableScroll<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> List<span style=color:#f92672>&lt;</span>EmojiItem<span style=color:#f92672>&gt;</span> emojiItemList<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> Context context<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>Builder</span><span style=color:#f92672>(</span>Context context<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>context</span> <span style=color:#f92672>=</span> context<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 这里注释掉的方法可以控制Dialog Expand状态下的高度以及Collapse状态的高度，但是需要自定义BottomSheetDialog
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// 暂时不写
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// public Builder setPeekHeight(int peekHeight) {
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>//     this.peekHeight = peekHeight;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>//     return this;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// }
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// public Builder setMaxHeight(int maxHeight) {
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>//     this.maxHeight = maxHeight;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>//     return this;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// }
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> Builder <span style=color:#a6e22e>setOffscreenPageLimit</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> offscreenPageLimit<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>offscreenPageLimit</span> <span style=color:#f92672>=</span> offscreenPageLimit<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> Builder <span style=color:#a6e22e>setEnableScroll</span><span style=color:#f92672>(</span>Boolean enableScroll<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>enableScroll</span> <span style=color:#f92672>=</span> enableScroll<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> Builder <span style=color:#a6e22e>setEmojiItemList</span><span style=color:#f92672>(</span>List<span style=color:#f92672>&lt;</span>EmojiItem<span style=color:#f92672>&gt;</span> emojiItemList<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>emojiItemList</span> <span style=color:#f92672>=</span> emojiItemList<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> ListBottomSheetDialog <span style=color:#a6e22e>build</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> newInstance<span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> ListBottomSheetDialog <span style=color:#a6e22e>show</span><span style=color:#f92672>(</span>FragmentManager fragmentManager<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            ListBottomSheetDialog dialog <span style=color:#f92672>=</span> build<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            dialog<span style=color:#f92672>.</span><span style=color:#a6e22e>show</span><span style=color:#f92672>(</span>fragmentManager<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> dialog<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setContext</span><span style=color:#f92672>(</span>Context context<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>context</span> <span style=color:#f92672>=</span> context<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// private void setHeight(int peekHeight, int maxHeight) {
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//     this.peekHeight = peekHeight;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//     this.maxHeight = maxHeight;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// }
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setOffscreenPageLimit</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> offscreenPageLimit<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>offscreenPageLimit</span> <span style=color:#f92672>=</span> offscreenPageLimit<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setEnableScroll</span><span style=color:#f92672>(</span>Boolean enableScroll<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>enableScroll</span> <span style=color:#f92672>=</span> enableScroll<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setEmojiItemList</span><span style=color:#f92672>(</span>List<span style=color:#f92672>&lt;</span>EmojiItem<span style=color:#f92672>&gt;</span> emojiItemList<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>emojiItemList</span> <span style=color:#f92672>=</span> emojiItemList<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ListPagerAdapter</span> <span style=color:#66d9ef>extends</span> FragmentStatePagerAdapter <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> List<span style=color:#f92672>&lt;</span>EmojiItem<span style=color:#f92672>&gt;</span> emojiItemList<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> List<span style=color:#f92672>&lt;</span>EmojiItem<span style=color:#f92672>&gt;</span> sortedList<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Context context<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>ListPagerAdapter</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> FragmentManager fm<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> behavior<span style=color:#f92672>,</span> Context context<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>(</span>fm<span style=color:#f92672>,</span> behavior<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>context</span> <span style=color:#f92672>=</span> context<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>ListPagerAdapter</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> FragmentManager fm<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> behavior<span style=color:#f92672>,</span> List<span style=color:#f92672>&lt;</span>EmojiItem<span style=color:#f92672>&gt;</span> emojiItemList<span style=color:#f92672>,</span> Context context<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>(</span>fm<span style=color:#f92672>,</span> behavior<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>emojiItemList</span> <span style=color:#f92672>=</span> emojiItemList<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>context</span> <span style=color:#f92672>=</span> context<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 这里还需要将传入的emojiItemList按照count进行降序排列
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>sortedList</span> <span style=color:#f92672>=</span> sortList<span style=color:#f92672>(</span>emojiItemList<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Fragment <span style=color:#a6e22e>getItem</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> position<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        String label <span style=color:#f92672>=</span> sortedList<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>position<span style=color:#f92672>).</span><span style=color:#a6e22e>getEmoji</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> count <span style=color:#f92672>=</span> sortedList<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>position<span style=color:#f92672>).</span><span style=color:#a6e22e>getCount</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> list <span style=color:#f92672>=</span> sortedList<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>position<span style=color:#f92672>).</span><span style=color:#a6e22e>getUserList</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        Fragment fragment <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ListObjectFragment<span style=color:#f92672>(</span>label<span style=color:#f92672>,</span> count<span style=color:#f92672>,</span> list<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        Bundle args <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Bundle<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> fragment<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getCount</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> emojiItemList<span style=color:#f92672>.</span><span style=color:#a6e22e>size</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> CharSequence <span style=color:#a6e22e>getPageTitle</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> position<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 这里设置TabLayout的title，emoji+count
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        CharSequence emoji <span style=color:#f92672>=</span> sortedList<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>position<span style=color:#f92672>).</span><span style=color:#a6e22e>getEmoji</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        CharSequence title <span style=color:#f92672>=</span> emoji <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; &#34;</span> <span style=color:#f92672>+</span> sortedList<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>position<span style=color:#f92672>).</span><span style=color:#a6e22e>getCount</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        SpannableStringBuilder spBuilder <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> SpannableStringBuilder<span style=color:#f92672>(</span>title<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        Pattern pattern <span style=color:#f92672>=</span> Pattern<span style=color:#f92672>.</span><span style=color:#a6e22e>compile</span><span style=color:#f92672>(</span>emoji<span style=color:#f92672>.</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        Matcher matcher <span style=color:#f92672>=</span> pattern<span style=color:#f92672>.</span><span style=color:#a6e22e>matcher</span><span style=color:#f92672>(</span>title<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> <span style=color:#f92672>(</span>matcher<span style=color:#f92672>.</span><span style=color:#a6e22e>find</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            TextAppearanceSpan span <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> TextAppearanceSpan<span style=color:#f92672>(</span>context<span style=color:#f92672>,</span> R<span style=color:#f92672>.</span><span style=color:#a6e22e>style</span><span style=color:#f92672>.</span><span style=color:#a6e22e>UIKitTextView_ReactionLabel</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            spBuilder<span style=color:#f92672>.</span><span style=color:#a6e22e>setSpan</span><span style=color:#f92672>(</span>span<span style=color:#f92672>,</span> matcher<span style=color:#f92672>.</span><span style=color:#a6e22e>start</span><span style=color:#f92672>(),</span> matcher<span style=color:#f92672>.</span><span style=color:#a6e22e>end</span><span style=color:#f92672>(),</span> Spannable<span style=color:#f92672>.</span><span style=color:#a6e22e>SPAN_EXCLUSIVE_EXCLUSIVE</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> spBuilder<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> List<span style=color:#f92672>&lt;</span>EmojiItem<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>sortList</span><span style=color:#f92672>(</span>List<span style=color:#f92672>&lt;</span>EmojiItem<span style=color:#f92672>&gt;</span> list<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>EmojiItem<span style=color:#f92672>&gt;</span> tmp <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;(</span>list<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        Collections<span style=color:#f92672>.</span><span style=color:#a6e22e>sort</span><span style=color:#f92672>(</span>tmp<span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> Comparator<span style=color:#f92672>&lt;</span>EmojiItem<span style=color:#f92672>&gt;()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>compare</span><span style=color:#f92672>(</span>EmojiItem o1<span style=color:#f92672>,</span> EmojiItem o2<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> o2<span style=color:#f92672>.</span><span style=color:#a6e22e>getCount</span><span style=color:#f92672>()</span> <span style=color:#f92672>-</span> o1<span style=color:#f92672>.</span><span style=color:#a6e22e>getCount</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> tmp<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setEmojiItemList</span><span style=color:#f92672>(</span>List<span style=color:#f92672>&lt;</span>EmojiItem<span style=color:#f92672>&gt;</span> emojiItemList<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>emojiItemList</span> <span style=color:#f92672>=</span> emojiItemList<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>sortedList</span> <span style=color:#f92672>=</span> sortList<span style=color:#f92672>(</span>emojiItemList<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><ul><li>EmojiItem实体类</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>EmojiItem</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String emoji<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> count<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> userList<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>EmojiItem</span><span style=color:#f92672>(</span>String emoji<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> count<span style=color:#f92672>,</span> List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> userList<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>emoji</span> <span style=color:#f92672>=</span> emoji<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>count</span> <span style=color:#f92672>=</span> count<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>userList</span> <span style=color:#f92672>=</span> userList<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>getEmoji</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> emoji<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setEmoji</span><span style=color:#f92672>(</span>String emoji<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>emoji</span> <span style=color:#f92672>=</span> emoji<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getCount</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> count<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setCount</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> count<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>count</span> <span style=color:#f92672>=</span> count<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getUserList</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> userList<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setUserList</span><span style=color:#f92672>(</span>List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> userList<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>userList</span> <span style=color:#f92672>=</span> userList<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><ul><li>调用 <code>FourthActivity.java</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FourthActivity</span> <span style=color:#66d9ef>extends</span> AppCompatActivity <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onCreate</span><span style=color:#f92672>(</span>Bundle savedInstanceState<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>onCreate</span><span style=color:#f92672>(</span>savedInstanceState<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        setContentView<span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>layout</span><span style=color:#f92672>.</span><span style=color:#a6e22e>activity_fourth</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>EmojiItem<span style=color:#f92672>&gt;</span> data <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>        String<span style=color:#f92672>[]</span> arr <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> String<span style=color:#f92672>[]{</span>
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;\uD83D\uDC4D&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;❤️&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;\uD83C\uDF89&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;\uD83D\uDE02&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;\uD83D\uDC4F&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;\uD83D\uDE0E&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>};</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span> i <span style=color:#f92672>&lt;</span> arr<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span><span style=color:#f92672>;</span> i<span style=color:#f92672>++)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            data<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> EmojiItem<span style=color:#f92672>(</span>arr<span style=color:#f92672>[</span>i<span style=color:#f92672>],</span> i <span style=color:#f92672>+</span> 10<span style=color:#f92672>,</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        findViewById<span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>button4</span><span style=color:#f92672>).</span><span style=color:#a6e22e>setOnClickListener</span><span style=color:#f92672>(</span>v <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>                ListBottomSheetDialog<span style=color:#f92672>.</span><span style=color:#a6e22e>builder</span><span style=color:#f92672>(</span>FourthActivity<span style=color:#f92672>.</span><span style=color:#a6e22e>this</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>setEmojiItemList</span><span style=color:#f92672>(</span>data<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>setOffscreenPageLimit</span><span style=color:#f92672>(</span>5<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>setEnableScroll</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>show</span><span style=color:#f92672>(</span>getSupportFragmentManager<span style=color:#f92672>()));</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p><strong>运行结果</strong></p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/Zhoutao822/hugo-pic/pictures/design4.gif alt=design4></p><p>很明显有几个问题：</p><ol><li>list上面有一段空白；</li><li>除了第一个Fragment中的list可以上下滑动以外，其他Fragment中的list不可滑动，这也就是BottomSheetDialog的bug。</li></ol><h2 id=4-解决方法>4. 解决方法<a hidden class=anchor aria-hidden=true href=#4-解决方法>#</a></h2><ul><li><p>针对第一个Bug，这是由于Fragment的布局文件中采用了CoordinatorLayout，我们替换为NestedScrollView，对应伏笔。</p></li><li><p>第二个bug就比较复杂，根据找到的资料显示大致有两种解决方法（并不一定能成功）</p></li></ul><h3 id=41-重写viewpager的adapter的setprimaryitem方法>4.1 重写ViewPager的Adapter的setPrimaryItem方法<a hidden class=anchor aria-hidden=true href=#41-重写viewpager的adapter的setprimaryitem方法>#</a></h3><p>也就是在<code>ListPagerAdapter.java</code>中加入</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setPrimaryItem</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> ViewGroup container<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> position<span style=color:#f92672>,</span> <span style=color:#a6e22e>@NonNull</span> Object object<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>setPrimaryItem</span><span style=color:#f92672>(</span>container<span style=color:#f92672>,</span> position<span style=color:#f92672>,</span> object<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        Fragment currentFragment <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>Fragment<span style=color:#f92672>)</span> object<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>currentFragment<span style=color:#f92672>.</span><span style=color:#a6e22e>getView</span><span style=color:#f92672>()</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span> i <span style=color:#f92672>&lt;</span> container<span style=color:#f92672>.</span><span style=color:#a6e22e>getChildCount</span><span style=color:#f92672>();</span> i<span style=color:#f92672>++)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>i <span style=color:#f92672>!=</span> position<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#75715e>// 注意这里用NestedScrollView是因为已经默认上面第一个bug被纠正
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    NestedScrollView otherScrollView <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>NestedScrollView<span style=color:#f92672>)</span> container<span style=color:#f92672>.</span><span style=color:#a6e22e>getChildAt</span><span style=color:#f92672>(</span>i<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                    otherScrollView<span style=color:#f92672>.</span><span style=color:#a6e22e>setNestedScrollingEnabled</span><span style=color:#f92672>(</span><span style=color:#66d9ef>false</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            NestedScrollView currentNestedScrollView <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>NestedScrollView<span style=color:#f92672>)</span> currentFragment<span style=color:#f92672>.</span><span style=color:#a6e22e>getView</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            currentNestedScrollView<span style=color:#f92672>.</span><span style=color:#a6e22e>setNestedScrollingEnabled</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            container<span style=color:#f92672>.</span><span style=color:#a6e22e>requestLayout</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><p>这段代码的作用是让对用户可见的Fragment中的NestedScrollView设置为可以滑动，其他不可见为禁止滑动，但是很遗憾，并没有解决问题，不可滑动问题依然存在。</p><h3 id=42-重写bottomsheetbehavior的findscrollingchild方法>4.2 重写BottomSheetBehavior的findScrollingChild方法<a hidden class=anchor aria-hidden=true href=#42-重写bottomsheetbehavior的findscrollingchild方法>#</a></h3><p>我们可以对比以下原始的findScrollingChild方法</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>  View <span style=color:#a6e22e>findScrollingChild</span><span style=color:#f92672>(</span>View view<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>ViewCompat<span style=color:#f92672>.</span><span style=color:#a6e22e>isNestedScrollingEnabled</span><span style=color:#f92672>(</span>view<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> view<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>view <span style=color:#66d9ef>instanceof</span> ViewGroup<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      ViewGroup group <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>ViewGroup<span style=color:#f92672>)</span> view<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0<span style=color:#f92672>,</span> count <span style=color:#f92672>=</span> group<span style=color:#f92672>.</span><span style=color:#a6e22e>getChildCount</span><span style=color:#f92672>();</span> i <span style=color:#f92672>&lt;</span> count<span style=color:#f92672>;</span> i<span style=color:#f92672>++)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        View scrollingChild <span style=color:#f92672>=</span> findScrollingChild<span style=color:#f92672>(</span>group<span style=color:#f92672>.</span><span style=color:#a6e22e>getChildAt</span><span style=color:#f92672>(</span>i<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>scrollingChild <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>return</span> scrollingChild<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span></code></pre></div><p>以及修改后的findScrollingChild方法</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>    <span style=color:#66d9ef>private</span> View <span style=color:#a6e22e>findScrollingChild</span><span style=color:#f92672>(</span>View view<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>ViewCompat<span style=color:#f92672>.</span><span style=color:#a6e22e>isNestedScrollingEnabled</span><span style=color:#f92672>(</span>view<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> view<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 修改后的代码增加了判断的选项，根据debug的结果我们知道如果最终返回的scrollingChild是可见状态的Fragment中的NestedScrollView，
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// 那么则可以正常滑动，否则不可滑动
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>view <span style=color:#66d9ef>instanceof</span> ViewPager<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            ViewPager viewPager <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>ViewPager<span style=color:#f92672>)</span> view<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// ViewPagerUtils通过反射获取position得到当前的Fragment中的NestedScrollView
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            View currentViewPagerChild <span style=color:#f92672>=</span> ViewPagerUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>getCurrentView</span><span style=color:#f92672>(</span>viewPager<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>currentViewPagerChild <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            View scrollingChild <span style=color:#f92672>=</span> findScrollingChild<span style=color:#f92672>(</span>currentViewPagerChild<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>scrollingChild <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> scrollingChild<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>view <span style=color:#66d9ef>instanceof</span> ViewGroup<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            ViewGroup group <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>ViewGroup<span style=color:#f92672>)</span> view<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0<span style=color:#f92672>,</span> count <span style=color:#f92672>=</span> group<span style=color:#f92672>.</span><span style=color:#a6e22e>getChildCount</span><span style=color:#f92672>();</span> i <span style=color:#f92672>&lt;</span> count<span style=color:#f92672>;</span> i<span style=color:#f92672>++)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                View scrollingChild <span style=color:#f92672>=</span> findScrollingChild<span style=color:#f92672>(</span>group<span style=color:#f92672>.</span><span style=color:#a6e22e>getChildAt</span><span style=color:#f92672>(</span>i<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>scrollingChild <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span> scrollingChild<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><p>为了重写findScrollingChild方法，有两种方式，一是在com.google.android.material.bottomsheet包下继承BottomSheetBehavior并重写findScrollingChild方法，一是创建新的BottomSheetBehavior类，复制其中的大部分代码以及相关文件。</p><ol><li>创建当前项目下的另一个包com.google.android.material.bottomsheet不是一个很好的选择，所以不采用；</li><li>新建ViewPagerBottomSheetBehavior类，复制代码，并修改findScrollingChild方法，这样会创建很多额外的文件。</li></ol><p>采用方法二，我们需要加入以下几个文件：</p><p><code>ViewPagerBottomSheetBehavior.java</code></p><p><code>ViewPagerUtils.java</code></p><p><code>BottomSheetUtils.java</code></p><p><code>design_view_pager_bottom_sheet_dialog.xml</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * An interaction behavior plugin for a child view of {@link CoordinatorLayout} to make it work as
</span></span></span><span style=display:flex><span><span style=color:#75715e> * a bottom sheet.
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ViewPagerBottomSheetBehavior</span><span style=color:#f92672>&lt;</span>V <span style=color:#66d9ef>extends</span> View<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>extends</span> CoordinatorLayout<span style=color:#f92672>.</span><span style=color:#a6e22e>Behavior</span><span style=color:#f92672>&lt;</span>V<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Callback for monitoring events about bottom sheets.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BottomSheetCallback</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>         * Called when the bottom sheet changes its state.
</span></span></span><span style=display:flex><span><span style=color:#75715e>         *
</span></span></span><span style=display:flex><span><span style=color:#75715e>         * @param bottomSheet The bottom sheet view.
</span></span></span><span style=display:flex><span><span style=color:#75715e>         * @param newState    The new state. This will be one of {@link #STATE_DRAGGING},
</span></span></span><span style=display:flex><span><span style=color:#75715e>         *                    {@link #STATE_SETTLING}, {@link #STATE_EXPANDED},
</span></span></span><span style=display:flex><span><span style=color:#75715e>         *                    {@link #STATE_COLLAPSED}, or {@link #STATE_HIDDEN}.
</span></span></span><span style=display:flex><span><span style=color:#75715e>         */</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onStateChanged</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> View bottomSheet<span style=color:#f92672>,</span> <span style=color:#a6e22e>@State</span> <span style=color:#66d9ef>int</span> newState<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>         * Called when the bottom sheet is being dragged.
</span></span></span><span style=display:flex><span><span style=color:#75715e>         *
</span></span></span><span style=display:flex><span><span style=color:#75715e>         * @param bottomSheet The bottom sheet view.
</span></span></span><span style=display:flex><span><span style=color:#75715e>         * @param slideOffset The new offset of this bottom sheet within [-1,1] range. Offset
</span></span></span><span style=display:flex><span><span style=color:#75715e>         *                    increases as this bottom sheet is moving upward. From 0 to 1 the sheet
</span></span></span><span style=display:flex><span><span style=color:#75715e>         *                    is between collapsed and expanded states and from -1 to 0 it is
</span></span></span><span style=display:flex><span><span style=color:#75715e>         *                    between hidden and collapsed states.
</span></span></span><span style=display:flex><span><span style=color:#75715e>         */</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onSlide</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> View bottomSheet<span style=color:#f92672>,</span> <span style=color:#66d9ef>float</span> slideOffset<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * The bottom sheet is dragging.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> STATE_DRAGGING <span style=color:#f92672>=</span> 1<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * The bottom sheet is settling.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> STATE_SETTLING <span style=color:#f92672>=</span> 2<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * The bottom sheet is expanded.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> STATE_EXPANDED <span style=color:#f92672>=</span> 3<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * The bottom sheet is collapsed.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> STATE_COLLAPSED <span style=color:#f92672>=</span> 4<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * The bottom sheet is hidden.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> STATE_HIDDEN <span style=color:#f92672>=</span> 5<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @hide
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@RestrictTo</span><span style=color:#f92672>(</span>LIBRARY_GROUP<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@IntDef</span><span style=color:#f92672>({</span>STATE_EXPANDED<span style=color:#f92672>,</span> STATE_COLLAPSED<span style=color:#f92672>,</span> STATE_DRAGGING<span style=color:#f92672>,</span> STATE_SETTLING<span style=color:#f92672>,</span> STATE_HIDDEN<span style=color:#f92672>})</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Retention</span><span style=color:#f92672>(</span>RetentionPolicy<span style=color:#f92672>.</span><span style=color:#a6e22e>SOURCE</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>@interface</span> State <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Peek at the 16:9 ratio keyline of its parent.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;p&gt;This can be used as a parameter for {@link #setPeekHeight(int)}.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * {@link #getPeekHeight()} will return this when the value is set.&lt;/p&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> PEEK_HEIGHT_AUTO <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>1<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>float</span> HIDE_THRESHOLD <span style=color:#f92672>=</span> 0<span style=color:#f92672>.</span><span style=color:#a6e22e>5f</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>float</span> HIDE_FRICTION <span style=color:#f92672>=</span> 0<span style=color:#f92672>.</span><span style=color:#a6e22e>1f</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>float</span> mMaximumVelocity<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> mPeekHeight<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>boolean</span> mPeekHeightAuto<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> mPeekHeightMin<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> mMinOffset<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> mMaxOffset<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>boolean</span> mHideable<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>boolean</span> mSkipCollapsed<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@State</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> mState <span style=color:#f92672>=</span> STATE_COLLAPSED<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    ViewDragHelper mViewDragHelper<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>boolean</span> mIgnoreEvents<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> mLastNestedScrollDy<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>boolean</span> mNestedScrolled<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> mParentHeight<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    WeakReference<span style=color:#f92672>&lt;</span>V<span style=color:#f92672>&gt;</span> mViewRef<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    WeakReference<span style=color:#f92672>&lt;</span>View<span style=color:#f92672>&gt;</span> mNestedScrollingChildRef<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> BottomSheetCallback mCallback<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> VelocityTracker mVelocityTracker<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> mActivePointerId<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> mInitialY<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>boolean</span> mTouchingScrollingChild<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Default constructor for instantiating ViewPagerBottomSheetBehaviors.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>ViewPagerBottomSheetBehavior</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Default constructor for inflating ViewPagerBottomSheetBehaviors from layout.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param context The {@link Context}.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param attrs   The {@link AttributeSet}.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>ViewPagerBottomSheetBehavior</span><span style=color:#f92672>(</span>Context context<span style=color:#f92672>,</span> AttributeSet attrs<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>(</span>context<span style=color:#f92672>,</span> attrs<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        TypedArray a <span style=color:#f92672>=</span> context<span style=color:#f92672>.</span><span style=color:#a6e22e>obtainStyledAttributes</span><span style=color:#f92672>(</span>attrs<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                R<span style=color:#f92672>.</span><span style=color:#a6e22e>styleable</span><span style=color:#f92672>.</span><span style=color:#a6e22e>BottomSheetBehavior_Layout</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        TypedValue value <span style=color:#f92672>=</span> a<span style=color:#f92672>.</span><span style=color:#a6e22e>peekValue</span><span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>styleable</span><span style=color:#f92672>.</span><span style=color:#a6e22e>BottomSheetBehavior_Layout_behavior_peekHeight</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>value <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span> value<span style=color:#f92672>.</span><span style=color:#a6e22e>data</span> <span style=color:#f92672>==</span> PEEK_HEIGHT_AUTO<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            setPeekHeight<span style=color:#f92672>(</span>value<span style=color:#f92672>.</span><span style=color:#a6e22e>data</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            setPeekHeight<span style=color:#f92672>(</span>a<span style=color:#f92672>.</span><span style=color:#a6e22e>getDimensionPixelSize</span><span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>                    R<span style=color:#f92672>.</span><span style=color:#a6e22e>styleable</span><span style=color:#f92672>.</span><span style=color:#a6e22e>BottomSheetBehavior_Layout_behavior_peekHeight</span><span style=color:#f92672>,</span> PEEK_HEIGHT_AUTO<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        setHideable<span style=color:#f92672>(</span>a<span style=color:#f92672>.</span><span style=color:#a6e22e>getBoolean</span><span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>styleable</span><span style=color:#f92672>.</span><span style=color:#a6e22e>BottomSheetBehavior_Layout_behavior_hideable</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>        setSkipCollapsed<span style=color:#f92672>(</span>a<span style=color:#f92672>.</span><span style=color:#a6e22e>getBoolean</span><span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>styleable</span><span style=color:#f92672>.</span><span style=color:#a6e22e>BottomSheetBehavior_Layout_behavior_skipCollapsed</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>false</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>        a<span style=color:#f92672>.</span><span style=color:#a6e22e>recycle</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        ViewConfiguration configuration <span style=color:#f92672>=</span> ViewConfiguration<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>context<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        mMaximumVelocity <span style=color:#f92672>=</span> configuration<span style=color:#f92672>.</span><span style=color:#a6e22e>getScaledMaximumFlingVelocity</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Parcelable <span style=color:#a6e22e>onSaveInstanceState</span><span style=color:#f92672>(</span>CoordinatorLayout parent<span style=color:#f92672>,</span> V child<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> SavedState<span style=color:#f92672>(</span><span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>onSaveInstanceState</span><span style=color:#f92672>(</span>parent<span style=color:#f92672>,</span> child<span style=color:#f92672>),</span> mState<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onRestoreInstanceState</span><span style=color:#f92672>(</span>CoordinatorLayout parent<span style=color:#f92672>,</span> V child<span style=color:#f92672>,</span> Parcelable state<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        SavedState ss <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>SavedState<span style=color:#f92672>)</span> state<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>onRestoreInstanceState</span><span style=color:#f92672>(</span>parent<span style=color:#f92672>,</span> child<span style=color:#f92672>,</span> ss<span style=color:#f92672>.</span><span style=color:#a6e22e>getSuperState</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Intermediate states are restored as collapsed state
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>ss<span style=color:#f92672>.</span><span style=color:#a6e22e>state</span> <span style=color:#f92672>==</span> STATE_DRAGGING <span style=color:#f92672>||</span> ss<span style=color:#f92672>.</span><span style=color:#a6e22e>state</span> <span style=color:#f92672>==</span> STATE_SETTLING<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            mState <span style=color:#f92672>=</span> STATE_COLLAPSED<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            mState <span style=color:#f92672>=</span> ss<span style=color:#f92672>.</span><span style=color:#a6e22e>state</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>onLayoutChild</span><span style=color:#f92672>(</span>CoordinatorLayout parent<span style=color:#f92672>,</span> V child<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> layoutDirection<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>ViewCompat<span style=color:#f92672>.</span><span style=color:#a6e22e>getFitsSystemWindows</span><span style=color:#f92672>(</span>parent<span style=color:#f92672>)</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span>ViewCompat<span style=color:#f92672>.</span><span style=color:#a6e22e>getFitsSystemWindows</span><span style=color:#f92672>(</span>child<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            ViewCompat<span style=color:#f92672>.</span><span style=color:#a6e22e>setFitsSystemWindows</span><span style=color:#f92672>(</span>child<span style=color:#f92672>,</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> savedTop <span style=color:#f92672>=</span> child<span style=color:#f92672>.</span><span style=color:#a6e22e>getTop</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// First let the parent lay it out
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        parent<span style=color:#f92672>.</span><span style=color:#a6e22e>onLayoutChild</span><span style=color:#f92672>(</span>child<span style=color:#f92672>,</span> layoutDirection<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Offset the bottom sheet
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        mParentHeight <span style=color:#f92672>=</span> parent<span style=color:#f92672>.</span><span style=color:#a6e22e>getHeight</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> peekHeight<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mPeekHeightAuto<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mPeekHeightMin <span style=color:#f92672>==</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                mPeekHeightMin <span style=color:#f92672>=</span> parent<span style=color:#f92672>.</span><span style=color:#a6e22e>getResources</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getDimensionPixelSize</span><span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>                        R<span style=color:#f92672>.</span><span style=color:#a6e22e>dimen</span><span style=color:#f92672>.</span><span style=color:#a6e22e>design_bottom_sheet_peek_height_min</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            peekHeight <span style=color:#f92672>=</span> Math<span style=color:#f92672>.</span><span style=color:#a6e22e>max</span><span style=color:#f92672>(</span>mPeekHeightMin<span style=color:#f92672>,</span> mParentHeight <span style=color:#f92672>-</span> parent<span style=color:#f92672>.</span><span style=color:#a6e22e>getWidth</span><span style=color:#f92672>()</span> <span style=color:#f92672>*</span> 9 <span style=color:#f92672>/</span> 16<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            peekHeight <span style=color:#f92672>=</span> mPeekHeight<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        mMinOffset <span style=color:#f92672>=</span> Math<span style=color:#f92672>.</span><span style=color:#a6e22e>max</span><span style=color:#f92672>(</span>0<span style=color:#f92672>,</span> mParentHeight <span style=color:#f92672>-</span> child<span style=color:#f92672>.</span><span style=color:#a6e22e>getHeight</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        mMaxOffset <span style=color:#f92672>=</span> Math<span style=color:#f92672>.</span><span style=color:#a6e22e>max</span><span style=color:#f92672>(</span>mParentHeight <span style=color:#f92672>-</span> peekHeight<span style=color:#f92672>,</span> mMinOffset<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mState <span style=color:#f92672>==</span> STATE_EXPANDED<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            ViewCompat<span style=color:#f92672>.</span><span style=color:#a6e22e>offsetTopAndBottom</span><span style=color:#f92672>(</span>child<span style=color:#f92672>,</span> mMinOffset<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mHideable <span style=color:#f92672>&amp;&amp;</span> mState <span style=color:#f92672>==</span> STATE_HIDDEN<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            ViewCompat<span style=color:#f92672>.</span><span style=color:#a6e22e>offsetTopAndBottom</span><span style=color:#f92672>(</span>child<span style=color:#f92672>,</span> mParentHeight<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mState <span style=color:#f92672>==</span> STATE_COLLAPSED<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            ViewCompat<span style=color:#f92672>.</span><span style=color:#a6e22e>offsetTopAndBottom</span><span style=color:#f92672>(</span>child<span style=color:#f92672>,</span> mMaxOffset<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mState <span style=color:#f92672>==</span> STATE_DRAGGING <span style=color:#f92672>||</span> mState <span style=color:#f92672>==</span> STATE_SETTLING<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            ViewCompat<span style=color:#f92672>.</span><span style=color:#a6e22e>offsetTopAndBottom</span><span style=color:#f92672>(</span>child<span style=color:#f92672>,</span> savedTop <span style=color:#f92672>-</span> child<span style=color:#f92672>.</span><span style=color:#a6e22e>getTop</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mViewDragHelper <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            mViewDragHelper <span style=color:#f92672>=</span> ViewDragHelper<span style=color:#f92672>.</span><span style=color:#a6e22e>create</span><span style=color:#f92672>(</span>parent<span style=color:#f92672>,</span> mDragCallback<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        mViewRef <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> WeakReference<span style=color:#f92672>&lt;&gt;(</span>child<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        mNestedScrollingChildRef <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> WeakReference<span style=color:#f92672>&lt;&gt;(</span>findScrollingChild<span style=color:#f92672>(</span>child<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>onInterceptTouchEvent</span><span style=color:#f92672>(</span>CoordinatorLayout parent<span style=color:#f92672>,</span> V child<span style=color:#f92672>,</span> MotionEvent event<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(!</span>child<span style=color:#f92672>.</span><span style=color:#a6e22e>isShown</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            mIgnoreEvents <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> action <span style=color:#f92672>=</span> event<span style=color:#f92672>.</span><span style=color:#a6e22e>getActionMasked</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Record the velocity
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>action <span style=color:#f92672>==</span> MotionEvent<span style=color:#f92672>.</span><span style=color:#a6e22e>ACTION_DOWN</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            reset<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mVelocityTracker <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            mVelocityTracker <span style=color:#f92672>=</span> VelocityTracker<span style=color:#f92672>.</span><span style=color:#a6e22e>obtain</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        mVelocityTracker<span style=color:#f92672>.</span><span style=color:#a6e22e>addMovement</span><span style=color:#f92672>(</span>event<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>switch</span> <span style=color:#f92672>(</span>action<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> MotionEvent<span style=color:#f92672>.</span><span style=color:#a6e22e>ACTION_UP</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> MotionEvent<span style=color:#f92672>.</span><span style=color:#a6e22e>ACTION_CANCEL</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                mTouchingScrollingChild <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                mActivePointerId <span style=color:#f92672>=</span> MotionEvent<span style=color:#f92672>.</span><span style=color:#a6e22e>INVALID_POINTER_ID</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>// Reset the ignore flag
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mIgnoreEvents<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    mIgnoreEvents <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> MotionEvent<span style=color:#f92672>.</span><span style=color:#a6e22e>ACTION_DOWN</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>int</span> initialX <span style=color:#f92672>=</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span><span style=color:#f92672>)</span> event<span style=color:#f92672>.</span><span style=color:#a6e22e>getX</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                mInitialY <span style=color:#f92672>=</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span><span style=color:#f92672>)</span> event<span style=color:#f92672>.</span><span style=color:#a6e22e>getY</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                View scroll <span style=color:#f92672>=</span> mNestedScrollingChildRef <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>                        <span style=color:#f92672>?</span> mNestedScrollingChildRef<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>()</span> <span style=color:#f92672>:</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>scroll <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span> parent<span style=color:#f92672>.</span><span style=color:#a6e22e>isPointInChildBounds</span><span style=color:#f92672>(</span>scroll<span style=color:#f92672>,</span> initialX<span style=color:#f92672>,</span> mInitialY<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    mActivePointerId <span style=color:#f92672>=</span> event<span style=color:#f92672>.</span><span style=color:#a6e22e>getPointerId</span><span style=color:#f92672>(</span>event<span style=color:#f92672>.</span><span style=color:#a6e22e>getActionIndex</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>                    mTouchingScrollingChild <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                mIgnoreEvents <span style=color:#f92672>=</span> mActivePointerId <span style=color:#f92672>==</span> MotionEvent<span style=color:#f92672>.</span><span style=color:#a6e22e>INVALID_POINTER_ID</span> <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>                        <span style=color:#f92672>!</span>parent<span style=color:#f92672>.</span><span style=color:#a6e22e>isPointInChildBounds</span><span style=color:#f92672>(</span>child<span style=color:#f92672>,</span> initialX<span style=color:#f92672>,</span> mInitialY<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(!</span>mIgnoreEvents <span style=color:#f92672>&amp;&amp;</span> mViewDragHelper<span style=color:#f92672>.</span><span style=color:#a6e22e>shouldInterceptTouchEvent</span><span style=color:#f92672>(</span>event<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// We have to handle cases that the ViewDragHelper does not capture the bottom sheet because
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// it is not the top most view of its parent. This is not necessary when the touch event is
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// happening over the scrolling content as nested scrolling logic handles that case.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        View scroll <span style=color:#f92672>=</span> mNestedScrollingChildRef<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> action <span style=color:#f92672>==</span> MotionEvent<span style=color:#f92672>.</span><span style=color:#a6e22e>ACTION_MOVE</span> <span style=color:#f92672>&amp;&amp;</span> scroll <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>!</span>mIgnoreEvents <span style=color:#f92672>&amp;&amp;</span> mState <span style=color:#f92672>!=</span> STATE_DRAGGING <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>!</span>parent<span style=color:#f92672>.</span><span style=color:#a6e22e>isPointInChildBounds</span><span style=color:#f92672>(</span>scroll<span style=color:#f92672>,</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span><span style=color:#f92672>)</span> event<span style=color:#f92672>.</span><span style=color:#a6e22e>getX</span><span style=color:#f92672>(),</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span><span style=color:#f92672>)</span> event<span style=color:#f92672>.</span><span style=color:#a6e22e>getY</span><span style=color:#f92672>())</span> <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>                Math<span style=color:#f92672>.</span><span style=color:#a6e22e>abs</span><span style=color:#f92672>(</span>mInitialY <span style=color:#f92672>-</span> event<span style=color:#f92672>.</span><span style=color:#a6e22e>getY</span><span style=color:#f92672>())</span> <span style=color:#f92672>&gt;</span> mViewDragHelper<span style=color:#f92672>.</span><span style=color:#a6e22e>getTouchSlop</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>onTouchEvent</span><span style=color:#f92672>(</span>CoordinatorLayout parent<span style=color:#f92672>,</span> V child<span style=color:#f92672>,</span> MotionEvent event<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(!</span>child<span style=color:#f92672>.</span><span style=color:#a6e22e>isShown</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> action <span style=color:#f92672>=</span> event<span style=color:#f92672>.</span><span style=color:#a6e22e>getActionMasked</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mState <span style=color:#f92672>==</span> STATE_DRAGGING <span style=color:#f92672>&amp;&amp;</span> action <span style=color:#f92672>==</span> MotionEvent<span style=color:#f92672>.</span><span style=color:#a6e22e>ACTION_DOWN</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mViewDragHelper <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            mViewDragHelper<span style=color:#f92672>.</span><span style=color:#a6e22e>processTouchEvent</span><span style=color:#f92672>(</span>event<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Record the velocity
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>action <span style=color:#f92672>==</span> MotionEvent<span style=color:#f92672>.</span><span style=color:#a6e22e>ACTION_DOWN</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            reset<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mVelocityTracker <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            mVelocityTracker <span style=color:#f92672>=</span> VelocityTracker<span style=color:#f92672>.</span><span style=color:#a6e22e>obtain</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        mVelocityTracker<span style=color:#f92672>.</span><span style=color:#a6e22e>addMovement</span><span style=color:#f92672>(</span>event<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// The ViewDragHelper tries to capture only the top-most View. We have to explicitly tell it
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// to capture the bottom sheet in case it is not captured and the touch slop is passed.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>action <span style=color:#f92672>==</span> MotionEvent<span style=color:#f92672>.</span><span style=color:#a6e22e>ACTION_MOVE</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span>mIgnoreEvents<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>Math<span style=color:#f92672>.</span><span style=color:#a6e22e>abs</span><span style=color:#f92672>(</span>mInitialY <span style=color:#f92672>-</span> event<span style=color:#f92672>.</span><span style=color:#a6e22e>getY</span><span style=color:#f92672>())</span> <span style=color:#f92672>&gt;</span> mViewDragHelper<span style=color:#f92672>.</span><span style=color:#a6e22e>getTouchSlop</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                mViewDragHelper<span style=color:#f92672>.</span><span style=color:#a6e22e>captureChildView</span><span style=color:#f92672>(</span>child<span style=color:#f92672>,</span> event<span style=color:#f92672>.</span><span style=color:#a6e22e>getPointerId</span><span style=color:#f92672>(</span>event<span style=color:#f92672>.</span><span style=color:#a6e22e>getActionIndex</span><span style=color:#f92672>()));</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#f92672>!</span>mIgnoreEvents<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>onStartNestedScroll</span><span style=color:#f92672>(</span>CoordinatorLayout coordinatorLayout<span style=color:#f92672>,</span> V child<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                                       View directTargetChild<span style=color:#f92672>,</span> View target<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> nestedScrollAxes<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        mLastNestedScrollDy <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        mNestedScrolled <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#f92672>(</span>nestedScrollAxes <span style=color:#f92672>&amp;</span> ViewCompat<span style=color:#f92672>.</span><span style=color:#a6e22e>SCROLL_AXIS_VERTICAL</span><span style=color:#f92672>)</span> <span style=color:#f92672>!=</span> 0<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onNestedPreScroll</span><span style=color:#f92672>(</span>CoordinatorLayout coordinatorLayout<span style=color:#f92672>,</span> V child<span style=color:#f92672>,</span> View target<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> dx<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                                  <span style=color:#66d9ef>int</span> dy<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>[]</span> consumed<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        View scrollingChild <span style=color:#f92672>=</span> mNestedScrollingChildRef<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>target <span style=color:#f92672>!=</span> scrollingChild<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> currentTop <span style=color:#f92672>=</span> child<span style=color:#f92672>.</span><span style=color:#a6e22e>getTop</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> newTop <span style=color:#f92672>=</span> currentTop <span style=color:#f92672>-</span> dy<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>dy <span style=color:#f92672>&gt;</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span> <span style=color:#75715e>// Upward
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>newTop <span style=color:#f92672>&lt;</span> mMinOffset<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                consumed<span style=color:#f92672>[</span>1<span style=color:#f92672>]</span> <span style=color:#f92672>=</span> currentTop <span style=color:#f92672>-</span> mMinOffset<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                ViewCompat<span style=color:#f92672>.</span><span style=color:#a6e22e>offsetTopAndBottom</span><span style=color:#f92672>(</span>child<span style=color:#f92672>,</span> <span style=color:#f92672>-</span>consumed<span style=color:#f92672>[</span>1<span style=color:#f92672>]);</span>
</span></span><span style=display:flex><span>                setStateInternal<span style=color:#f92672>(</span>STATE_EXPANDED<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                consumed<span style=color:#f92672>[</span>1<span style=color:#f92672>]</span> <span style=color:#f92672>=</span> dy<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                ViewCompat<span style=color:#f92672>.</span><span style=color:#a6e22e>offsetTopAndBottom</span><span style=color:#f92672>(</span>child<span style=color:#f92672>,</span> <span style=color:#f92672>-</span>dy<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                setStateInternal<span style=color:#f92672>(</span>STATE_DRAGGING<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>dy <span style=color:#f92672>&lt;</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span> <span style=color:#75715e>// Downward
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(!</span>target<span style=color:#f92672>.</span><span style=color:#a6e22e>canScrollVertically</span><span style=color:#f92672>(-</span>1<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>newTop <span style=color:#f92672>&lt;=</span> mMaxOffset <span style=color:#f92672>||</span> mHideable<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    consumed<span style=color:#f92672>[</span>1<span style=color:#f92672>]</span> <span style=color:#f92672>=</span> dy<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                    ViewCompat<span style=color:#f92672>.</span><span style=color:#a6e22e>offsetTopAndBottom</span><span style=color:#f92672>(</span>child<span style=color:#f92672>,</span> <span style=color:#f92672>-</span>dy<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                    setStateInternal<span style=color:#f92672>(</span>STATE_DRAGGING<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    consumed<span style=color:#f92672>[</span>1<span style=color:#f92672>]</span> <span style=color:#f92672>=</span> currentTop <span style=color:#f92672>-</span> mMaxOffset<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                    ViewCompat<span style=color:#f92672>.</span><span style=color:#a6e22e>offsetTopAndBottom</span><span style=color:#f92672>(</span>child<span style=color:#f92672>,</span> <span style=color:#f92672>-</span>consumed<span style=color:#f92672>[</span>1<span style=color:#f92672>]);</span>
</span></span><span style=display:flex><span>                    setStateInternal<span style=color:#f92672>(</span>STATE_COLLAPSED<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        dispatchOnSlide<span style=color:#f92672>(</span>child<span style=color:#f92672>.</span><span style=color:#a6e22e>getTop</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        mLastNestedScrollDy <span style=color:#f92672>=</span> dy<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        mNestedScrolled <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onStopNestedScroll</span><span style=color:#f92672>(</span>CoordinatorLayout coordinatorLayout<span style=color:#f92672>,</span> V child<span style=color:#f92672>,</span> View target<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>child<span style=color:#f92672>.</span><span style=color:#a6e22e>getTop</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> mMinOffset<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            setStateInternal<span style=color:#f92672>(</span>STATE_EXPANDED<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mNestedScrollingChildRef <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>||</span> target <span style=color:#f92672>!=</span> mNestedScrollingChildRef<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>||</span> <span style=color:#f92672>!</span>mNestedScrolled<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> top<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> targetState<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mLastNestedScrollDy <span style=color:#f92672>&gt;</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            top <span style=color:#f92672>=</span> mMinOffset<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            targetState <span style=color:#f92672>=</span> STATE_EXPANDED<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mHideable <span style=color:#f92672>&amp;&amp;</span> shouldHide<span style=color:#f92672>(</span>child<span style=color:#f92672>,</span> getYVelocity<span style=color:#f92672>()))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            top <span style=color:#f92672>=</span> mParentHeight<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            targetState <span style=color:#f92672>=</span> STATE_HIDDEN<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mLastNestedScrollDy <span style=color:#f92672>==</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>int</span> currentTop <span style=color:#f92672>=</span> child<span style=color:#f92672>.</span><span style=color:#a6e22e>getTop</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>Math<span style=color:#f92672>.</span><span style=color:#a6e22e>abs</span><span style=color:#f92672>(</span>currentTop <span style=color:#f92672>-</span> mMinOffset<span style=color:#f92672>)</span> <span style=color:#f92672>&lt;</span> Math<span style=color:#f92672>.</span><span style=color:#a6e22e>abs</span><span style=color:#f92672>(</span>currentTop <span style=color:#f92672>-</span> mMaxOffset<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                top <span style=color:#f92672>=</span> mMinOffset<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                targetState <span style=color:#f92672>=</span> STATE_EXPANDED<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                top <span style=color:#f92672>=</span> mMaxOffset<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                targetState <span style=color:#f92672>=</span> STATE_COLLAPSED<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            top <span style=color:#f92672>=</span> mMaxOffset<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            targetState <span style=color:#f92672>=</span> STATE_COLLAPSED<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mViewDragHelper<span style=color:#f92672>.</span><span style=color:#a6e22e>smoothSlideViewTo</span><span style=color:#f92672>(</span>child<span style=color:#f92672>,</span> child<span style=color:#f92672>.</span><span style=color:#a6e22e>getLeft</span><span style=color:#f92672>(),</span> top<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            setStateInternal<span style=color:#f92672>(</span>STATE_SETTLING<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            ViewCompat<span style=color:#f92672>.</span><span style=color:#a6e22e>postOnAnimation</span><span style=color:#f92672>(</span>child<span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> SettleRunnable<span style=color:#f92672>(</span>child<span style=color:#f92672>,</span> targetState<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            setStateInternal<span style=color:#f92672>(</span>targetState<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        mNestedScrolled <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>onNestedPreFling</span><span style=color:#f92672>(</span>CoordinatorLayout coordinatorLayout<span style=color:#f92672>,</span> V child<span style=color:#f92672>,</span> View target<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                                    <span style=color:#66d9ef>float</span> velocityX<span style=color:#f92672>,</span> <span style=color:#66d9ef>float</span> velocityY<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> target <span style=color:#f92672>==</span> mNestedScrollingChildRef<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>()</span> <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>(</span>mState <span style=color:#f92672>!=</span> STATE_EXPANDED <span style=color:#f92672>||</span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>onNestedPreFling</span><span style=color:#f92672>(</span>coordinatorLayout<span style=color:#f92672>,</span> child<span style=color:#f92672>,</span> target<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                                velocityX<span style=color:#f92672>,</span> velocityY<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>invalidateScrollingChild</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>final</span> View scrollingChild <span style=color:#f92672>=</span> findScrollingChild<span style=color:#f92672>(</span>mViewRef<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        mNestedScrollingChildRef <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> WeakReference<span style=color:#f92672>&lt;&gt;(</span>scrollingChild<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Sets the height of the bottom sheet when it is collapsed.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param peekHeight The height of the collapsed bottom sheet in pixels, or
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *                   {@link #PEEK_HEIGHT_AUTO} to configure the sheet to peek automatically
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *                   at 16:9 ratio keyline.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @attr ref android.support.design.R.styleable#BottomSheetBehavior_Layout_behavior_peekHeight
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setPeekHeight</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> peekHeight<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>boolean</span> layout <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>peekHeight <span style=color:#f92672>==</span> PEEK_HEIGHT_AUTO<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(!</span>mPeekHeightAuto<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                mPeekHeightAuto <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                layout <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mPeekHeightAuto <span style=color:#f92672>||</span> mPeekHeight <span style=color:#f92672>!=</span> peekHeight<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            mPeekHeightAuto <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            mPeekHeight <span style=color:#f92672>=</span> Math<span style=color:#f92672>.</span><span style=color:#a6e22e>max</span><span style=color:#f92672>(</span>0<span style=color:#f92672>,</span> peekHeight<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            mMaxOffset <span style=color:#f92672>=</span> mParentHeight <span style=color:#f92672>-</span> peekHeight<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            layout <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>layout <span style=color:#f92672>&amp;&amp;</span> mState <span style=color:#f92672>==</span> STATE_COLLAPSED <span style=color:#f92672>&amp;&amp;</span> mViewRef <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            V view <span style=color:#f92672>=</span> mViewRef<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>view <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                view<span style=color:#f92672>.</span><span style=color:#a6e22e>requestLayout</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Gets the height of the bottom sheet when it is collapsed.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return The height of the collapsed bottom sheet in pixels, or {@link #PEEK_HEIGHT_AUTO}
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * if the sheet is configured to peek automatically at 16:9 ratio keyline
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @attr ref android.support.design.R.styleable#BottomSheetBehavior_Layout_behavior_peekHeight
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getPeekHeight</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> mPeekHeightAuto <span style=color:#f92672>?</span> PEEK_HEIGHT_AUTO <span style=color:#f92672>:</span> mPeekHeight<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Sets whether this bottom sheet can hide when it is swiped down.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param hideable {@code true} to make this bottom sheet hideable.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @attr ref android.support.design.R.styleable#BottomSheetBehavior_Layout_behavior_hideable
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setHideable</span><span style=color:#f92672>(</span><span style=color:#66d9ef>boolean</span> hideable<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        mHideable <span style=color:#f92672>=</span> hideable<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Gets whether this bottom sheet can hide when it is swiped down.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return {@code true} if this bottom sheet can hide.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @attr ref android.support.design.R.styleable#BottomSheetBehavior_Layout_behavior_hideable
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>isHideable</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> mHideable<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Sets whether this bottom sheet should skip the collapsed state when it is being hidden
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * after it is expanded once. Setting this to true has no effect unless the sheet is hideable.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param skipCollapsed True if the bottom sheet should skip the collapsed state.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @attr ref android.support.design.R.styleable#BottomSheetBehavior_Layout_behavior_skipCollapsed
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setSkipCollapsed</span><span style=color:#f92672>(</span><span style=color:#66d9ef>boolean</span> skipCollapsed<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        mSkipCollapsed <span style=color:#f92672>=</span> skipCollapsed<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Sets whether this bottom sheet should skip the collapsed state when it is being hidden
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * after it is expanded once.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return Whether the bottom sheet should skip the collapsed state.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @attr ref android.support.design.R.styleable#BottomSheetBehavior_Layout_behavior_skipCollapsed
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>getSkipCollapsed</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> mSkipCollapsed<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Sets a callback to be notified of bottom sheet events.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param callback The callback to notify when bottom sheet events occur.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setBottomSheetCallback</span><span style=color:#f92672>(</span>BottomSheetCallback callback<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        mCallback <span style=color:#f92672>=</span> callback<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Sets the state of the bottom sheet. The bottom sheet will transition to that state with
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * animation.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param state One of {@link #STATE_COLLAPSED}, {@link #STATE_EXPANDED}, or
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *              {@link #STATE_HIDDEN}.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setState</span><span style=color:#f92672>(</span><span style=color:#66d9ef>final</span> <span style=color:#a6e22e>@State</span> <span style=color:#66d9ef>int</span> state<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>state <span style=color:#f92672>==</span> mState<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mViewRef <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// The view is not laid out yet; modify mState and let onLayoutChild handle it later
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>state <span style=color:#f92672>==</span> STATE_COLLAPSED <span style=color:#f92672>||</span> state <span style=color:#f92672>==</span> STATE_EXPANDED <span style=color:#f92672>||</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>(</span>mHideable <span style=color:#f92672>&amp;&amp;</span> state <span style=color:#f92672>==</span> STATE_HIDDEN<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                mState <span style=color:#f92672>=</span> state<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>final</span> V child <span style=color:#f92672>=</span> mViewRef<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>child <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Start the animation; wait until a pending layout if there is one.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        ViewParent parent <span style=color:#f92672>=</span> child<span style=color:#f92672>.</span><span style=color:#a6e22e>getParent</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>parent <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span> parent<span style=color:#f92672>.</span><span style=color:#a6e22e>isLayoutRequested</span><span style=color:#f92672>()</span> <span style=color:#f92672>&amp;&amp;</span> ViewCompat<span style=color:#f92672>.</span><span style=color:#a6e22e>isAttachedToWindow</span><span style=color:#f92672>(</span>child<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            child<span style=color:#f92672>.</span><span style=color:#a6e22e>post</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> Runnable<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>run</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    startSettlingAnimation<span style=color:#f92672>(</span>child<span style=color:#f92672>,</span> state<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            startSettlingAnimation<span style=color:#f92672>(</span>child<span style=color:#f92672>,</span> state<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Gets the current state of the bottom sheet.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return One of {@link #STATE_EXPANDED}, {@link #STATE_COLLAPSED}, {@link #STATE_DRAGGING},
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * {@link #STATE_SETTLING}, and {@link #STATE_HIDDEN}.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@State</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getState</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> mState<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setStateInternal</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@State</span> <span style=color:#66d9ef>int</span> state<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mState <span style=color:#f92672>==</span> state<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        mState <span style=color:#f92672>=</span> state<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        View bottomSheet <span style=color:#f92672>=</span> mViewRef<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>bottomSheet <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span> mCallback <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            mCallback<span style=color:#f92672>.</span><span style=color:#a6e22e>onStateChanged</span><span style=color:#f92672>(</span>bottomSheet<span style=color:#f92672>,</span> state<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>reset</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        mActivePointerId <span style=color:#f92672>=</span> ViewDragHelper<span style=color:#f92672>.</span><span style=color:#a6e22e>INVALID_POINTER</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mVelocityTracker <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            mVelocityTracker<span style=color:#f92672>.</span><span style=color:#a6e22e>recycle</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            mVelocityTracker <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>shouldHide</span><span style=color:#f92672>(</span>View child<span style=color:#f92672>,</span> <span style=color:#66d9ef>float</span> yvel<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mSkipCollapsed<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>child<span style=color:#f92672>.</span><span style=color:#a6e22e>getTop</span><span style=color:#f92672>()</span> <span style=color:#f92672>&lt;</span> mMaxOffset<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// It should not hide, but collapse.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>float</span> newTop <span style=color:#f92672>=</span> child<span style=color:#f92672>.</span><span style=color:#a6e22e>getTop</span><span style=color:#f92672>()</span> <span style=color:#f92672>+</span> yvel <span style=color:#f92672>*</span> HIDE_FRICTION<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Math<span style=color:#f92672>.</span><span style=color:#a6e22e>abs</span><span style=color:#f92672>(</span>newTop <span style=color:#f92672>-</span> mMaxOffset<span style=color:#f92672>)</span> <span style=color:#f92672>/</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>float</span><span style=color:#f92672>)</span> mPeekHeight <span style=color:#f92672>&gt;</span> HIDE_THRESHOLD<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@VisibleForTesting</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> View <span style=color:#a6e22e>findScrollingChild</span><span style=color:#f92672>(</span>View view<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>ViewCompat<span style=color:#f92672>.</span><span style=color:#a6e22e>isNestedScrollingEnabled</span><span style=color:#f92672>(</span>view<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> view<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>view <span style=color:#66d9ef>instanceof</span> ViewPager<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            ViewPager viewPager <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>ViewPager<span style=color:#f92672>)</span> view<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            View currentViewPagerChild <span style=color:#f92672>=</span> ViewPagerUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>getCurrentView</span><span style=color:#f92672>(</span>viewPager<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>currentViewPagerChild <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            View scrollingChild <span style=color:#f92672>=</span> findScrollingChild<span style=color:#f92672>(</span>currentViewPagerChild<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>scrollingChild <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> scrollingChild<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>view <span style=color:#66d9ef>instanceof</span> ViewGroup<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            ViewGroup group <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>ViewGroup<span style=color:#f92672>)</span> view<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0<span style=color:#f92672>,</span> count <span style=color:#f92672>=</span> group<span style=color:#f92672>.</span><span style=color:#a6e22e>getChildCount</span><span style=color:#f92672>();</span> i <span style=color:#f92672>&lt;</span> count<span style=color:#f92672>;</span> i<span style=color:#f92672>++)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                View scrollingChild <span style=color:#f92672>=</span> findScrollingChild<span style=color:#f92672>(</span>group<span style=color:#f92672>.</span><span style=color:#a6e22e>getChildAt</span><span style=color:#f92672>(</span>i<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>scrollingChild <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span> scrollingChild<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>float</span> <span style=color:#a6e22e>getYVelocity</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        mVelocityTracker<span style=color:#f92672>.</span><span style=color:#a6e22e>computeCurrentVelocity</span><span style=color:#f92672>(</span>1000<span style=color:#f92672>,</span> mMaximumVelocity<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> mVelocityTracker<span style=color:#f92672>.</span><span style=color:#a6e22e>getYVelocity</span><span style=color:#f92672>(</span>mActivePointerId<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>startSettlingAnimation</span><span style=color:#f92672>(</span>View child<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> state<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> top<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>state <span style=color:#f92672>==</span> STATE_COLLAPSED<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            top <span style=color:#f92672>=</span> mMaxOffset<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>state <span style=color:#f92672>==</span> STATE_EXPANDED<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            top <span style=color:#f92672>=</span> mMinOffset<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mHideable <span style=color:#f92672>&amp;&amp;</span> state <span style=color:#f92672>==</span> STATE_HIDDEN<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            top <span style=color:#f92672>=</span> mParentHeight<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IllegalArgumentException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Illegal state argument: &#34;</span> <span style=color:#f92672>+</span> state<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mViewDragHelper<span style=color:#f92672>.</span><span style=color:#a6e22e>smoothSlideViewTo</span><span style=color:#f92672>(</span>child<span style=color:#f92672>,</span> child<span style=color:#f92672>.</span><span style=color:#a6e22e>getLeft</span><span style=color:#f92672>(),</span> top<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            setStateInternal<span style=color:#f92672>(</span>STATE_SETTLING<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            ViewCompat<span style=color:#f92672>.</span><span style=color:#a6e22e>postOnAnimation</span><span style=color:#f92672>(</span>child<span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> SettleRunnable<span style=color:#f92672>(</span>child<span style=color:#f92672>,</span> state<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            setStateInternal<span style=color:#f92672>(</span>state<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> ViewDragHelper<span style=color:#f92672>.</span><span style=color:#a6e22e>Callback</span> mDragCallback <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ViewDragHelper<span style=color:#f92672>.</span><span style=color:#a6e22e>Callback</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>tryCaptureView</span><span style=color:#f92672>(</span>View child<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> pointerId<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mState <span style=color:#f92672>==</span> STATE_DRAGGING<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mTouchingScrollingChild<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mState <span style=color:#f92672>==</span> STATE_EXPANDED <span style=color:#f92672>&amp;&amp;</span> mActivePointerId <span style=color:#f92672>==</span> pointerId<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                View scroll <span style=color:#f92672>=</span> mNestedScrollingChildRef<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>scroll <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span> scroll<span style=color:#f92672>.</span><span style=color:#a6e22e>canScrollVertically</span><span style=color:#f92672>(-</span>1<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#75715e>// Let the content scroll up
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> mViewRef <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span> mViewRef<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> child<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onViewPositionChanged</span><span style=color:#f92672>(</span>View changedView<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> left<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> top<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> dx<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> dy<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            dispatchOnSlide<span style=color:#f92672>(</span>top<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onViewDragStateChanged</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> state<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>state <span style=color:#f92672>==</span> ViewDragHelper<span style=color:#f92672>.</span><span style=color:#a6e22e>STATE_DRAGGING</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                setStateInternal<span style=color:#f92672>(</span>STATE_DRAGGING<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onViewReleased</span><span style=color:#f92672>(</span>View releasedChild<span style=color:#f92672>,</span> <span style=color:#66d9ef>float</span> xvel<span style=color:#f92672>,</span> <span style=color:#66d9ef>float</span> yvel<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>int</span> top<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>@State</span> <span style=color:#66d9ef>int</span> targetState<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>yvel <span style=color:#f92672>&lt;</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span> <span style=color:#75715e>// Moving up
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                top <span style=color:#f92672>=</span> mMinOffset<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                targetState <span style=color:#f92672>=</span> STATE_EXPANDED<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mHideable <span style=color:#f92672>&amp;&amp;</span> shouldHide<span style=color:#f92672>(</span>releasedChild<span style=color:#f92672>,</span> yvel<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                top <span style=color:#f92672>=</span> mParentHeight<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                targetState <span style=color:#f92672>=</span> STATE_HIDDEN<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>yvel <span style=color:#f92672>==</span> 0<span style=color:#f92672>.</span><span style=color:#a6e22e>f</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>int</span> currentTop <span style=color:#f92672>=</span> releasedChild<span style=color:#f92672>.</span><span style=color:#a6e22e>getTop</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>Math<span style=color:#f92672>.</span><span style=color:#a6e22e>abs</span><span style=color:#f92672>(</span>currentTop <span style=color:#f92672>-</span> mMinOffset<span style=color:#f92672>)</span> <span style=color:#f92672>&lt;</span> Math<span style=color:#f92672>.</span><span style=color:#a6e22e>abs</span><span style=color:#f92672>(</span>currentTop <span style=color:#f92672>-</span> mMaxOffset<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    top <span style=color:#f92672>=</span> mMinOffset<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                    targetState <span style=color:#f92672>=</span> STATE_EXPANDED<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    top <span style=color:#f92672>=</span> mMaxOffset<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                    targetState <span style=color:#f92672>=</span> STATE_COLLAPSED<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                top <span style=color:#f92672>=</span> mMaxOffset<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                targetState <span style=color:#f92672>=</span> STATE_COLLAPSED<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mViewDragHelper<span style=color:#f92672>.</span><span style=color:#a6e22e>settleCapturedViewAt</span><span style=color:#f92672>(</span>releasedChild<span style=color:#f92672>.</span><span style=color:#a6e22e>getLeft</span><span style=color:#f92672>(),</span> top<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                setStateInternal<span style=color:#f92672>(</span>STATE_SETTLING<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                ViewCompat<span style=color:#f92672>.</span><span style=color:#a6e22e>postOnAnimation</span><span style=color:#f92672>(</span>releasedChild<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>new</span> SettleRunnable<span style=color:#f92672>(</span>releasedChild<span style=color:#f92672>,</span> targetState<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                setStateInternal<span style=color:#f92672>(</span>targetState<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>clampViewPositionVertical</span><span style=color:#f92672>(</span>View child<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> top<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> dy<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> MathUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>clamp</span><span style=color:#f92672>(</span>top<span style=color:#f92672>,</span> mMinOffset<span style=color:#f92672>,</span> mHideable <span style=color:#f92672>?</span> mParentHeight <span style=color:#f92672>:</span> mMaxOffset<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>clampViewPositionHorizontal</span><span style=color:#f92672>(</span>View child<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> left<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> dx<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> child<span style=color:#f92672>.</span><span style=color:#a6e22e>getLeft</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getViewVerticalDragRange</span><span style=color:#f92672>(</span>View child<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mHideable<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> mParentHeight <span style=color:#f92672>-</span> mMinOffset<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> mMaxOffset <span style=color:#f92672>-</span> mMinOffset<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>};</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>dispatchOnSlide</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> top<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        View bottomSheet <span style=color:#f92672>=</span> mViewRef<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>bottomSheet <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span> mCallback <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>top <span style=color:#f92672>&gt;</span> mMaxOffset<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                mCallback<span style=color:#f92672>.</span><span style=color:#a6e22e>onSlide</span><span style=color:#f92672>(</span>bottomSheet<span style=color:#f92672>,</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>float</span><span style=color:#f92672>)</span> <span style=color:#f92672>(</span>mMaxOffset <span style=color:#f92672>-</span> top<span style=color:#f92672>)</span> <span style=color:#f92672>/</span>
</span></span><span style=display:flex><span>                        <span style=color:#f92672>(</span>mParentHeight <span style=color:#f92672>-</span> mMaxOffset<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                mCallback<span style=color:#f92672>.</span><span style=color:#a6e22e>onSlide</span><span style=color:#f92672>(</span>bottomSheet<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                        <span style=color:#f92672>(</span><span style=color:#66d9ef>float</span><span style=color:#f92672>)</span> <span style=color:#f92672>(</span>mMaxOffset <span style=color:#f92672>-</span> top<span style=color:#f92672>)</span> <span style=color:#f92672>/</span> <span style=color:#f92672>((</span>mMaxOffset <span style=color:#f92672>-</span> mMinOffset<span style=color:#f92672>)));</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@VisibleForTesting</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getPeekHeightMin</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> mPeekHeightMin<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SettleRunnable</span> <span style=color:#66d9ef>implements</span> Runnable <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> View mView<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@State</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> mTargetState<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        SettleRunnable<span style=color:#f92672>(</span>View view<span style=color:#f92672>,</span> <span style=color:#a6e22e>@State</span> <span style=color:#66d9ef>int</span> targetState<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            mView <span style=color:#f92672>=</span> view<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            mTargetState <span style=color:#f92672>=</span> targetState<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>run</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mViewDragHelper <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span> mViewDragHelper<span style=color:#f92672>.</span><span style=color:#a6e22e>continueSettling</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                ViewCompat<span style=color:#f92672>.</span><span style=color:#a6e22e>postOnAnimation</span><span style=color:#f92672>(</span>mView<span style=color:#f92672>,</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                setStateInternal<span style=color:#f92672>(</span>mTargetState<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SavedState</span> <span style=color:#66d9ef>extends</span> AbsSavedState <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@State</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> state<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>SavedState</span><span style=color:#f92672>(</span>Parcel source<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span><span style=color:#f92672>(</span>source<span style=color:#f92672>,</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>SavedState</span><span style=color:#f92672>(</span>Parcel source<span style=color:#f92672>,</span> ClassLoader loader<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>super</span><span style=color:#f92672>(</span>source<span style=color:#f92672>,</span> loader<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//noinspection ResourceType
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            state <span style=color:#f92672>=</span> source<span style=color:#f92672>.</span><span style=color:#a6e22e>readInt</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>SavedState</span><span style=color:#f92672>(</span>Parcelable superState<span style=color:#f92672>,</span> <span style=color:#a6e22e>@State</span> <span style=color:#66d9ef>int</span> state<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>super</span><span style=color:#f92672>(</span>superState<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>state</span> <span style=color:#f92672>=</span> state<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>writeToParcel</span><span style=color:#f92672>(</span>Parcel out<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> flags<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>writeToParcel</span><span style=color:#f92672>(</span>out<span style=color:#f92672>,</span> flags<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            out<span style=color:#f92672>.</span><span style=color:#a6e22e>writeInt</span><span style=color:#f92672>(</span>state<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> Creator<span style=color:#f92672>&lt;</span>SavedState<span style=color:#f92672>&gt;</span> CREATOR <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ClassLoaderCreator<span style=color:#f92672>&lt;</span>SavedState<span style=color:#f92672>&gt;()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>public</span> SavedState <span style=color:#a6e22e>createFromParcel</span><span style=color:#f92672>(</span>Parcel in<span style=color:#f92672>,</span> ClassLoader loader<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> SavedState<span style=color:#f92672>(</span>in<span style=color:#f92672>,</span> loader<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>public</span> SavedState <span style=color:#a6e22e>createFromParcel</span><span style=color:#f92672>(</span>Parcel in<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> SavedState<span style=color:#f92672>(</span>in<span style=color:#f92672>,</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>public</span> SavedState<span style=color:#f92672>[]</span> <span style=color:#a6e22e>newArray</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> size<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> SavedState<span style=color:#f92672>[</span>size<span style=color:#f92672>];</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>};</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * A utility function to get the {@link ViewPagerBottomSheetBehavior} associated with the {@code view}.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param view The {@link View} with {@link ViewPagerBottomSheetBehavior}.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return The {@link ViewPagerBottomSheetBehavior} associated with the {@code view}.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@SuppressWarnings</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;unchecked&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#f92672>&lt;</span>V <span style=color:#66d9ef>extends</span> View<span style=color:#f92672>&gt;</span> ViewPagerBottomSheetBehavior<span style=color:#f92672>&lt;</span>V<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>from</span><span style=color:#f92672>(</span>V view<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        ViewGroup<span style=color:#f92672>.</span><span style=color:#a6e22e>LayoutParams</span> params <span style=color:#f92672>=</span> view<span style=color:#f92672>.</span><span style=color:#a6e22e>getLayoutParams</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(!(</span>params <span style=color:#66d9ef>instanceof</span> CoordinatorLayout<span style=color:#f92672>.</span><span style=color:#a6e22e>LayoutParams</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IllegalArgumentException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;The view is not a child of CoordinatorLayout&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        CoordinatorLayout<span style=color:#f92672>.</span><span style=color:#a6e22e>Behavior</span> behavior <span style=color:#f92672>=</span> <span style=color:#f92672>((</span>CoordinatorLayout<span style=color:#f92672>.</span><span style=color:#a6e22e>LayoutParams</span><span style=color:#f92672>)</span> params<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>getBehavior</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(!(</span>behavior <span style=color:#66d9ef>instanceof</span> ViewPagerBottomSheetBehavior<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IllegalArgumentException<span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;The view is not associated with ViewPagerBottomSheetBehavior&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#f92672>(</span>ViewPagerBottomSheetBehavior<span style=color:#f92672>&lt;</span>V<span style=color:#f92672>&gt;)</span> behavior<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ViewPagerUtils</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> View <span style=color:#a6e22e>getCurrentView</span><span style=color:#f92672>(</span>ViewPager viewPager<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> currentItem <span style=color:#f92672>=</span> viewPager<span style=color:#f92672>.</span><span style=color:#a6e22e>getCurrentItem</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span> i <span style=color:#f92672>&lt;</span> viewPager<span style=color:#f92672>.</span><span style=color:#a6e22e>getChildCount</span><span style=color:#f92672>();</span> i<span style=color:#f92672>++)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>final</span> View child <span style=color:#f92672>=</span> viewPager<span style=color:#f92672>.</span><span style=color:#a6e22e>getChildAt</span><span style=color:#f92672>(</span>i<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>final</span> ViewPager<span style=color:#f92672>.</span><span style=color:#a6e22e>LayoutParams</span> layoutParams <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>ViewPager<span style=color:#f92672>.</span><span style=color:#a6e22e>LayoutParams</span><span style=color:#f92672>)</span> child<span style=color:#f92672>.</span><span style=color:#a6e22e>getLayoutParams</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                Field field <span style=color:#f92672>=</span> layoutParams<span style=color:#f92672>.</span><span style=color:#a6e22e>getClass</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getDeclaredField</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;position&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                field<span style=color:#f92672>.</span><span style=color:#a6e22e>setAccessible</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>int</span> position <span style=color:#f92672>=</span> field<span style=color:#f92672>.</span><span style=color:#a6e22e>getInt</span><span style=color:#f92672>(</span>layoutParams<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#f92672>(!</span>layoutParams<span style=color:#f92672>.</span><span style=color:#a6e22e>isDecor</span> <span style=color:#f92672>&amp;&amp;</span> currentItem <span style=color:#f92672>==</span> position<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span> child<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>NoSuchFieldException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                e<span style=color:#f92672>.</span><span style=color:#a6e22e>printStackTrace</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>IllegalAccessException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                e<span style=color:#f92672>.</span><span style=color:#a6e22e>printStackTrace</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BottomSheetUtils</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setupViewPager</span><span style=color:#f92672>(</span>ViewPager viewPager<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>final</span> View bottomSheetParent <span style=color:#f92672>=</span> findBottomSheetParent<span style=color:#f92672>(</span>viewPager<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>bottomSheetParent <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            viewPager<span style=color:#f92672>.</span><span style=color:#a6e22e>addOnPageChangeListener</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> BottomSheetViewPagerListener<span style=color:#f92672>(</span>viewPager<span style=color:#f92672>,</span> bottomSheetParent<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BottomSheetViewPagerListener</span> <span style=color:#66d9ef>extends</span> ViewPager<span style=color:#f92672>.</span><span style=color:#a6e22e>SimpleOnPageChangeListener</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> ViewPager viewPager<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> ViewPagerBottomSheetBehavior<span style=color:#f92672>&lt;</span>View<span style=color:#f92672>&gt;</span> behavior<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>BottomSheetViewPagerListener</span><span style=color:#f92672>(</span>ViewPager viewPager<span style=color:#f92672>,</span> View bottomSheetParent<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>viewPager</span> <span style=color:#f92672>=</span> viewPager<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>behavior</span> <span style=color:#f92672>=</span> ViewPagerBottomSheetBehavior<span style=color:#f92672>.</span><span style=color:#a6e22e>from</span><span style=color:#f92672>(</span>bottomSheetParent<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onPageSelected</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> position<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            viewPager<span style=color:#f92672>.</span><span style=color:#a6e22e>post</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> Runnable<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>run</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    behavior<span style=color:#f92672>.</span><span style=color:#a6e22e>invalidateScrollingChild</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> View <span style=color:#a6e22e>findBottomSheetParent</span><span style=color:#f92672>(</span><span style=color:#66d9ef>final</span> View view<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        View current <span style=color:#f92672>=</span> view<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> <span style=color:#f92672>(</span>current <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>final</span> ViewGroup<span style=color:#f92672>.</span><span style=color:#a6e22e>LayoutParams</span> params <span style=color:#f92672>=</span> current<span style=color:#f92672>.</span><span style=color:#a6e22e>getLayoutParams</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>params <span style=color:#66d9ef>instanceof</span> CoordinatorLayout<span style=color:#f92672>.</span><span style=color:#a6e22e>LayoutParams</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>((</span>CoordinatorLayout<span style=color:#f92672>.</span><span style=color:#a6e22e>LayoutParams</span><span style=color:#f92672>)</span> params<span style=color:#f92672>).</span><span style=color:#a6e22e>getBehavior</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>instanceof</span> ViewPagerBottomSheetBehavior<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> current<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>final</span> ViewParent parent <span style=color:#f92672>=</span> current<span style=color:#f92672>.</span><span style=color:#a6e22e>getParent</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            current <span style=color:#f92672>=</span> parent <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>||</span> <span style=color:#f92672>!(</span>parent <span style=color:#66d9ef>instanceof</span> View<span style=color:#f92672>)</span> <span style=color:#f92672>?</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>:</span> <span style=color:#f92672>(</span>View<span style=color:#f92672>)</span> parent<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!-- design_view_pager_bottom_sheet_dialog.xml --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--
</span></span></span><span style=display:flex><span><span style=color:#75715e>  ~ Copyright (C) 2015 The Android Open Source Project
</span></span></span><span style=display:flex><span><span style=color:#75715e>  ~
</span></span></span><span style=display:flex><span><span style=color:#75715e>  ~ Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
</span></span></span><span style=display:flex><span><span style=color:#75715e>  ~ you may not use this file except in compliance with the License.
</span></span></span><span style=display:flex><span><span style=color:#75715e>  ~ You may obtain a copy of the License at
</span></span></span><span style=display:flex><span><span style=color:#75715e>  ~
</span></span></span><span style=display:flex><span><span style=color:#75715e>  ~      http://www.apache.org/licenses/LICENSE-2.0
</span></span></span><span style=display:flex><span><span style=color:#75715e>  ~
</span></span></span><span style=display:flex><span><span style=color:#75715e>  ~ Unless required by applicable law or agreed to in writing, software
</span></span></span><span style=display:flex><span><span style=color:#75715e>  ~ distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
</span></span></span><span style=display:flex><span><span style=color:#75715e>  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
</span></span></span><span style=display:flex><span><span style=color:#75715e>  ~ See the License for the specific language governing permissions and
</span></span></span><span style=display:flex><span><span style=color:#75715e>  ~ limitations under the License.
</span></span></span><span style=display:flex><span><span style=color:#75715e>--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;androidx.coordinatorlayout.widget.CoordinatorLayout</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>xmlns:android=</span><span style=color:#e6db74>&#34;http://schemas.android.com/apk/res/android&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>xmlns:app=</span><span style=color:#e6db74>&#34;http://schemas.android.com/apk/res-auto&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;match_parent&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;View</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/touch_outside&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:soundEffectsEnabled=</span><span style=color:#e6db74>&#34;false&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;FrameLayout</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/design_bottom_sheet&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:layout_gravity=</span><span style=color:#e6db74>&#34;center_horizontal|top&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:clickable=</span><span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>app:layout_behavior=</span><span style=color:#e6db74>&#34;.behavior.ViewPagerBottomSheetBehavior&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>style=</span><span style=color:#e6db74>&#34;?attr/bottomSheetStyle&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/androidx.coordinatorlayout.widget.CoordinatorLayout&gt;</span>
</span></span></code></pre></div><p>然后基于上述文件自定义BottomSheetDialog <code>ViewPagerBottomSheetDialog.java</code>以及<code>ViewPagerBottomSheetDialogFragment.java</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ViewPagerBottomSheetDialog</span> <span style=color:#66d9ef>extends</span> AppCompatDialog <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> ViewPagerBottomSheetBehavior<span style=color:#f92672>&lt;</span>FrameLayout<span style=color:#f92672>&gt;</span> mBehavior<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>boolean</span> mCancelable <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>boolean</span> mCanceledOnTouchOutside <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>boolean</span> mCanceledOnTouchOutsideSet<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>boolean</span> mCreated<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 在这个自定义的Dialog中加入了设置高度的功能
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> mPeekHeight<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> mMaxHeight<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Window mWindow<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> ViewPagerBottomSheetBehavior mBottomSheetBehavior<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>ViewPagerBottomSheetDialog</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> Context context<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>(</span>context<span style=color:#f92672>,</span> getThemeResId<span style=color:#f92672>(</span>context<span style=color:#f92672>,</span> 0<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>        init<span style=color:#f92672>(</span>1000<span style=color:#f92672>,</span>1000<span style=color:#f92672>);</span> <span style=color:#75715e>//
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>ViewPagerBottomSheetDialog</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> Context context<span style=color:#f92672>,</span> <span style=color:#a6e22e>@StyleRes</span> <span style=color:#66d9ef>int</span> theme<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>(</span>context<span style=color:#f92672>,</span> getThemeResId<span style=color:#f92672>(</span>context<span style=color:#f92672>,</span> theme<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// We hide the title bar for any style configuration. Otherwise, there will be a gap
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// above the bottom sheet when it is expanded.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        supportRequestWindowFeature<span style=color:#f92672>(</span>Window<span style=color:#f92672>.</span><span style=color:#a6e22e>FEATURE_NO_TITLE</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        init<span style=color:#f92672>(</span>1000<span style=color:#f92672>,</span> 1000<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>ViewPagerBottomSheetDialog</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> Context context<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> peekHeight<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> maxHeight<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>(</span>context<span style=color:#f92672>,</span> 0<span style=color:#f92672>,</span> peekHeight<span style=color:#f92672>,</span> maxHeight<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        init<span style=color:#f92672>(</span>peekHeight<span style=color:#f92672>,</span> maxHeight<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>ViewPagerBottomSheetDialog</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> Context context<span style=color:#f92672>,</span> <span style=color:#a6e22e>@StyleRes</span> <span style=color:#66d9ef>int</span> theme<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> peekHeight<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> maxHeight<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>(</span>context<span style=color:#f92672>,</span> getThemeResId<span style=color:#f92672>(</span>context<span style=color:#f92672>,</span> theme<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// We hide the title bar for any style configuration. Otherwise, there will be a gap
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// above the bottom sheet when it is expanded.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        supportRequestWindowFeature<span style=color:#f92672>(</span>Window<span style=color:#f92672>.</span><span style=color:#a6e22e>FEATURE_NO_TITLE</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        init<span style=color:#f92672>(</span>peekHeight<span style=color:#f92672>,</span> maxHeight<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#a6e22e>ViewPagerBottomSheetDialog</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> Context context<span style=color:#f92672>,</span> <span style=color:#66d9ef>boolean</span> cancelable<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                                         DialogInterface<span style=color:#f92672>.</span><span style=color:#a6e22e>OnCancelListener</span> cancelListener<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> peekHeight<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> maxHeight<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>(</span>context<span style=color:#f92672>,</span> cancelable<span style=color:#f92672>,</span> cancelListener<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        supportRequestWindowFeature<span style=color:#f92672>(</span>Window<span style=color:#f92672>.</span><span style=color:#a6e22e>FEATURE_NO_TITLE</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        mCancelable <span style=color:#f92672>=</span> cancelable<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        init<span style=color:#f92672>(</span>peekHeight<span style=color:#f92672>,</span> maxHeight<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>init</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> peekHeight<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> maxHeight<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        mWindow <span style=color:#f92672>=</span> getWindow<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        mPeekHeight <span style=color:#f92672>=</span> peekHeight<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        mMaxHeight <span style=color:#f92672>=</span> maxHeight<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setContentView</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@LayoutRes</span> <span style=color:#66d9ef>int</span> layoutResId<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>setContentView</span><span style=color:#f92672>(</span>wrapInBottomSheet<span style=color:#f92672>(</span>layoutResId<span style=color:#f92672>,</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onCreate</span><span style=color:#f92672>(</span>Bundle savedInstanceState<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>onCreate</span><span style=color:#f92672>(</span>savedInstanceState<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        getWindow<span style=color:#f92672>().</span><span style=color:#a6e22e>setLayout</span><span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>                ViewGroup<span style=color:#f92672>.</span><span style=color:#a6e22e>LayoutParams</span><span style=color:#f92672>.</span><span style=color:#a6e22e>MATCH_PARENT</span><span style=color:#f92672>,</span> ViewGroup<span style=color:#f92672>.</span><span style=color:#a6e22e>LayoutParams</span><span style=color:#f92672>.</span><span style=color:#a6e22e>MATCH_PARENT</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        setPeekHeight<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        setMaxHeight<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        mCreated <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setPeekHeight</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> peekHeight<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        mPeekHeight <span style=color:#f92672>=</span> peekHeight<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mCreated<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            setPeekHeight<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setMaxHeight</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> height<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        mMaxHeight <span style=color:#f92672>=</span> height<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mCreated<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            setMaxHeight<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setPeekHeight</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mPeekHeight <span style=color:#f92672>&lt;=</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>getBottomSheetBehavior<span style=color:#f92672>()</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            mBottomSheetBehavior<span style=color:#f92672>.</span><span style=color:#a6e22e>setPeekHeight</span><span style=color:#f92672>(</span>mPeekHeight<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setMaxHeight</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mMaxHeight <span style=color:#f92672>&lt;=</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 设置高度的核心函数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        mWindow<span style=color:#f92672>.</span><span style=color:#a6e22e>setLayout</span><span style=color:#f92672>(</span>ViewGroup<span style=color:#f92672>.</span><span style=color:#a6e22e>LayoutParams</span><span style=color:#f92672>.</span><span style=color:#a6e22e>MATCH_PARENT</span><span style=color:#f92672>,</span> mMaxHeight<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        mWindow<span style=color:#f92672>.</span><span style=color:#a6e22e>setGravity</span><span style=color:#f92672>(</span>Gravity<span style=color:#f92672>.</span><span style=color:#a6e22e>BOTTOM</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> ViewPagerBottomSheetBehavior <span style=color:#a6e22e>getBottomSheetBehavior</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mBottomSheetBehavior <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> mBottomSheetBehavior<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        View view <span style=color:#f92672>=</span> mWindow<span style=color:#f92672>.</span><span style=color:#a6e22e>findViewById</span><span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>design_bottom_sheet</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// setContentView() 没有调用
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>view <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        mBottomSheetBehavior <span style=color:#f92672>=</span> ViewPagerBottomSheetBehavior<span style=color:#f92672>.</span><span style=color:#a6e22e>from</span><span style=color:#f92672>(</span>view<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> mBottomSheetBehavior<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setContentView</span><span style=color:#f92672>(</span>View view<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>setContentView</span><span style=color:#f92672>(</span>wrapInBottomSheet<span style=color:#f92672>(</span>0<span style=color:#f92672>,</span> view<span style=color:#f92672>,</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setContentView</span><span style=color:#f92672>(</span>View view<span style=color:#f92672>,</span> ViewGroup<span style=color:#f92672>.</span><span style=color:#a6e22e>LayoutParams</span> params<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>setContentView</span><span style=color:#f92672>(</span>wrapInBottomSheet<span style=color:#f92672>(</span>0<span style=color:#f92672>,</span> view<span style=color:#f92672>,</span> params<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setCancelable</span><span style=color:#f92672>(</span><span style=color:#66d9ef>boolean</span> cancelable<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>setCancelable</span><span style=color:#f92672>(</span>cancelable<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mCancelable <span style=color:#f92672>!=</span> cancelable<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            mCancelable <span style=color:#f92672>=</span> cancelable<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mBehavior <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                mBehavior<span style=color:#f92672>.</span><span style=color:#a6e22e>setHideable</span><span style=color:#f92672>(</span>cancelable<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setCanceledOnTouchOutside</span><span style=color:#f92672>(</span><span style=color:#66d9ef>boolean</span> cancel<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>setCanceledOnTouchOutside</span><span style=color:#f92672>(</span>cancel<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>cancel <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span>mCancelable<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            mCancelable <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        mCanceledOnTouchOutside <span style=color:#f92672>=</span> cancel<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        mCanceledOnTouchOutsideSet <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> View <span style=color:#a6e22e>wrapInBottomSheet</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> layoutResId<span style=color:#f92672>,</span> View view<span style=color:#f92672>,</span> ViewGroup<span style=color:#f92672>.</span><span style=color:#a6e22e>LayoutParams</span> params<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>final</span> CoordinatorLayout coordinator <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>CoordinatorLayout<span style=color:#f92672>)</span> View<span style=color:#f92672>.</span><span style=color:#a6e22e>inflate</span><span style=color:#f92672>(</span>getContext<span style=color:#f92672>(),</span>
</span></span><span style=display:flex><span>                R<span style=color:#f92672>.</span><span style=color:#a6e22e>layout</span><span style=color:#f92672>.</span><span style=color:#a6e22e>design_view_pager_bottom_sheet_dialog</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>layoutResId <span style=color:#f92672>!=</span> 0 <span style=color:#f92672>&amp;&amp;</span> view <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            view <span style=color:#f92672>=</span> getLayoutInflater<span style=color:#f92672>().</span><span style=color:#a6e22e>inflate</span><span style=color:#f92672>(</span>layoutResId<span style=color:#f92672>,</span> coordinator<span style=color:#f92672>,</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        FrameLayout bottomSheet <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>FrameLayout<span style=color:#f92672>)</span> coordinator<span style=color:#f92672>.</span><span style=color:#a6e22e>findViewById</span><span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>design_bottom_sheet</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        mBehavior <span style=color:#f92672>=</span> ViewPagerBottomSheetBehavior<span style=color:#f92672>.</span><span style=color:#a6e22e>from</span><span style=color:#f92672>(</span>bottomSheet<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        mBehavior<span style=color:#f92672>.</span><span style=color:#a6e22e>setBottomSheetCallback</span><span style=color:#f92672>(</span>mBottomSheetCallback<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        mBehavior<span style=color:#f92672>.</span><span style=color:#a6e22e>setHideable</span><span style=color:#f92672>(</span>mCancelable<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>params <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            bottomSheet<span style=color:#f92672>.</span><span style=color:#a6e22e>addView</span><span style=color:#f92672>(</span>view<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            bottomSheet<span style=color:#f92672>.</span><span style=color:#a6e22e>addView</span><span style=color:#f92672>(</span>view<span style=color:#f92672>,</span> params<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// We treat the CoordinatorLayout as outside the dialog though it is technically inside
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        coordinator<span style=color:#f92672>.</span><span style=color:#a6e22e>findViewById</span><span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>touch_outside</span><span style=color:#f92672>).</span><span style=color:#a6e22e>setOnClickListener</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> View<span style=color:#f92672>.</span><span style=color:#a6e22e>OnClickListener</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onClick</span><span style=color:#f92672>(</span>View view<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mCancelable <span style=color:#f92672>&amp;&amp;</span> isShowing<span style=color:#f92672>()</span> <span style=color:#f92672>&amp;&amp;</span> shouldWindowCloseOnTouchOutside<span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    cancel<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> coordinator<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>shouldWindowCloseOnTouchOutside</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(!</span>mCanceledOnTouchOutsideSet<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>Build<span style=color:#f92672>.</span><span style=color:#a6e22e>VERSION</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SDK_INT</span> <span style=color:#f92672>&lt;</span> 11<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                mCanceledOnTouchOutside <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                TypedArray a <span style=color:#f92672>=</span> getContext<span style=color:#f92672>().</span><span style=color:#a6e22e>obtainStyledAttributes</span><span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>[]{</span>android<span style=color:#f92672>.</span><span style=color:#a6e22e>R</span><span style=color:#f92672>.</span><span style=color:#a6e22e>attr</span><span style=color:#f92672>.</span><span style=color:#a6e22e>windowCloseOnTouchOutside</span><span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>                mCanceledOnTouchOutside <span style=color:#f92672>=</span> a<span style=color:#f92672>.</span><span style=color:#a6e22e>getBoolean</span><span style=color:#f92672>(</span>0<span style=color:#f92672>,</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                a<span style=color:#f92672>.</span><span style=color:#a6e22e>recycle</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            mCanceledOnTouchOutsideSet <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> mCanceledOnTouchOutside<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getThemeResId</span><span style=color:#f92672>(</span>Context context<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> themeId<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>themeId <span style=color:#f92672>==</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// If the provided theme is 0, then retrieve the dialogTheme from our theme
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            TypedValue outValue <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> TypedValue<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>context<span style=color:#f92672>.</span><span style=color:#a6e22e>getTheme</span><span style=color:#f92672>().</span><span style=color:#a6e22e>resolveAttribute</span><span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>                    R<span style=color:#f92672>.</span><span style=color:#a6e22e>attr</span><span style=color:#f92672>.</span><span style=color:#a6e22e>bottomSheetDialogTheme</span><span style=color:#f92672>,</span> outValue<span style=color:#f92672>,</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                themeId <span style=color:#f92672>=</span> outValue<span style=color:#f92672>.</span><span style=color:#a6e22e>resourceId</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>// bottomSheetDialogTheme is not provided; we default to our light theme
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                themeId <span style=color:#f92672>=</span> R<span style=color:#f92672>.</span><span style=color:#a6e22e>style</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Theme_Design_Light_BottomSheetDialog</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> themeId<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> ViewPagerBottomSheetBehavior<span style=color:#f92672>.</span><span style=color:#a6e22e>BottomSheetCallback</span> mBottomSheetCallback
</span></span><span style=display:flex><span>            <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ViewPagerBottomSheetBehavior<span style=color:#f92672>.</span><span style=color:#a6e22e>BottomSheetCallback</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onStateChanged</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> View bottomSheet<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                                   <span style=color:#a6e22e>@ViewPagerBottomSheetBehavior.State</span> <span style=color:#66d9ef>int</span> newState<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>newState <span style=color:#f92672>==</span> ViewPagerBottomSheetBehavior<span style=color:#f92672>.</span><span style=color:#a6e22e>STATE_HIDDEN</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                dismiss<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onSlide</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@NonNull</span> View bottomSheet<span style=color:#f92672>,</span> <span style=color:#66d9ef>float</span> slideOffset<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>};</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ViewPagerBottomSheetDialogFragment</span> <span style=color:#66d9ef>extends</span> AppCompatDialogFragment <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Dialog <span style=color:#a6e22e>onCreateDialog</span><span style=color:#f92672>(</span>Bundle savedInstanceState<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> ViewPagerBottomSheetDialog<span style=color:#f92672>(</span>getContext<span style=color:#f92672>(),</span> getTheme<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>在Activity中使用</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FourthActivity</span> <span style=color:#66d9ef>extends</span> AppCompatActivity <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onCreate</span><span style=color:#f92672>(</span>Bundle savedInstanceState<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>onCreate</span><span style=color:#f92672>(</span>savedInstanceState<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        setContentView<span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>layout</span><span style=color:#f92672>.</span><span style=color:#a6e22e>activity_fourth</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>EmojiItem<span style=color:#f92672>&gt;</span> data <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>        String<span style=color:#f92672>[]</span> arr <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> String<span style=color:#f92672>[]{</span>
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;\uD83D\uDC4D&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;❤️&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;\uD83C\uDF89&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;\uD83D\uDE02&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;\uD83D\uDC4F&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;\uD83D\uDE0E&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>};</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span> i <span style=color:#f92672>&lt;</span> arr<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span><span style=color:#f92672>;</span> i<span style=color:#f92672>++)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            data<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> EmojiItem<span style=color:#f92672>(</span>arr<span style=color:#f92672>[</span>i<span style=color:#f92672>],</span> i <span style=color:#f92672>+</span> 10<span style=color:#f92672>,</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 多了setMaxHeight(1600)和setPeekHeight(1000)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        findViewById<span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>button4</span><span style=color:#f92672>).</span><span style=color:#a6e22e>setOnClickListener</span><span style=color:#f92672>(</span>v <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>                ListBottomSheetDialog<span style=color:#f92672>.</span><span style=color:#a6e22e>builder</span><span style=color:#f92672>(</span>FourthActivity<span style=color:#f92672>.</span><span style=color:#a6e22e>this</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                        <span style=color:#f92672>.</span><span style=color:#a6e22e>setEmojiItemList</span><span style=color:#f92672>(</span>data<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                        <span style=color:#f92672>.</span><span style=color:#a6e22e>setMaxHeight</span><span style=color:#f92672>(</span>1600<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                        <span style=color:#f92672>.</span><span style=color:#a6e22e>setPeekHeight</span><span style=color:#f92672>(</span>1000<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                        <span style=color:#f92672>.</span><span style=color:#a6e22e>setOffscreenPageLimit</span><span style=color:#f92672>(</span>5<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                        <span style=color:#f92672>.</span><span style=color:#a6e22e>setEnableScroll</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                        <span style=color:#f92672>.</span><span style=color:#a6e22e>show</span><span style=color:#f92672>(</span>getSupportFragmentManager<span style=color:#f92672>()));</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>结果如下，但是如果BottomSheetDialog官方将这个bug修复了，那么就不需要修改这么多的文件，而且自定义的ViewPagerBottomSheetBehavior只是复制了BottomSheetBehavior中的部分代码，可能存在其他问题尚未发现。</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/Zhoutao822/hugo-pic/pictures/design5.gif alt=design5></p><h2 id=参考>参考：<a hidden class=anchor aria-hidden=true href=#参考>#</a></h2><ol><li><a href=https://material.io/develop/android/components/bottom-sheet-behavior/>Material Design</a></li><li><a href=https://github.com/material-components/material-components-android/blob/master/docs/getting-started.md>Getting started with Material Components for Android</a></li></ol></div><footer class=post-footer><ul class=post-tags><li><a href=https://zhoutao822.github.io/tags/android/>android</a></li><li><a href=https://zhoutao822.github.io/tags/md/>MD</a></li><li><a href=https://zhoutao822.github.io/tags/bottomsheetdialog/>BottomSheetDialog</a></li></ul><nav class=paginav><a class=prev href=https://zhoutao822.github.io/posts/python_language_rules/><span class=title>« Prev Page</span><br><span>Python语言规范</span></a></nav></footer><script src=https://utteranc.es/client.js repo=zhoutao822/zhoutao822.github.io issue-term=title theme=github-dark crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2022 <a href=https://zhoutao822.github.io/>Tao's Notes</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>